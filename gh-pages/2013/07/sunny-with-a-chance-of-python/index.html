<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Primary Unit mirror on GitHub – Sunny with a chance of Python</title>

  <!-- Load my combined stylesheet -->
  <link rel="stylesheet" href="/resources/all.min.css">


  <link rel="license" href="https://creativecommons.org/licenses/by/4.0/">

  <link rel="alternate" type="application/rss+xml" title="RSS feed for Primary Unit" href="/rss">
  <link rel="alternate" type="application/json" title="JSON feed for Primary Unit" href="/feed.json">

  <!-- Apple pinned sites icon, Apple touch icon, Favicon -->
  <link rel="mask-icon" href="/resources/favicon.svg" color="#1369BF">
  <link rel="apple-touch-icon-precomposed" href="/resources/favicon.png">
  <link rel="icon" href="/resources/favicon.ico">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="A mirror of https://www.robjwells.com hosted on GitHub">
</head>

<body>

<div class="wrapper">

<header class="site-header">

  <div class="site-title-container mute-links">
    <h1 class="site-title"><a href="https://robjwells.github.io">Primary Unit mirror on GitHub</a></h1>
    <p class="site-byline"><i>by</i> Rob Wells</p>
  </div>

  <div class="site-menu-container">

    <nav id="site-nav">
      <ul class="site-links mute-links">
        <li><a href="/about/">About</a></li>
        <li><a href="/archives/">Archives</a></li>
        <li><a href="/feed.json">JSON&nbsp;feed</a></li>
        <li><a href="/rss">RSS&nbsp;feed</a></li>
      </ul>
    </nav>

    <label for="search-field" class="site-search-label">
      Site search
    </label>
    <form id="site-search" class="site-search" method="get" action="https://duckduckgo.com/">
      <input name="q" type="text" id="search-field" class="search-field" placeholder="via DuckDuckGo">
      <input name="sites" value="https://robjwells.github.io" hidden>
      <button type="submit" class="search-button">Search</button>
    </form>

  </div> <!-- .site-menu-container -->

</header> <!-- .site-header -->

<main role="main">

  <article>
    <header>
      <h2 class="mute-links"><a href="https://robjwells.github.io/2013/07/sunny-with-a-chance-of-python/">Sunny with a chance of Python</a></h2>
      <p><time datetime="2013-07-23T22:28">Tuesday, July 23 2013</time></p>
    </header>
    <p>Learning Python is the next goal that I’ve set myself, though I have put it off for a bit while I <a href="http://www.cengage.com/cgi-wadsworth/course_products_wp.pl?fid=M20b&amp;product_isbn_issn=9780495826163&amp;discipline_number=10002&amp;template=AISE">improve my maths skills</a>.</p>
<p>But I do have one little Python script that I’ve been playing with for a while, which I first wrote to dip my toe in and see if I liked the language. (I do, very much so).</p>
<p>It’s incredibly basic but complements my <a href="https://github.com/robjwells/weatherman">automatic weather script</a>, which saves a lot of time and tedium at work, by fetching a text summary of the weather for the entire UK.</p>
<pre><code>#!/usr/bin/env python3
&quot;&quot;&quot;Get a 3 to 5 day outlook for the UK from the Met Office.&quot;&quot;&quot;

from urllib.request import urlopen
from bs4 import BeautifulSoup as bs
from subprocess import Popen, PIPE

api_url = (&quot;http://datapoint.metoffice.gov.uk/public/&quot; +
           &quot;data/txt/wxfcs/regionalforecast/xml/515&quot;)
api_key = &quot;Your Datapoint API key here&quot;

def get_weather():
  &quot;&quot;&quot;Retrieve and parse the text summary forecast&quot;&quot;&quot;
  raw_xml = urlopen(api_url + &quot;?key=&quot; + api_key)
  outlook = bs(raw_xml).find(id=&quot;day3to5&quot;).get_text()
  return outlook

if __name__ == &quot;__main__&quot;:
  # Encode and pipe outlook to pasteboard
  outlook_bytes = get_weather().encode()
  Popen(&quot;pbcopy&quot;, stdin=PIPE).communicate(outlook_bytes)</code></pre>


<p>As shown at the top, this is Python 3 code. I have a version written in Python 2 which is very similar. It uses the built-in ElementTree XML parser instead of the nicer Beautiful Soup used in this script as I both wanted to get my head around the interface and for reasons to do with the Python version at work.</p>
<p>Lines 8–10 set up variables needed to access the <a href="http://www.metoffice.gov.uk/datapoint">Met Office API</a>, which is done in the <code>get_weather</code> function below.</p>
<p>Beautiful Soup is used to parse the API response in line 16. I love its dead simple method for finding elements, especially compared to ElementTree’s insistence that you provide the XML namespace:</p>
<pre><code>pattern = (&quot;.//{www.metoffice.gov.uk/xml/metoRegionalFcst}&quot; +
           &quot;Period[@id='day3to5']&quot;)</code></pre>


<p>My favourite part of the script is also the newest. If it is run directly from the command line (line 18) it pipes the forecast to the clipboard using <code>pbcopy</code>. I knew Python could start external processes but I was <em>blown away</em> by how easy this was. Previously the script printed the forecast and I used a shell alias to send it to the pasteboard. Yuck. This is much better.</p>
<p>The way Python 3 handles strings requires an encoding step in line 21, whereas Python 2 can just send a string through <code>communicate</code> — as it’s already bytes. This caught me out at first but otherwise it was incredibly simple to implement.</p>
<p>So, like I said, a trivial program but one that has made me eager to learn more Python.</p>
  </article>

</main>

<footer class="site-footer">
  <small class="mute-links">
    This work is licensed under a
    <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">
    Creative Commons Attribution 4.0 International License</a>.
  </small>
</footer> <!-- .site-footer -->

</div> <!-- .wrapper -->

</body>

</html>