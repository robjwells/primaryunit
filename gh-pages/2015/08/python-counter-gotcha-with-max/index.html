<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Primary Unit mirror on GitHub – Python Counter gotcha with max</title>

  <!-- Load my combined stylesheet -->
  <link rel="stylesheet" href="/resources/all.min.css">


  <link rel="license" href="https://creativecommons.org/licenses/by/4.0/">

  <link rel="alternate" type="application/rss+xml" title="RSS feed for Primary Unit" href="/rss">
  <link rel="alternate" type="application/json" title="JSON feed for Primary Unit" href="/feed.json">

  <!-- Apple pinned sites icon, Apple touch icon, Favicon -->
  <link rel="mask-icon" href="/resources/favicon.svg" color="#1369BF">
  <link rel="apple-touch-icon-precomposed" href="/resources/favicon.png">
  <link rel="icon" href="/resources/favicon.ico">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="A mirror of https://www.robjwells.com hosted on GitHub">
</head>

<body>

<div class="wrapper">

<header class="site-header">

  <div class="site-title-container mute-links">
    <h1 class="site-title"><a href="https://robjwells.github.io">Primary Unit mirror on GitHub</a></h1>
    <p class="site-byline"><i>by</i> Rob Wells</p>
  </div>

  <div class="site-menu-container">

    <nav id="site-nav">
      <ul class="site-links mute-links">
        <li><a href="/about/">About</a></li>
        <li><a href="/archives/">Archives</a></li>
        <li><a href="/feed.json">JSON&nbsp;feed</a></li>
        <li><a href="/rss">RSS&nbsp;feed</a></li>
      </ul>
    </nav>

    <label for="search-field" class="site-search-label">
      Site search
    </label>
    <form id="site-search" class="site-search" method="get" action="https://duckduckgo.com/">
      <input name="q" type="text" id="search-field" class="search-field" placeholder="via DuckDuckGo">
      <input name="sites" value="https://robjwells.github.io" hidden>
      <button type="submit" class="search-button">Search</button>
    </form>

  </div> <!-- .site-menu-container -->

</header> <!-- .site-header -->

<main role="main">

  <article>
    <header>
      <h2 class="mute-links"><a href="https://robjwells.github.io/2015/08/python-counter-gotcha-with-max/">Python Counter gotcha with max</a></h2>
      <p><time datetime="2015-08-07T13:49">Friday, August 7 2015</time></p>
    </header>
    <div class="flag">
  <p><strong>Update 2015-08-10</strong></p>
  <p>
    The example given now uses strings as the keys instead of numbers
    to ward off any confusion between the keys and their counts.
  </p>
</div>

<p>Getting the greatest element from a sequence in Python is dead simple: just use the built-in <a href="https://docs.python.org/3/library/functions.html?highlight=max#max">max</a> function.</p>
<p>Storing the frequency of items is also dead easy with <a href="https://docs.python.org/3/library/collections.html?highlight=collections.counter#collections.Counter">collections.Counter</a>:</p>
<pre><code>&gt;&gt;&gt; from collections import Counter
&gt;&gt;&gt; c = Counter('abracadabra')
&gt;&gt;&gt; print(c)
Counter({'a': 5, 'b': 2, 'r': 2, 'c': 1, 'd': 1})</code></pre>


<p>The greatest item in a counter is obviously the most common, so surely we’ll just …</p>
<pre><code>&gt;&gt;&gt; max(c)
'r'</code></pre>


<p><em>What?</em> Here’s the gotcha: Python counters are a dictionary subclass. Call <code>max</code> with a dictionary and it’ll get the greatest key, because keys are what you get when you iterate over a dictionary. Same deal.</p>
<p>To get the most common element you have to use — surprise! — <code>Counter.most_common()</code>. Without arguments this produces a list of tuples (item, count), sorted by count:</p>
<pre><code>&gt;&gt;&gt; c.most_common()
[('a', 5), ('b', 2), ('r', 2), ('c', 1), ('d', 1)]</code></pre>


<p>So to get the actual most common element, you do:</p>
<pre><code>&gt;&gt;&gt; c.most_common(1)[0][0]
'a'</code></pre>


<p>Where the argument <code>1</code> limits it to the first tuple.</p>
<p>But what if the counter’s empty? You’ll get an IndexError trying to index into the list returned by <code>most_common()</code>:</p>
<pre><code>&gt;&gt;&gt; d = Counter()
&gt;&gt;&gt; d.most_common()
[]
&gt;&gt;&gt; d.most_common()[0][0]
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
IndexError: list index out of range</code></pre>


<p>In Python 3.4 <code>max</code> got the <code>default</code> argument, which you can use to get a default value when a sequence is empty. Here’s how to get similar behaviour with Counter:</p>
<pre><code>d.most_common(1)[0][0] if d else None</code></pre>


<p>This takes advantage of the "falsey" nature of an empty dictionary to give you <code>None</code> without having to handle an IndexError.</p>
  </article>

</main>

<footer class="site-footer">
  <small class="mute-links">
    This work is licensed under a
    <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">
    Creative Commons Attribution 4.0 International License</a>.
  </small>
</footer> <!-- .site-footer -->

</div> <!-- .wrapper -->

</body>

</html>