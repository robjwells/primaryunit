<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Primary Unit mirror on GitHub – InDesign PDF metastasis</title>

  <!-- Load my combined stylesheet -->
  <link rel="stylesheet" href="/resources/all.min.css">


  <link rel="license" href="https://creativecommons.org/licenses/by/4.0/">

  <link rel="alternate" type="application/rss+xml" title="RSS feed for Primary Unit" href="/rss">
  <link rel="alternate" type="application/json" title="JSON feed for Primary Unit" href="/feed.json">

  <!-- Apple pinned sites icon, Apple touch icon, Favicon -->
  <link rel="mask-icon" href="/resources/favicon.svg" color="#1369BF">
  <link rel="apple-touch-icon-precomposed" href="/resources/favicon.png">
  <link rel="icon" href="/resources/favicon.ico">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="A mirror of https://www.robjwells.com hosted on GitHub">
</head>

<body>

<div class="wrapper">

<header class="site-header">

  <div class="site-title-container mute-links">
    <h1 class="site-title"><a href="https://robjwells.github.io">Primary Unit mirror on GitHub</a></h1>
    <p class="site-byline"><i>by</i> Rob Wells</p>
  </div>

  <div class="site-menu-container">

    <nav id="site-nav">
      <ul class="site-links mute-links">
        <li><a href="/about/">About</a></li>
        <li><a href="/archives/">Archives</a></li>
        <li><a href="/feed.json">JSON&nbsp;feed</a></li>
        <li><a href="/rss">RSS&nbsp;feed</a></li>
      </ul>
    </nav>

    <label for="search-field" class="site-search-label">
      Site search
    </label>
    <form id="site-search" class="site-search" method="get" action="https://duckduckgo.com/">
      <input name="q" type="text" id="search-field" class="search-field" placeholder="via DuckDuckGo">
      <input name="sites" value="https://robjwells.github.io" hidden>
      <button type="submit" class="search-button">Search</button>
    </form>

  </div> <!-- .site-menu-container -->

</header> <!-- .site-header -->

<main role="main">

  <article>
    <header>
      <h2 class="mute-links"><a href="https://robjwells.github.io/2017/04/indesign-pdf-metastasis/">InDesign PDF metastasis</a></h2>
      <p><time datetime="2017-04-17T22:25">Monday, April 17 2017</time></p>
    </header>
    <p>At work we deal a lot with PDFs, both press quality and low-quality for viewing on screen. Over time I’ve automated a fair amount of the creation for both types, but one thing that I haven’t yet done is automate file-size reductions for the low-quality PDFs.</p>
<p>(We still use InDesign CS4 at work, so bear in mind that some or all of the below may not apply to more recent versions.)</p>
<p>It’s interesting to look at exactly what is making the files large enough to require slimming down in the first place. All our low-quality PDFs are exported from InDesign with the built-in “Smallest file size” preset, but the sizes are usually around 700kB for single tabloid-sized, image-sparse pages.</p>
<p><img src="/images/2017-04-17-arts-full.jpg"
     class="pull-right"
     alt="A low-quality image of a Morning Star arts page."></p>
<p>Let’s take Tuesday’s arts page as our example. It’s pretty basic: two small images and a medium-sized one, two drop shadows, one transparency and a fair amount of text. (That line of undermatter in the lead article was corrected before we went to print.)</p>
<p>But exporting using InDesign’s lowest-quality PDF preset creates a 715kB file. The images are small and rendered at a low DPI, so they’re not inflating the file.</p>
<p>Thankfully you can have a poke around PDF files with your favourite text editor (<a href="http://www.barebones.com/products/bbedit/">BBEdit</a>, obviously). You’ll find a lot of “garbage” text, which I imagine is chunks of binary data, but there’s plenty of plain text you can read. The big chunks tend to be metadata. Here’s part of the first metadata block in the PDF file for the arts page:</p>
<pre><code>&lt;x:xmpmeta xmlns:x=&quot;adobe:ns:meta/&quot; x:xmptk=&quot;Adobe XMP […]&quot;&gt;
 &lt;rdf:RDF xmlns:rdf=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot;&gt;
  &lt;rdf:Description rdf:about=&quot;&quot;
    xmlns:xmp=&quot;http://ns.adobe.com/xap/1.0/&quot;
    xmlns:dc=&quot;http://purl.org/dc/elements/1.1/&quot;
    xmlns:photoshop=&quot;http://ns.adobe.com/photoshop/1.0/&quot;
    … Blah blah blah exif data etc …
  &lt;/rdf:Description&gt;
 &lt;/rdf:RDF&gt;
&lt;/x:xmpmeta&gt;</code></pre>


<p>Which is the none-too-exciting block for one of the images, a Photoshop file. There’s two more like this, roughly 50–100 lines each. Then we hit a chunk which describes the InDesign file itself, with this giveaway line:</p>
<pre><code>&lt;xmp:CreatorTool&gt;Adobe InDesign CS4 (6.0.6)&lt;/xmp:CreatorTool&gt;</code></pre>


<p>So what, right? InDesign includes some document and image metadata when it exports a PDF. Sure, yeah. I mean, the metadata blocks for the images weren’t too long, and this is just about their container.</p>
<p>Except this InDesign metadata block is 53,895 lines long in a file that’s 86,585 lines long. 574,543 characters of the document’s 714,626 — 80% of the file.</p>
<p>I think it’s safe to say we’ve found our culprit. But what’s going on in those 54,000 lines? Well, mostly this:</p>
<pre><code>&lt;xmpMM:History&gt;
   &lt;rdf:Seq&gt;
      &lt;rdf:li rdf:parseType=&quot;Resource&quot;&gt;
         &lt;stEvt:action&gt;created&lt;/stEvt:action&gt;
         &lt;stEvt:instanceID&gt;xmp.iid:[… hex ID …]&lt;/stEvt:instanceID&gt;
         &lt;stEvt:when&gt;2012-05-22T12:55:27+01:00&lt;/stEvt:when&gt;
         &lt;stEvt:softwareAgent&gt;Adobe InDesign 6.0&lt;/stEvt:softwareAgent&gt;
      &lt;/rdf:li&gt;
      &lt;rdf:li rdf:parseType=&quot;Resource&quot;&gt;
         &lt;stEvt:action&gt;saved&lt;/stEvt:action&gt;
         &lt;stEvt:instanceID&gt;xmp.iid:[… hex ID …]&lt;/stEvt:instanceID&gt;
         &lt;stEvt:when&gt;2012-05-22T12:55:54+01:00&lt;/stEvt:when&gt;
         &lt;stEvt:softwareAgent&gt;Adobe InDesign 6.0&lt;/stEvt:softwareAgent&gt;
         &lt;stEvt:changed&gt;/&lt;/stEvt:changed&gt;
      &lt;/rdf:li&gt;
    &lt;!--  1,287 more list items  --&gt;
   &lt;/rdf:Seq&gt;
&lt;/xmpMM:History&gt;</code></pre>


<p>It’s effectively a record of every time the document was saved. But if you look at the <code>stEvt:when</code> tag you’ll notice the first items are from 2012 — when our “master” InDesign file from which we derive our edition files was first created. So, the whole record of that master file is included in every InDesign file we use, and the PDFs we create from them.</p>
<p>Can we remove this metadata from InDesign? You can see it in <span class="osx-menu">File ▸ File Info… ▸ Advanced</span>, select it and press the rubbish bin icon. Save, quit, reopen and… it’s still there.</p>
<p>Thankfully Acrobat can remove this stuff from your final PDF, by going through the “PDF Optimizer” or “Save Optimized PDF” or whatever menu item it’s hiding under these days. (In the “Audit Space Usage” window it corresponds to the “Document Overhead”.)</p>
<p>Unfortunately Acrobat’s AppleScript support has always been poor — I’ve no idea what it’s like now, remember we’re talking CS4 — and I’ve no time nor desire to dive into Adobe’s JavaScript interface. So while you can (and we do) automate the PDF exports, you can’t slim these files down automatically with Acrobat.</p>
<p>Our solution at work has been to cut the cruft from the PDF using Acrobat when we use it to combine our separate page PDFs by hand. But ultimately I want to automate the whole process of exporting the PDFs, stitching them together in order, and reducing the file size.</p>
<p>After using <a href="https://ghostscript.com">ghostscript</a> for our <a href="https://github.com/ppps/ms-barcode">automatic barcode creation</a>, I twigged that it would be useful for processing the PDFs after creation, and sure enough you can use it to slim down PDFs. Here’s an example command:</p>
<pre><code>gs -sDEVICE=pdfwrite \
   -dPDFSETTINGS=/screen \
   -dCompatibilityLevel=1.5 \
   -dNOPAUSE -dQUIET -dBATCH \
   -sOutputFile=&quot;11_Books_180417-smaller.pdf&quot; \
   &quot;11_Books_180417.pdf&quot;</code></pre>


<p>Most of that is ghostscript boilerplate (it’s not exactly the friendliest tool to use), but the important option is <code>-dPDFSETTINGS=/screen</code> which, according to <a href="https://ghostscript.com/doc/9.14/Ps2pdf.htm#Options">one page of the sprawling docs</a>, is a predefined Adobe Distiller setting.</p>
<p>Using it on our 715kB example spits out an 123kB PDF that is visually identical apart from mangling the drop shadows (which I think can be solved by changing the transparency flattening settings when the PDF is exported from InDesign).</p>
  </article>

</main>

<footer class="site-footer">
  <small class="mute-links">
    This work is licensed under a
    <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">
    Creative Commons Attribution 4.0 International License</a>.
  </small>
</footer> <!-- .site-footer -->

</div> <!-- .wrapper -->

</body>

</html>