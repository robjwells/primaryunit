<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Primary Unit mirror on GitHub – page 11</title>

  <!-- Load my combined stylesheet -->
  <link rel="stylesheet" href="/resources/all.min.css">


  <link rel="license" href="https://creativecommons.org/licenses/by/4.0/">

  <link rel="alternate" type="application/rss+xml" title="RSS feed for Primary Unit" href="/rss">
  <link rel="alternate" type="application/json" title="JSON feed for Primary Unit" href="/feed.json">

  <!-- Apple pinned sites icon, Apple touch icon, Favicon -->
  <link rel="mask-icon" href="/resources/favicon.svg" color="#1369BF">
  <link rel="apple-touch-icon-precomposed" href="/resources/favicon.png">
  <link rel="icon" href="/resources/favicon.ico">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="A mirror of https://www.robjwells.com hosted on GitHub">
</head>

<body>

<div class="wrapper">

<header class="site-header">

  <div class="site-title-container mute-links">
    <h1 class="site-title"><a href="https://robjwells.github.io">Primary Unit mirror on GitHub</a></h1>
    <p class="site-byline"><i>by</i> Rob Wells</p>
  </div>

  <div class="site-menu-container">

    <nav id="site-nav">
      <ul class="site-links mute-links">
        <li><a href="/about/">About</a></li>
        <li><a href="/archives/">Archives</a></li>
        <li><a href="/feed.json">JSON&nbsp;feed</a></li>
        <li><a href="/rss">RSS&nbsp;feed</a></li>
      </ul>
    </nav>

    <label for="search-field" class="site-search-label">
      Site search
    </label>
    <form id="site-search" class="site-search" method="get" action="https://duckduckgo.com/">
      <input name="q" type="text" id="search-field" class="search-field" placeholder="via DuckDuckGo">
      <input name="sites" value="https://robjwells.github.io" hidden>
      <button type="submit" class="search-button">Search</button>
    </form>

  </div> <!-- .site-menu-container -->

</header> <!-- .site-header -->

<main role="main">

  <article>
    <header>
      <h2 class="mute-links"><a href="https://robjwells.github.io/2015/08/pythons-counter-class-again/">Python’s Counter class, again</a></h2>
      <p><time datetime="2015-08-10T22:34">Monday, August 10 2015</time></p>
    </header>
    <p>I made a mistake in <a href="/2015/08/python-counter-gotcha-with-max/">my recent post about Python’s Counter class</a> by using numbers in the example rather than strings. It meant it wasn’t clear what I actually wanted out of the counter. (While I was writing it, I was getting confused between the keys and their counts myself. I should have taken the hint.) That post’s now been updated.</p>
<p>I had a lovely email from <a href="http://jacobsondergaard.com">Jacob Söndergaard</a> that prompted me into clarifying things, and also started me thinking about ways you can still use <code>max</code> on the counter to get the most common item. Here’s what I’ve got:</p>
<pre><code>from collections import Counter
c = Counter('abracadabra')
most_common = max(c.items(), key=lambda t: t[1])[0]</code></pre>


<p>Here <code>max</code> gets a sequence of tuples (key, count) from <code>c.items()</code> and the custom <code>key</code> function tells it to choose the greatest element based on the count. The <code>[0]</code> index at the end ensures you just get the key, not the count.</p>
<p>But should you do this? No. Please don’t. At this point you’re effectively duplicating the way that Counter implements <code>.most_common()</code> internally. (Here’s <a href="https://hg.python.org/cpython/file/tip/Lib/collections/__init__.py#l530">the Python source for the method</a>.) That’s at best too — the implementation does something more complicated if you only want the top n most-common elements.</p>
<p>Also: <a href="https://www.youtube.com/watch?v=fH850qp85Zk">Abracadabra</a>.</p>
  </article>
  <article>
    <header>
      <h2 class="mute-links"><a href="https://robjwells.github.io/2015/08/python-counter-gotcha-with-max/">Python Counter gotcha with max</a></h2>
      <p><time datetime="2015-08-07T13:49">Friday, August 7 2015</time></p>
    </header>
    <div class="flag">
  <p><strong>Update 2015-08-10</strong></p>
  <p>
    The example given now uses strings as the keys instead of numbers
    to ward off any confusion between the keys and their counts.
  </p>
</div>

<p>Getting the greatest element from a sequence in Python is dead simple: just use the built-in <a href="https://docs.python.org/3/library/functions.html?highlight=max#max">max</a> function.</p>
<p>Storing the frequency of items is also dead easy with <a href="https://docs.python.org/3/library/collections.html?highlight=collections.counter#collections.Counter">collections.Counter</a>:</p>
<pre><code>&gt;&gt;&gt; from collections import Counter
&gt;&gt;&gt; c = Counter('abracadabra')
&gt;&gt;&gt; print(c)
Counter({'a': 5, 'b': 2, 'r': 2, 'c': 1, 'd': 1})</code></pre>


<p>The greatest item in a counter is obviously the most common, so surely we’ll just …</p>
<pre><code>&gt;&gt;&gt; max(c)
'r'</code></pre>


<p><em>What?</em> Here’s the gotcha: Python counters are a dictionary subclass. Call <code>max</code> with a dictionary and it’ll get the greatest key, because keys are what you get when you iterate over a dictionary. Same deal.</p>
<p>To get the most common element you have to use — surprise! — <code>Counter.most_common()</code>. Without arguments this produces a list of tuples (item, count), sorted by count:</p>
<pre><code>&gt;&gt;&gt; c.most_common()
[('a', 5), ('b', 2), ('r', 2), ('c', 1), ('d', 1)]</code></pre>


<p>So to get the actual most common element, you do:</p>
<pre><code>&gt;&gt;&gt; c.most_common(1)[0][0]
'a'</code></pre>


<p>Where the argument <code>1</code> limits it to the first tuple.</p>
<p>But what if the counter’s empty? You’ll get an IndexError trying to index into the list returned by <code>most_common()</code>:</p>
<pre><code>&gt;&gt;&gt; d = Counter()
&gt;&gt;&gt; d.most_common()
[]
&gt;&gt;&gt; d.most_common()[0][0]
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
IndexError: list index out of range</code></pre>


<p>In Python 3.4 <code>max</code> got the <code>default</code> argument, which you can use to get a default value when a sequence is empty. Here’s how to get similar behaviour with Counter:</p>
<pre><code>d.most_common(1)[0][0] if d else None</code></pre>


<p>This takes advantage of the "falsey" nature of an empty dictionary to give you <code>None</code> without having to handle an IndexError.</p>
  </article>
  <article>
    <header>
      <h2 class="mute-links"><a href="https://robjwells.github.io/2015/08/yeah/">Yeah!</a></h2>
      <p><time datetime="2015-08-05T20:04">Wednesday, August 5 2015</time></p>
    </header>
    <p>For some reason, the other day I was thinking about <a href="https://en.wikipedia.org/wiki/Junior_Senior">Junior Senior</a>. I knew they had a pop hit something like 10 years ago but I just couldn’t place it at all: what it was called, what it sounded like, who they were, nothing.</p>
<p>Until this morning, when I looked them up and ended up watching the video for <a href="https://www.youtube.com/watch?v=SPlQpGeTbIE">Move Your Feet on YouTube</a> — and that was it, that video. It’s so good.</p>
<p>There’s just something about that super-happy, pixel art craziness. The dancing toast really clicked in my brain for some reason. I had to share — click the image below to load the gif.</p>
<p><img src="data:image/png;base64,
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
" alt="The first frame of the gif." id="toast"></p>
<script>
var toast_img = document.getElementById('toast');
var data_uri = toast_img.src;
var gif_url = '/images/2015-08-05_Junior-Senior-Yeah.gif';
document.getElementById('toast').addEventListener('click', function (ev) {
  var target = ev.target;
  if (target.src.match(/^data:image/)) {
      target.src = gif_url;
  } else {
      target.src = data_uri;
  }
});
</script>

<noscript>
  <p>Sorry, you don’t have JavaScript enabled. Here’s <a href="/images/2015-08-05_Junior-Senior-Yeah.gif">a link to the gif</a>.</p>
</noscript>

<p>Since 100 words about a 12-year-old pop track with an amusing video feels like I’m cheating you, dear reader, here’s some technical stuff about doing easy click-to-start gifs.</p>
<p>I wanted to share that toast clip but after reading <a href="http://jacquesmattheij.com/the-fastest-blog-in-the-world">Jacques Mattheij’s post The Fastest Blog in the World</a> I was a little wary about dumping a 150KB image onto my front page just for a bit of whimsy. That attitude’s quite silly when you consider that the weight of the Primary Unit front page before this post went up was a full 883kB — nearly three-quarters of which is Tumblr’s crap that is out of my control. But anyway.</p>
<p>Here’s the code:</p>
<pre><code>&lt;img src=&quot;data:image/png;base64,
… base64 data …
&quot; alt=&quot;The first frame of the gif.&quot; id=&quot;toast&quot;&gt;

&lt;script&gt;
var toast_img = document.getElementById('toast');
var data_uri = toast_img.src;
var gif_url = '/images/2015-08-05_Junior-Senior-Yeah.gif';
document.getElementById('toast').addEventListener('click', function (ev) {
  var target = ev.target;
  if (target.src.match(/^data:image/)) {
      target.src = gif_url;
  } else {
      target.src = data_uri;
  }
});
&lt;/script&gt;
&lt;noscript&gt;
  &lt;p&gt;
    Sorry, you don’t have JavaScript enabled.
    Here’s &lt;a href=&quot;/images/2015…gif&quot;&gt;a link to the gif&lt;/a&gt;.
  &lt;/p&gt;
&lt;/noscript&gt;</code></pre>


<p>I grabbed the first frame and saved it as a png. At 1.5kB it wasn’t worth the extra request or bothering uploading the file, so I turned it into <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/data_URIs">a base64 data URI</a> and put it in-line (note the placeholder on line 2). From the command line:</p>
<pre><code>uuencode -m infile remotename</code></pre>


<p>The <code>remotename</code> just gets included in the header line, which you ditch, but you have to give something to the command.</p>
<p>Next we’ve got a little in-line JavaScript which grabs the <code>img</code> by its ID. It registers an event handler so that, when the image is clicked, if the <code>src</code> attribute is anything but the gif URL, it swaps it out and saves the old <code>src</code>. Click the image again and it restores the old <code>src</code> — in this case stopping the gif by substituting back in the data URI, but you could use it to swap two images or similar.</p>
  </article>
  <article>
    <header>
      <h2 class="mute-links"><a href="https://robjwells.github.io/2015/08/corbyn/">Corbyn</a></h2>
      <p><time datetime="2015-08-04T10:04">Tuesday, August 4 2015</time></p>
    </header>
    <p>Quite surprisingly the <a href="http://www.labour.org.uk/index.php/leadership">Labour leadership contest</a> has turned out to be pretty interesting — almost entirely because of Jeremy Corbyn. I’m not going to run down why Corbyn is easily the best candidate, with easily the best policies. He’s a principled man with <a href="https://duckduckgo.com/?q=site:morningstaronline.co.uk+%22Jeremy+Corbyn%22&amp;t=osx">a deep commitment to building a better society</a>.</p>
<p>What interests me is the reaction to his campaign in the mass media. At every election it focuses on the trivial rather than policy, but in the leadership contest this has been even more obvious. There’s been an almost blanket refusal to engage with <a href="http://www.jeremyforlabour.com/news">Corbyn’s policies</a> (save <a href="http://morningstaronline.co.uk">our paper</a>) — despite <a href="http://www.independent.co.uk/news/uk/politics/the-jeremy-corbyn-policies-that-most-people-actually-agree-with-10407148.html">mass public support</a>.</p>
<p>A good chunk of the past few weeks has been spent <a href="http://www.theguardian.com/politics/2015/jul/22/jeremy-corbyn-gathers-support-from-communist-party-ukip-and-tories">fretting</a> <a href="http://www.theguardian.com/politics/2015/jul/26/jeremy-corbyn-genuine-labour-supporters-leadership-election">about</a> supposed infiltration of the Labour Party by the “hard left” and Tories. (The Guardian’s <a href="http://www.theguardian.com/politics/2015/jul/22/jeremy-corbyn-gathers-support-from-communist-party-ukip-and-tories">reference</a> to the Communist Party is <a href="http://www.bbc.co.uk/news/uk-wales-politics-33680629">wrong</a>.) The funniest part of this was the Telegraph <a href="http://www.telegraph.co.uk/news/politics/labour/11741861/How-you-can-help-Jeremy-Corbyn-win-and-destroy-the-Labour-Party.html">urging its readers to skew the vote</a>, before <a href="http://www.telegraph.co.uk/news/politics/labour/11767152/Tories-dont-vote-for-Jeremy-Corbyn.-It-wont-end-well.html">remembering</a> that people are smart enough to recognise policies that are in their interest so it’s best not to draw attention to them. But the actual cuckoo in the nest is right-wing party-within-a-party Progress, as <a href="https://www.morningstaronline.co.uk/a-7dd3-Who-are-the-real-entryists#.VcBwGHhanTQ">Solomon Hughes writes</a>:</p>
<blockquote>
<p>The press and television have been mesmerised by the non-existent conspiracy of 150,000 co-ordinated “hard leftists” paying their £3 memberships to join Labour. At the same time they have ignored a million-pound operation to stop Corbyn and boost Liz Kendall — an operation that even one of its leading members calls “an unaccountable faction dominated by a secretive billionaire.”</p>
</blockquote>
<p>The real fear, as shown by that <a href="http://www.telegraph.co.uk/news/politics/labour/11767152/Tories-dont-vote-for-Jeremy-Corbyn.-It-wont-end-well.html">second Telegraph link</a>, is that if Corbyn wins it will drag the centre of political debate to the left — which the right <a href="http://www.theguardian.com/commentisfree/2015/jul/26/smart-tories-labour-jeremy-corbyn-mania-david-cameron">openly acknowledges</a>. It’s this (as well as apprehension about the unwashed masses mucking in) that has spun the Guardian and Observer — the “left-wing” papers — into a frenzy. For them, the <a href="http://www.labour.org.uk/index.php/leadership/candidate/andy-burnham">three</a> <a href="http://www.labour.org.uk/index.php/leadership/candidate/yvette-cooper">right-wing</a> <a href="http://www.labour.org.uk/index.php/leadership/candidate/liz-kendall">candidates</a> are far enough apart to have a reasonable contest, which <a href="http://www.theguardian.com/commentisfree/2015/jul/24/corbyn-tribe-identity-politics-labour">should focus on tactics</a>, <a href="http://www.theguardian.com/commentisfree/2015/jul/24/the-guardian-view-on-the-labour-leadership-analogue-contest-in-a-digital-age">anyway</a>.</p>
<p><a href="http://www.theguardian.com/commentisfree/2015/jul/19/observer-view-labour-leadership-election-jeremy-corbyn">Time</a> <a href="http://www.theguardian.com/politics/2015/jul/06/unite-jeremy-corbyn-labour-leadership">and</a> <a href="http://www.theguardian.com/commentisfree/2015/jul/22/labour-party-members-jeremy-corbyn">time</a> <a href="http://www.theguardian.com/politics/2015/jul/22/jeremy-corbyn-could-lose-frontbenchers-if-elected-labour-leader">again</a>, <a href="http://www.theguardian.com/politics/2015/jul/31/corbyn-supporters-risk-return-to-labour-splits-of-1980s-says-burnham">the</a> <a href="http://www.theguardian.com/commentisfree/2015/aug/04/jeremy-corbyn-gamble-labour-future-yvette-cooper-best-chance">papers</a> <a href="http://www.theguardian.com/commentisfree/2015/aug/01/neil-kinnock-labour-leader-andy-burnham">reinforce</a> <a href="http://www.theguardian.com/politics/2015/aug/02/kezia-dugdale-corbyn-win-leave-labour-carping-sidelines-years">the</a> <a href="http://www.theguardian.com/politics/2015/jul/24/yvette-cooper-hits-out-startlingly-retro-labour-leadership-campaign">limits</a> <a href="http://www.theguardian.com/politics/2015/jul/23/labour-leadership-john-prescott-tony-blairs-totally-unacceptable-jeremy-corbyn">of</a> <a href="http://www.theguardian.com/politics/2015/jul/22/tony-blair-labour-will-not-win-if-it-steps-away-from-centre-ground">acceptable</a> <a href="http://www.theguardian.com/politics/blog/2015/jul/23/labour-leadership-race-tony-blair-intervene-jeremy-corbyn">debate</a>.</p>
<p>This kind of behaviour should raise flags for anyone who’s read <a href="https://en.wikipedia.org/wiki/Manufacturing_Consent">Manufacturing Consent</a> — still the best book on the media after 27 years — where the role of the New York Times as serving as the boundary of acceptable “left-wing” thought in the US is made clear: “<a href="https://chomsky.info/1992____02/">thus far and no further</a>.”</p>
<p>Thankfully, this barrage hasn’t deterred tens of thousands of people registering as Labour supporters to back Corbyn, packing out rallies to the point where <a href="http://www.theguardian.com/politics/2015/aug/03/jeremy-corbyn-bid-labour-leadership-momentum-supporters-flock-london-rally">he has to speak to them in the street</a>. There’s <a href="https://www.morningstaronline.co.uk/a-146f-Corbyns-not-home-and-dry,-warns-MP#.VcB-ynhanTQ">much work left to do</a> — we still face a united ruling class that is carrying out ever more savage attacks on us — but it’s nice to have some good news.</p>
  </article>
  <article>
    <header>
      <h2 class="mute-links"><a href="https://robjwells.github.io/2015/07/historical-dollars/">Historical dollars</a></h2>
      <p><time datetime="2015-07-15T23:40">Wednesday, July 15 2015</time></p>
    </header>
    <p>I’ve read <a href="https://en.wikipedia.org/wiki/A_People%27s_History_of_the_United_States">a</a> <a href="https://en.wikipedia.org/wiki/The_Big_Sleep">few</a> <a href="http://www.haymarketbooks.org/hc/People-Wasnt-Made-to-Burn">books</a> recently where references were made to dollar amounts from many years ago. However, I often find it difficult to understand the context of, say, $10,000 in 1829.</p>
<p>But Wolfram Alpha <a href="http://www.wolframalpha.com/input/?i=$10,000+(1829+US+dollars)+in+2015">can give you a rough approximation</a> by applying inflation data. This isn’t perfect but is useful to get a general idea of what a similar amount might be today. (There isn’t all the context needed for a more accurate determination, and the underlying basket for inflation measures can be misleading.)</p>
<p>Handily, there’s a <a href="http://products.wolframalpha.com/api/">Wolfram Alpha API</a> we can use to get this information programmatically. I originally wrote this script as a command-line tool, but how often do you read at your computer with a terminal window open? So the one in this post uses <a href="http://omz-software.com/pythonista/index.html">Pythonista</a> and its <code>ui</code> module to make things more practical.</p>
<p>The code to get the new amount is pretty trivial:</p>
<pre><code>from __future__ import division

from datetime import date
from xml.etree import ElementTree
import requests
import ui


def calculate_amount(sender):
  &quot;&quot;&quot;Convert given dollar amount for given year to current dollars&quot;&quot;&quot;
  amount = view['amount'].text
  year = view['year'].text

  if not (amount and year):
    return

  api_key = 'YOUR API KEY IN HERE'
  api_url = 'http://api.wolframalpha.com/v2/query'
  query_template = '${amount} ({past_year} US dollars) in {current_year}'
  query = query_template.format(amount=amount,
                                past_year=year,
                                current_year=date.today().year)
  parameters = {'appid': api_key,
                'input': query,
                'format': 'plaintext',
                'podtitle': 'Result'}
  response = requests.get(api_url, params=parameters)
  xml_soup = ElementTree.fromstring(response.content)
  new_amount = xml_soup.find('pod/subpod/plaintext').text.splitlines()[0]
  view['result'].text = new_amount</code></pre>


<p>The <code>calculate_amount</code> function above is called on a button press (hence the <code>sender</code> argument) and fetches the text from a couple of UI elements (all that <code>view</code> subscripting), bailing out if either the amount or year is missing.</p>
<p>The query template (line 19) is how Wolfram Alpha parses historical dollar calculations (shown as “Input interpretation” on the website) so we can skip as much parsing time as possible.</p>
<p>Requests makes sending the query a doddle, and we use an exact XPath expression to get at the result in the response. There’s an <a href="http://products.wolframalpha.com/api/explorer.html">API explorer</a> so you can get a handle on the structure. (Normally I’d use Beautiful Soup, but Pythonista doesn’t include lxml, so BS parses it as HTML and there’s really no point in risking — however slightly — that causing some problem. ElementTree isn’t bad if you’re doing something simple, anyway.)</p>
<p>Lastly we update another UI element to show the result. Pretty simple.</p>
<p>With the UI, you’ve got two choices: make it in code or use Pythonista’s UI editor. I chose to do it in code, because the UI editor saves a <code>.pyui</code> JSON file that <a href="https://omz-forums.appspot.com/pythonista/post/5254558653612032">takes a little work to share</a>.</p>
<p>But now I would recommend people use the editor, as actually getting the code to work was a bit of a headache too. For the record: Ole Zorn has done an <em>incredible</em> job with Pythonista and the UI tools are incredible. However: the <code>ui</code> module seems to expose the Cocoa way of making GUIs, so unless you’ve got an understanding of that you may be in for some bumps. Helpfully, you can <a href="http://omz-software.com/pythonista/docs/ios/ui.html">view the <code>ui</code> module documentation online</a> Here’s the rest of the code:</p>
<pre><code>def setup_view():
    view = ui.View()
    view.name = 'Historical Dollars'
    view.background_color = 'white'
    view.width, view.height = ui.get_screen_size()

    amount_field = ui.TextField()
    amount_field.name = 'amount'
    amount_field.keyboard_type = ui.KEYBOARD_DECIMAL_PAD
    amount_field.placeholder = 'Dollar amount'
    amount_field.width *= 2
    amount_field.height /= 2

    year_field = ui.TextField()
    year_field.name = 'year'
    year_field.keyboard_type = ui.KEYBOARD_NUMBER_PAD
    year_field.placeholder = 'Year'
    year_field.width *= 2
    year_field.height /= 2

    button = ui.Button(title='Calculate')
    button.action = calculate_amount

    result_label = ui.Label()
    result_label.name = 'result'
    result_label.width = view.width
    result_label.alignment = ui.ALIGN_CENTER

    horizontal_centre = view.width * 0.5
    field_spacing = amount_field.height * 1.5
    amount_field.center = (horizontal_centre, amount_field.height)
    year_field.center = (horizontal_centre,
                         amount_field.center[1] + field_spacing)
    button.center = (horizontal_centre,
                     year_field.center[1] + field_spacing * 0.75)
    result_label.center = (horizontal_centre,
                           button.centre[1] + field_spacing * 0.75)

    view.add_subview(amount_field)
    view.add_subview(year_field)
    view.add_subview(button)
    view.add_subview(result_label)

    return view


view = setup_view()
view.present('sheet')</code></pre>


<p>And here’s what it looks like in action:</p>
<p><img src="/images/2015-07-15_historical-dollars.png" alt="A screenshot of the historical dollars script run in Pythonista on an iPhone."></p>
<p>The thing that really tripped me up was <code>.flex</code> on views, for resizing the element based on its containing view. In the code above this isn’t used. I initially followed the example code from the documentation and had all sorts of fun trying to work out why the view spacing was screwed up.</p>
<p>Another problem was expecting the 'master', containing view (instantiated on line 34) to have the same size as the screen, when it seems to act kind of like HTML elements do when they’re full of floated elements (they collapse). That’s why I set the containing view’s size on line 37. (<code>get_screen_size</code> also seems to always return the portrait size.) All sorts of headaches resulted from this (centring elements based on the view’s centre particularly).</p>
<p>Otherwise, it’s so straightforward and repetitive that I’m not going to explain most of the lines. It works well enough on an iPhone 5-sized screen in portrait mode (elements are off-centre in landscape) but for smaller screens you may want to shift things about a bit vertically.</p>
<p>There are a couple of things to note. The names you give to elements are how you pick them out later (check out lines 11 and 40). Setting the button’s action (line 54) is obviously key, and you just give it a function object. And specifying the keyboard type for the two text fields relieves the need to do input validation (though the decimal keyboard lets you type multiple points), but frankly anyone who might use this should understand that it’ll break if you type in something funky.</p>
<p>I’ve put <a href="https://gist.github.com/robjwells/9bcdb0cac8d234d1ab7e">the whole file online</a> if that’s easier for anyone. You just need to paste it into an empty script in Pythonista and run it. </p>
  </article>
  <div class="pagination">
<p class="pagination-older"><a href="https://robjwells.github.io/page-12/">Older posts</a></p><p class="pagination-newer"><a href="https://robjwells.github.io/page-10/">Newer posts</a></p>  </div>

</main>

<footer class="site-footer">
  <small class="mute-links">
    This work is licensed under a
    <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">
    Creative Commons Attribution 4.0 International License</a>.
  </small>
</footer> <!-- .site-footer -->

</div> <!-- .wrapper -->

</body>

</html>