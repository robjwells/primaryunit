<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Primary Unit mirror on GitHub – page 12</title>

  <!-- Load my combined stylesheet -->
  <link rel="stylesheet" href="/resources/all.min.css">

  <!-- Load my combined JavaScript -->
  <script src="/resources/all.min.js" async></script>

  <link rel="license" href="https://creativecommons.org/licenses/by/4.0/">

  <link rel="alternate" type="application/rss+xml" title="RSS feed for Primary Unit" href="/rss">
  <link rel="alternate" type="application/json" title="JSON feed for Primary Unit" href="/feed.json">

  <!-- Apple pinned sites icon, Apple touch icon, Favicon -->
  <link rel="mask-icon" href="/resources/favicon.svg" color="#1369BF">
  <link rel="apple-touch-icon-precomposed" href="/resources/favicon.png">
  <link rel="icon" href="/resources/favicon.ico">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="A mirror of https://www.robjwells.com hosted on GitHub">
</head>

<body>

<div class="wrapper">

<header class="site-header">

  <div class="site-title-container mute-links">
    <h1 class="site-title"><a href="https://robjwells.github.io">Primary Unit mirror on GitHub</a></h1>
    <p class="site-byline"><i>by</i> Rob Wells</p>
  </div>

  <div class="site-menu-container">

    <nav id="site-nav">
      <ul class="site-links mute-links">
        <li><a href="/about/">About</a></li>
        <li><a href="/archives/">Archives</a></li>
        <li><a href="/feed.json">JSON&nbsp;feed</a></li>
        <li><a href="/rss">RSS&nbsp;feed</a></li>
      </ul>
    </nav>

    <label for="search-field" class="site-search-label">
      Site search
    </label>
    <form id="site-search" class="site-search" method="get" action="https://duckduckgo.com/">
      <input name="q" type="text" id="search-field" class="search-field" placeholder="via DuckDuckGo">
      <input name="sites" value="https://robjwells.github.io" hidden>
      <button type="submit" class="search-button">Search</button>
    </form>

  </div> <!-- .site-menu-container -->

</header> <!-- .site-header -->

<main role="main">

  <article>
    <header>
      <h2 class="mute-links"><a href="https://robjwells.github.io/2015/07/historical-dollars/">Historical dollars</a></h2>
      <p><time datetime="2015-07-15T23:40">Wednesday, July 15 2015</time></p>
    </header>
    <p>I’ve read <a href="https://en.wikipedia.org/wiki/A_People%27s_History_of_the_United_States">a</a> <a href="https://en.wikipedia.org/wiki/The_Big_Sleep">few</a> <a href="http://www.haymarketbooks.org/hc/People-Wasnt-Made-to-Burn">books</a> recently where references were made to dollar amounts from many years ago. However, I often find it difficult to understand the context of, say, $10,000 in 1829.</p>
<p>But Wolfram Alpha <a href="http://www.wolframalpha.com/input/?i=$10,000+(1829+US+dollars)+in+2015">can give you a rough approximation</a> by applying inflation data. This isn’t perfect but is useful to get a general idea of what a similar amount might be today. (There isn’t all the context needed for a more accurate determination, and the underlying basket for inflation measures can be misleading.)</p>
<p>Handily, there’s a <a href="http://products.wolframalpha.com/api/">Wolfram Alpha API</a> we can use to get this information programmatically. I originally wrote this script as a command-line tool, but how often do you read at your computer with a terminal window open? So the one in this post uses <a href="http://omz-software.com/pythonista/index.html">Pythonista</a> and its <code>ui</code> module to make things more practical.</p>
<p>The code to get the new amount is pretty trivial:</p>
<div class="syntax"><pre><span></span><span class="lineno"> 1 </span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span>
<span class="lineno"> 4 </span><span class="kn">from</span> <span class="nn">xml.etree</span> <span class="kn">import</span> <span class="n">ElementTree</span>
<span class="lineno"> 5 </span><span class="kn">import</span> <span class="nn">requests</span>
<span class="lineno"> 6 </span><span class="kn">import</span> <span class="nn">ui</span>
<span class="lineno"> 7 </span>
<span class="lineno"> 8 </span>
<span class="lineno"> 9 </span><span class="k">def</span> <span class="nf">calculate_amount</span><span class="p">(</span><span class="n">sender</span><span class="p">):</span>
<span class="lineno">10 </span>  <span class="sd">&quot;&quot;&quot;Convert given dollar amount for given year to current dollars&quot;&quot;&quot;</span>
<span class="lineno">11 </span>  <span class="n">amount</span> <span class="o">=</span> <span class="n">view</span><span class="p">[</span><span class="s1">&#39;amount&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">text</span>
<span class="lineno">12 </span>  <span class="n">year</span> <span class="o">=</span> <span class="n">view</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">text</span>
<span class="lineno">13 </span>
<span class="lineno">14 </span>  <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">amount</span> <span class="ow">and</span> <span class="n">year</span><span class="p">):</span>
<span class="lineno">15 </span>    <span class="k">return</span>
<span class="lineno">16 </span>
<span class="lineno">17 </span>  <span class="n">api_key</span> <span class="o">=</span> <span class="s1">&#39;YOUR API KEY IN HERE&#39;</span>
<span class="lineno">18 </span>  <span class="n">api_url</span> <span class="o">=</span> <span class="s1">&#39;http://api.wolframalpha.com/v2/query&#39;</span>
<span class="lineno">19 </span>  <span class="n">query_template</span> <span class="o">=</span> <span class="s1">&#39;${amount} ({past_year} US dollars) in {current_year}&#39;</span>
<span class="lineno">20 </span>  <span class="n">query</span> <span class="o">=</span> <span class="n">query_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">amount</span><span class="o">=</span><span class="n">amount</span><span class="p">,</span>
<span class="lineno">21 </span>                                <span class="n">past_year</span><span class="o">=</span><span class="n">year</span><span class="p">,</span>
<span class="lineno">22 </span>                                <span class="n">current_year</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
<span class="lineno">23 </span>  <span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;appid&#39;</span><span class="p">:</span> <span class="n">api_key</span><span class="p">,</span>
<span class="lineno">24 </span>                <span class="s1">&#39;input&#39;</span><span class="p">:</span> <span class="n">query</span><span class="p">,</span>
<span class="lineno">25 </span>                <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="s1">&#39;plaintext&#39;</span><span class="p">,</span>
<span class="lineno">26 </span>                <span class="s1">&#39;podtitle&#39;</span><span class="p">:</span> <span class="s1">&#39;Result&#39;</span><span class="p">}</span>
<span class="lineno">27 </span>  <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">api_url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">)</span>
<span class="lineno">28 </span>  <span class="n">xml_soup</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
<span class="lineno">29 </span>  <span class="n">new_amount</span> <span class="o">=</span> <span class="n">xml_soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;pod/subpod/plaintext&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="lineno">30 </span>  <span class="n">view</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">new_amount</span>
</pre></div>


<p>The <code>calculate_amount</code> function above is called on a button press (hence the <code>sender</code> argument) and fetches the text from a couple of UI elements (all that <code>view</code> subscripting), bailing out if either the amount or year is missing.</p>
<p>The query template (line 19) is how Wolfram Alpha parses historical dollar calculations (shown as “Input interpretation” on the website) so we can skip as much parsing time as possible.</p>
<p>Requests makes sending the query a doddle, and we use an exact XPath expression to get at the result in the response. There’s an <a href="http://products.wolframalpha.com/api/explorer.html">API explorer</a> so you can get a handle on the structure. (Normally I’d use Beautiful Soup, but Pythonista doesn’t include lxml, so BS parses it as HTML and there’s really no point in risking — however slightly — that causing some problem. ElementTree isn’t bad if you’re doing something simple, anyway.)</p>
<p>Lastly we update another UI element to show the result. Pretty simple.</p>
<p>With the UI, you’ve got two choices: make it in code or use Pythonista’s UI editor. I chose to do it in code, because the UI editor saves a <code>.pyui</code> JSON file that <a href="https://omz-forums.appspot.com/pythonista/post/5254558653612032">takes a little work to share</a>.</p>
<p>But now I would recommend people use the editor, as actually getting the code to work was a bit of a headache too. For the record: Ole Zorn has done an <em>incredible</em> job with Pythonista and the UI tools are incredible. However: the <code>ui</code> module seems to expose the Cocoa way of making GUIs, so unless you’ve got an understanding of that you may be in for some bumps. Helpfully, you can <a href="http://omz-software.com/pythonista/docs/ios/ui.html">view the <code>ui</code> module documentation online</a> Here’s the rest of the code:</p>
<div class="syntax"><pre><span></span><span class="lineno">33 </span><span class="k">def</span> <span class="nf">setup_view</span><span class="p">():</span>
<span class="lineno">34 </span>    <span class="n">view</span> <span class="o">=</span> <span class="n">ui</span><span class="o">.</span><span class="n">View</span><span class="p">()</span>
<span class="lineno">35 </span>    <span class="n">view</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Historical Dollars&#39;</span>
<span class="lineno">36 </span>    <span class="n">view</span><span class="o">.</span><span class="n">background_color</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span>
<span class="lineno">37 </span>    <span class="n">view</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">view</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">ui</span><span class="o">.</span><span class="n">get_screen_size</span><span class="p">()</span>
<span class="lineno">38 </span>
<span class="lineno">39 </span>    <span class="n">amount_field</span> <span class="o">=</span> <span class="n">ui</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
<span class="lineno">40 </span>    <span class="n">amount_field</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;amount&#39;</span>
<span class="lineno">41 </span>    <span class="n">amount_field</span><span class="o">.</span><span class="n">keyboard_type</span> <span class="o">=</span> <span class="n">ui</span><span class="o">.</span><span class="n">KEYBOARD_DECIMAL_PAD</span>
<span class="lineno">42 </span>    <span class="n">amount_field</span><span class="o">.</span><span class="n">placeholder</span> <span class="o">=</span> <span class="s1">&#39;Dollar amount&#39;</span>
<span class="lineno">43 </span>    <span class="n">amount_field</span><span class="o">.</span><span class="n">width</span> <span class="o">*=</span> <span class="mi">2</span>
<span class="lineno">44 </span>    <span class="n">amount_field</span><span class="o">.</span><span class="n">height</span> <span class="o">/=</span> <span class="mi">2</span>
<span class="lineno">45 </span>
<span class="lineno">46 </span>    <span class="n">year_field</span> <span class="o">=</span> <span class="n">ui</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
<span class="lineno">47 </span>    <span class="n">year_field</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;year&#39;</span>
<span class="lineno">48 </span>    <span class="n">year_field</span><span class="o">.</span><span class="n">keyboard_type</span> <span class="o">=</span> <span class="n">ui</span><span class="o">.</span><span class="n">KEYBOARD_NUMBER_PAD</span>
<span class="lineno">49 </span>    <span class="n">year_field</span><span class="o">.</span><span class="n">placeholder</span> <span class="o">=</span> <span class="s1">&#39;Year&#39;</span>
<span class="lineno">50 </span>    <span class="n">year_field</span><span class="o">.</span><span class="n">width</span> <span class="o">*=</span> <span class="mi">2</span>
<span class="lineno">51 </span>    <span class="n">year_field</span><span class="o">.</span><span class="n">height</span> <span class="o">/=</span> <span class="mi">2</span>
<span class="lineno">52 </span>
<span class="lineno">53 </span>    <span class="n">button</span> <span class="o">=</span> <span class="n">ui</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Calculate&#39;</span><span class="p">)</span>
<span class="lineno">54 </span>    <span class="n">button</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="n">calculate_amount</span>
<span class="lineno">55 </span>
<span class="lineno">56 </span>    <span class="n">result_label</span> <span class="o">=</span> <span class="n">ui</span><span class="o">.</span><span class="n">Label</span><span class="p">()</span>
<span class="lineno">57 </span>    <span class="n">result_label</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;result&#39;</span>
<span class="lineno">58 </span>    <span class="n">result_label</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">width</span>
<span class="lineno">59 </span>    <span class="n">result_label</span><span class="o">.</span><span class="n">alignment</span> <span class="o">=</span> <span class="n">ui</span><span class="o">.</span><span class="n">ALIGN_CENTER</span>
<span class="lineno">60 </span>
<span class="lineno">61 </span>    <span class="n">horizontal_centre</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="mf">0.5</span>
<span class="lineno">62 </span>    <span class="n">field_spacing</span> <span class="o">=</span> <span class="n">amount_field</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="mf">1.5</span>
<span class="lineno">63 </span>    <span class="n">amount_field</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="p">(</span><span class="n">horizontal_centre</span><span class="p">,</span> <span class="n">amount_field</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
<span class="lineno">64 </span>    <span class="n">year_field</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="p">(</span><span class="n">horizontal_centre</span><span class="p">,</span>
<span class="lineno">65 </span>                         <span class="n">amount_field</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">field_spacing</span><span class="p">)</span>
<span class="lineno">66 </span>    <span class="n">button</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="p">(</span><span class="n">horizontal_centre</span><span class="p">,</span>
<span class="lineno">67 </span>                     <span class="n">year_field</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">field_spacing</span> <span class="o">*</span> <span class="mf">0.75</span><span class="p">)</span>
<span class="lineno">68 </span>    <span class="n">result_label</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="p">(</span><span class="n">horizontal_centre</span><span class="p">,</span>
<span class="lineno">69 </span>                           <span class="n">button</span><span class="o">.</span><span class="n">centre</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">field_spacing</span> <span class="o">*</span> <span class="mf">0.75</span><span class="p">)</span>
<span class="lineno">70 </span>
<span class="lineno">71 </span>    <span class="n">view</span><span class="o">.</span><span class="n">add_subview</span><span class="p">(</span><span class="n">amount_field</span><span class="p">)</span>
<span class="lineno">72 </span>    <span class="n">view</span><span class="o">.</span><span class="n">add_subview</span><span class="p">(</span><span class="n">year_field</span><span class="p">)</span>
<span class="lineno">73 </span>    <span class="n">view</span><span class="o">.</span><span class="n">add_subview</span><span class="p">(</span><span class="n">button</span><span class="p">)</span>
<span class="lineno">74 </span>    <span class="n">view</span><span class="o">.</span><span class="n">add_subview</span><span class="p">(</span><span class="n">result_label</span><span class="p">)</span>
<span class="lineno">75 </span>
<span class="lineno">76 </span>    <span class="k">return</span> <span class="n">view</span>
<span class="lineno">77 </span>
<span class="lineno">78 </span>
<span class="lineno">79 </span><span class="n">view</span> <span class="o">=</span> <span class="n">setup_view</span><span class="p">()</span>
<span class="lineno">80 </span><span class="n">view</span><span class="o">.</span><span class="n">present</span><span class="p">(</span><span class="s1">&#39;sheet&#39;</span><span class="p">)</span>
</pre></div>


<p>And here’s what it looks like in action:</p>
<p><img src="/images/2015-07-15_historical-dollars.png" alt="A screenshot of the historical dollars script run in Pythonista on an iPhone."></p>
<p>The thing that really tripped me up was <code>.flex</code> on views, for resizing the element based on its containing view. In the code above this isn’t used. I initially followed the example code from the documentation and had all sorts of fun trying to work out why the view spacing was screwed up.</p>
<p>Another problem was expecting the 'master', containing view (instantiated on line 34) to have the same size as the screen, when it seems to act kind of like HTML elements do when they’re full of floated elements (they collapse). That’s why I set the containing view’s size on line 37. (<code>get_screen_size</code> also seems to always return the portrait size.) All sorts of headaches resulted from this (centring elements based on the view’s centre particularly).</p>
<p>Otherwise, it’s so straightforward and repetitive that I’m not going to explain most of the lines. It works well enough on an iPhone 5-sized screen in portrait mode (elements are off-centre in landscape) but for smaller screens you may want to shift things about a bit vertically.</p>
<p>There are a couple of things to note. The names you give to elements are how you pick them out later (check out lines 11 and 40). Setting the button’s action (line 54) is obviously key, and you just give it a function object. And specifying the keyboard type for the two text fields relieves the need to do input validation (though the decimal keyboard lets you type multiple points), but frankly anyone who might use this should understand that it’ll break if you type in something funky.</p>
<p>I’ve put <a href="https://gist.github.com/robjwells/9bcdb0cac8d234d1ab7e">the whole file online</a> if that’s easier for anyone. You just need to paste it into an empty script in Pythonista and run it. </p>
  </article>
  <article>
    <header>
      <h2 class="mute-links"><a href="https://robjwells.github.io/2015/07/a-scripting-mess/">A scripting mess</a></h2>
      <p><time datetime="2015-07-05T16:52">Sunday, July 5 2015</time></p>
    </header>
    <p>I was thinking about redoing the <a href="https://github.com/robjwells/feral-four/blob/Illadelph/core.applescript">page generator script</a> for work again this morning, wondering if the newly widespread support for JavaScript in Cocoa applications and JavaScript for Automation would simplify some of the work I started on a Cocoa page-generating application.</p>
<p>The short answer is No. In fact I’m more disheartened at the state of inter-application scripting now than I was a year ago.</p>
<p>I began working on the application in January 2014, but hadn’t touched the project since last June. I got a bit bogged down with it, and it was by far too big a project to start with; I’d just finished the Big Nerd Ranch <a href="https://www.bignerdranch.com/we-write/objective-c-programming/">Objective-C</a> and <a href="https://www.bignerdranch.com/we-write/cocoa-programming/">Cocoa</a> books and while they were very good, and I learnt loads, I should’ve made some toy applications by myself before tackling it.</p>
<p>In short, it would have been a GUI application that created both preset and custom batches of InDesign documents and changed certain elements on those pages (dates, page numbers), with the user having the ability to change those presets.</p>
<p>One of the biggest hurdles was working with AppleScript from Cocoa. I had to <a href="https://gist.github.com/robjwells/9d1480e4b7a1a8312eca">define a category on NSAppleScript</a> to make bearable calling AppleScript handlers (from a compiled <code>.scpt</code> file used as a library). And this was my first attempt at a Cocoa programme without the help of the BNR books! It was a mess (that category is a mess, but it does work) and I got discouraged.</p>
<p>But when I come back to it, that will be the way I’ll do it, because the other options are so poor.</p>
<p>A “native” Cocoa option is Scripting Bridge. It <a href="https://developer.apple.com/library/mac/releasenotes/ScriptingAutomation/RN-ScriptingBridge/">hasn’t been updated since 10.6</a>, but so what? If it works, it works. It doesn’t work. The generated header for InDesign is 10MB and Xcode hangs when you try to open it. The thousands of enums, typedefs, interfaces, methods and properties even bring BBEdit to its knees when you try to use the function menu or “Named Symbol…” browser.</p>
<p>Well, OK, let’s settle for not being able to properly browse the header, and just include it and poke around. Nope! Xcode won’t compile with it included (because of about 20 errors, mostly “duplicate” definitions that come from flattening InDesign’s enormous scripting dictionary).</p>
<p>Now let’s look at the two JavaScript options: InDesign’s built-in JavaScript interpreter and JavaScript for Automation, introduced at last year’s WWDC. Both Adobe’s ExtendScript Toolkit and Script Editor don’t provide the kind of support you need to navigate the complex object model. We also have the problem of trying to pass arguments to the built-in JavaScript interpreter from Cocoa.</p>
<p>JavaScript for Automation meanwhile has poor documentation. It’s not clear to me how to achieve the same results I do in AppleScript with JavaScript. (What’s <code>.get()</code> all about?) There’s no interface to call such scripts from Cocoa. And the <a href="https://developer.apple.com/library/prerelease/mac/releasenotes/InterapplicationCommunication/RN-JavaScriptForAutomation/Articles/OSX10-11.html">preliminary change notes for OS X 10.11</a> don’t contain any significant changes.</p>
<p>What a mess. Automation is crucial for our work, and solves so many of our problems. But the existing technologies have so many sharp edges and the “new” one, JavaScript for Automation, is not anything close to the fresh start that might reinvigorate things.</p>
<p>This year’s WWDC talk on automation was <a href="https://developer.apple.com/videos/wwdc/2015/?id=306">Supporting the Enterprise with OS X Automation</a>. At the start, Sal Soghoian — Mr Automation at Apple — says:</p>
<blockquote>
<p>Some days I feel like I’m a dinosaur looking for a tar pit</p>
</blockquote>
<p>It’s not looking good.</p>
  </article>
  <article>
    <header>
      <h2 class="mute-links"><a href="https://robjwells.github.io/2015/07/the-automation-paradox-at-work/">The automation paradox at work</a></h2>
      <p><time datetime="2015-07-02T13:19">Thursday, July 2 2015</time></p>
    </header>
    <p>A couple of great recent episodes of <a href="http://99percentinvisible.org/">99% invisible</a> (<a href="http://99percentinvisible.org/episode/children-of-the-magenta-automation-paradox-pt-1/">one</a>, <a href="http://99percentinvisible.org/episode/johnnycab-automation-paradox-pt-2/">two</a>) tackle the "automation paradox", where the increased use of automation leaves people unable to perform the task themselves.</p>
<p>The <a href="http://99percentinvisible.org/episode/children-of-the-magenta-automation-paradox-pt-1/">first episode</a> uses the <a href="https://en.wikipedia.org/wiki/Air_France_Flight_447?wprov=sfti1">Air France Flight 447 crash</a> as a hook to investigate the phenomenon:</p>
<blockquote>
<p>The automated system suddenly shut off, and the pilots were left surprised, confused and ultimately unable to fly their own plane.</p>
</blockquote>
<p>In a much less serious way, it got me thinking about the tools I've made for work. Nothing is so critical that its failure will dump the paper into the ocean but there are things that we rely on to get the paper out every day, including scripts to:</p>
<ul>
<li><a href="https://github.com/robjwells/feral-four">Make the InDesign page files</a></li>
<li><a href="https://bitbucket.org/robjwells/ms-python-weather/src/">Set the weather forecast</a></li>
<li><a href="https://gist.github.com/robjwells/5032356">Fix common problems in reporters' copy</a></li>
<li><a href="https://bitbucket.org/robjwells/matchday/src">Scrape football match listings and results</a></li>
<li><a href="https://gist.github.com/robjwells/d601a0aad80f487014d9">Format phone numbers</a></li>
<li><a href="https://github.com/robjwells/ms-pdf-export">Export files ready for the printers and the web</a></li>
<li>Automatically upload a day's worth of PDFs to our archive contractor</li>
</ul>
<p>Most of this stuff could be done by hand. Most of it is pretty straightforward. The risk isn't really in the automation breaking, but in the automation breaking and having no-one to fix it.</p>
<p>We don't hire for the skills to do these things, and the complexity of our workflow has changed with the technical ability of individual staff members.</p>
<p>I don't know how best to cope with this. If, say, I get hit by a bus tomorrow, what do other people need to know? What things wouldn't even occur to them that they need to know about?</p>
<p>Should I draw up emergency guides, some kind of <a href="https://upload.wikimedia.org/wikipedia/commons/f/fc/Dr._Strangelove_-_Wing_Attack_Plan_R.png">Plan R</a>? What about the code itself needs changing? (God help me, no-one else should be exposed to the horrible mess that is the <a href="https://github.com/robjwells/feral-four/blob/Illadelph/core.applescript">page generator script</a>.)</p>
  </article>
  <article>
    <header>
      <h2 class="mute-links"><a href="https://robjwells.github.io/2015/06/you-should-be-using-docopt/">You should be using docopt</a></h2>
      <p><time datetime="2015-06-30T12:21">Tuesday, June 30 2015</time></p>
    </header>
    <p>If you write any command-line tools that have a need for a help message, then you should really try <a href="http://docopt.org">docopt</a>, which gets you out of having to write argument-parsing code yourself. I’ve mentioned it before, <a href="/2014/01/hijacking-the-bbc/">briefly</a>, and I wouldn’t want to be without it.</p>
<p>For an example I’m going to pick on Dr Drang, who was unfortunate enough to <a href="http://leancrew.com/all-this/2015/06/weather-history-without-the-web/">post such a script recently</a>. Sorry!</p>
<p>Take a look at his original help message, and then check out the following:</p>
<pre><code>Return NCDC weather report for the given date.

Usage: ncdc [options] DATE

Options:
    -a, --ascii        : return ASCII file instead of HTML
    -d, --daily        : return daily summary instead of hourly reports
    -m, --month        : entire month, not just a single day
    -p, --precip       : precipitation (hourly only, overrides -d)
    -s, --station STA  : the station abbreviation [default: ORD]
                         O'Hare     ORD
                         Midway     MDW
                         Palwaukee  PWK
                         Aurora     ARR
                         Waukegan   UGN
                         Lewis      LOT
                         DuPage     DPA
                         Lansing    IGQ
                         Joliet     JOT
                         Kankakee   IKK
                         Gary       GYY
    -h, --help         : print this message</code></pre>


<p>It’s essentially the same, but with a couple of minor changes:</p>
<ul>
<li>The description of the script comes before the usage.</li>
<li>The date argument is now in upper case.</li>
<li>I've added long options to make things a little more readable.</li>
<li>The description of the station option gains <code>[default: ORD]</code>,
    which specifies — shocker — the default value for that option.</li>
</ul>
<p>And here’s the new argument-handling code, to replace lines 54–87 in his script (there’s also the new line <code>from docopt import docopt</code> earlier on):</p>
<div class="syntax"><pre><span></span><span class="c1"># Handle options.</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">docopt</span><span class="p">(</span><span class="n">help</span><span class="p">)</span>
<span class="n">sta</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--station&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
<span class="n">ascii</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--ascii&#39;</span><span class="p">]</span>
<span class="n">month</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--month&#39;</span><span class="p">]</span>
<span class="n">precip</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--precip&#39;</span><span class="p">]</span>
<span class="n">daily</span> <span class="o">=</span> <span class="kc">False</span> <span class="k">if</span> <span class="n">precip</span> <span class="k">else</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--daily&#39;</span><span class="p">]</span>

<span class="n">d</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;DATE&#39;</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>


<p>Provide <code>docopt</code> with your help message and you get back a dictionary. Options that take an argument give you back the argument, the default or None (if you don’t set a default). The switch-type options are booleans, being False if they’re not used.</p>
<p>Calling the script incorrectly prints the basic usage pattern, and <code>docopt</code> gives you the help options for free. (You don’t have to include them in the help message, even, but you should.)</p>
  </article>
  <article>
    <header>
      <h2 class="mute-links"><a href="https://robjwells.github.io/2015/06/applescript-list-gotchas/">AppleScript list gotchas</a></h2>
      <p><time datetime="2015-06-26T12:05">Friday, June 26 2015</time></p>
    </header>
    <p>At work recently I ran into two subtle AppleScript oddities that tripped me up when modifying one of our production scripts.</p>
<h3>Return value could be a string or a list</h3>
<p>This may be specific to InDesign but I'd be surprised (I haven't checked). When asking for:</p>
<div class="syntax"><pre><span></span><span class="k">get</span> <span class="nb">the</span> <span class="na">contents</span> <span class="k">of</span> <span class="nb">text</span> <span class="nv">frame</span> <span class="nv">frame_name</span> <span class="k">of</span> <span class="nv">page</span> <span class="nv">page_num</span>
</pre></div>


<p>you could receive a string (if there's just one frame with that name) or a list of strings (if there are several).</p>
<p>This causes a problem when you want to compare the result to another string, because AppleScript will silently concatenate the list items and your comparison will fail.</p>
<p>The solution is to cast the result to a list, using <code>as list</code>. If it's already a list it's unchanged, if it's a lone string it's just wrapped in a list.</p>
<h3>AppleScript's for-in may not give you the value</h3>
<p>AppleScript lets you do the following:</p>
<div class="syntax"><pre><span></span><span class="k">repeat</span> <span class="nv">with</span> <span class="nv">element</span> <span class="k">in</span> <span class="nv">the_list</span>
</pre></div>


<p>which assigns (sort of) the elements of the list to the given variable name. Sort of because in some cases you don't get the value represented by <code>element</code>, you get a kind of pointer to the nth item of the list:</p>
<div class="syntax"><pre><span></span><span class="nb">item</span> <span class="nv">n</span> <span class="k">of</span> <span class="p">{...}</span>
</pre></div>


<p>If you have a list of strings, comparing another string to the loop variable will fail, because it's not really a string. The solution is to ask for <code>the contents of element</code> or <code>element as string</code>.</p>
  </article>
  <div class="pagination">
<p class="pagination-older"><a href="https://robjwells.github.io/page-13/">Older posts</a></p><p class="pagination-newer"><a href="https://robjwells.github.io/page-11/">Newer posts</a></p>  </div>

</main>

<footer class="site-footer">
  <small class="mute-links">
    This work is licensed under a
    <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">
    Creative Commons Attribution 4.0 International License</a>.
  </small>
</footer> <!-- .site-footer -->

</div> <!-- .wrapper -->

</body>

</html>