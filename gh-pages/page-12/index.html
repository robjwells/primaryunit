<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Primary Unit mirror on GitHub – page 12</title>

  <!-- Load my combined stylesheet -->
  <link rel="stylesheet" href="/resources/all.min.css">


  <link rel="license" href="https://creativecommons.org/licenses/by/4.0/">

  <link rel="alternate" type="application/rss+xml" title="RSS feed for Primary Unit" href="/rss">
  <link rel="alternate" type="application/json" title="JSON feed for Primary Unit" href="/feed.json">

  <!-- Apple pinned sites icon, Apple touch icon, Favicon -->
  <link rel="mask-icon" href="/resources/favicon.svg" color="#1369BF">
  <link rel="apple-touch-icon-precomposed" href="/resources/favicon.png">
  <link rel="icon" href="/resources/favicon.ico">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="A mirror of https://www.robjwells.com hosted on GitHub">
</head>

<body>

<div class="wrapper">

<header class="site-header">

  <div class="site-title-container mute-links">
    <h1 class="site-title"><a href="https://robjwells.github.io">Primary Unit mirror on GitHub</a></h1>
    <p class="site-byline"><i>by</i> Rob Wells</p>
  </div>

  <div class="site-menu-container">

    <nav id="site-nav">
      <ul class="site-links mute-links">
        <li><a href="/about/">About</a></li>
        <li><a href="/archives/">Archives</a></li>
        <li><a href="/feed.json">JSON&nbsp;feed</a></li>
        <li><a href="/rss">RSS&nbsp;feed</a></li>
      </ul>
    </nav>

    <label for="search-field" class="site-search-label">
      Site search
    </label>
    <form id="site-search" class="site-search" method="get" action="https://duckduckgo.com/">
      <input name="q" type="text" id="search-field" class="search-field" placeholder="via DuckDuckGo">
      <input name="sites" value="https://robjwells.github.io" hidden>
      <button type="submit" class="search-button">Search</button>
    </form>

  </div> <!-- .site-menu-container -->

</header> <!-- .site-header -->

<main role="main">

  <article>
    <header>
      <h2 class="mute-links"><a href="https://robjwells.github.io/2015/07/a-scripting-mess/">A scripting mess</a></h2>
      <p><time datetime="2015-07-05T16:52">Sunday, July 5 2015</time></p>
    </header>
    <p>I was thinking about redoing the <a href="https://github.com/robjwells/feral-four/blob/Illadelph/core.applescript">page generator script</a> for work again this morning, wondering if the newly widespread support for JavaScript in Cocoa applications and JavaScript for Automation would simplify some of the work I started on a Cocoa page-generating application.</p>
<p>The short answer is No. In fact I’m more disheartened at the state of inter-application scripting now than I was a year ago.</p>
<p>I began working on the application in January 2014, but hadn’t touched the project since last June. I got a bit bogged down with it, and it was by far too big a project to start with; I’d just finished the Big Nerd Ranch <a href="https://www.bignerdranch.com/we-write/objective-c-programming/">Objective-C</a> and <a href="https://www.bignerdranch.com/we-write/cocoa-programming/">Cocoa</a> books and while they were very good, and I learnt loads, I should’ve made some toy applications by myself before tackling it.</p>
<p>In short, it would have been a GUI application that created both preset and custom batches of InDesign documents and changed certain elements on those pages (dates, page numbers), with the user having the ability to change those presets.</p>
<p>One of the biggest hurdles was working with AppleScript from Cocoa. I had to <a href="https://gist.github.com/robjwells/9d1480e4b7a1a8312eca">define a category on NSAppleScript</a> to make bearable calling AppleScript handlers (from a compiled <code>.scpt</code> file used as a library). And this was my first attempt at a Cocoa programme without the help of the BNR books! It was a mess (that category is a mess, but it does work) and I got discouraged.</p>
<p>But when I come back to it, that will be the way I’ll do it, because the other options are so poor.</p>
<p>A “native” Cocoa option is Scripting Bridge. It <a href="https://developer.apple.com/library/mac/releasenotes/ScriptingAutomation/RN-ScriptingBridge/">hasn’t been updated since 10.6</a>, but so what? If it works, it works. It doesn’t work. The generated header for InDesign is 10MB and Xcode hangs when you try to open it. The thousands of enums, typedefs, interfaces, methods and properties even bring BBEdit to its knees when you try to use the function menu or “Named Symbol…” browser.</p>
<p>Well, OK, let’s settle for not being able to properly browse the header, and just include it and poke around. Nope! Xcode won’t compile with it included (because of about 20 errors, mostly “duplicate” definitions that come from flattening InDesign’s enormous scripting dictionary).</p>
<p>Now let’s look at the two JavaScript options: InDesign’s built-in JavaScript interpreter and JavaScript for Automation, introduced at last year’s WWDC. Both Adobe’s ExtendScript Toolkit and Script Editor don’t provide the kind of support you need to navigate the complex object model. We also have the problem of trying to pass arguments to the built-in JavaScript interpreter from Cocoa.</p>
<p>JavaScript for Automation meanwhile has poor documentation. It’s not clear to me how to achieve the same results I do in AppleScript with JavaScript. (What’s <code>.get()</code> all about?) There’s no interface to call such scripts from Cocoa. And the <a href="https://developer.apple.com/library/prerelease/mac/releasenotes/InterapplicationCommunication/RN-JavaScriptForAutomation/Articles/OSX10-11.html">preliminary change notes for OS X 10.11</a> don’t contain any significant changes.</p>
<p>What a mess. Automation is crucial for our work, and solves so many of our problems. But the existing technologies have so many sharp edges and the “new” one, JavaScript for Automation, is not anything close to the fresh start that might reinvigorate things.</p>
<p>This year’s WWDC talk on automation was <a href="https://developer.apple.com/videos/wwdc/2015/?id=306">Supporting the Enterprise with OS X Automation</a>. At the start, Sal Soghoian — Mr Automation at Apple — says:</p>
<blockquote>
<p>Some days I feel like I’m a dinosaur looking for a tar pit</p>
</blockquote>
<p>It’s not looking good.</p>
  </article>
  <article>
    <header>
      <h2 class="mute-links"><a href="https://robjwells.github.io/2015/07/the-automation-paradox-at-work/">The automation paradox at work</a></h2>
      <p><time datetime="2015-07-02T13:19">Thursday, July 2 2015</time></p>
    </header>
    <p>A couple of great recent episodes of <a href="http://99percentinvisible.org/">99% invisible</a> (<a href="http://99percentinvisible.org/episode/children-of-the-magenta-automation-paradox-pt-1/">one</a>, <a href="http://99percentinvisible.org/episode/johnnycab-automation-paradox-pt-2/">two</a>) tackle the "automation paradox", where the increased use of automation leaves people unable to perform the task themselves.</p>
<p>The <a href="http://99percentinvisible.org/episode/children-of-the-magenta-automation-paradox-pt-1/">first episode</a> uses the <a href="https://en.wikipedia.org/wiki/Air_France_Flight_447?wprov=sfti1">Air France Flight 447 crash</a> as a hook to investigate the phenomenon:</p>
<blockquote>
<p>The automated system suddenly shut off, and the pilots were left surprised, confused and ultimately unable to fly their own plane.</p>
</blockquote>
<p>In a much less serious way, it got me thinking about the tools I've made for work. Nothing is so critical that its failure will dump the paper into the ocean but there are things that we rely on to get the paper out every day, including scripts to:</p>
<ul>
<li><a href="https://github.com/robjwells/feral-four">Make the InDesign page files</a></li>
<li><a href="https://bitbucket.org/robjwells/ms-python-weather/src/">Set the weather forecast</a></li>
<li><a href="https://gist.github.com/robjwells/5032356">Fix common problems in reporters' copy</a></li>
<li><a href="https://bitbucket.org/robjwells/matchday/src">Scrape football match listings and results</a></li>
<li><a href="https://gist.github.com/robjwells/d601a0aad80f487014d9">Format phone numbers</a></li>
<li><a href="https://github.com/robjwells/ms-pdf-export">Export files ready for the printers and the web</a></li>
<li>Automatically upload a day's worth of PDFs to our archive contractor</li>
</ul>
<p>Most of this stuff could be done by hand. Most of it is pretty straightforward. The risk isn't really in the automation breaking, but in the automation breaking and having no-one to fix it.</p>
<p>We don't hire for the skills to do these things, and the complexity of our workflow has changed with the technical ability of individual staff members.</p>
<p>I don't know how best to cope with this. If, say, I get hit by a bus tomorrow, what do other people need to know? What things wouldn't even occur to them that they need to know about?</p>
<p>Should I draw up emergency guides, some kind of <a href="https://upload.wikimedia.org/wikipedia/commons/f/fc/Dr._Strangelove_-_Wing_Attack_Plan_R.png">Plan R</a>? What about the code itself needs changing? (God help me, no-one else should be exposed to the horrible mess that is the <a href="https://github.com/robjwells/feral-four/blob/Illadelph/core.applescript">page generator script</a>.)</p>
  </article>
  <article>
    <header>
      <h2 class="mute-links"><a href="https://robjwells.github.io/2015/06/you-should-be-using-docopt/">You should be using docopt</a></h2>
      <p><time datetime="2015-06-30T12:21">Tuesday, June 30 2015</time></p>
    </header>
    <p>If you write any command-line tools that have a need for a help message, then you should really try <a href="http://docopt.org">docopt</a>, which gets you out of having to write argument-parsing code yourself. I’ve mentioned it before, <a href="/2014/01/hijacking-the-bbc/">briefly</a>, and I wouldn’t want to be without it.</p>
<p>For an example I’m going to pick on Dr Drang, who was unfortunate enough to <a href="http://leancrew.com/all-this/2015/06/weather-history-without-the-web/">post such a script recently</a>. Sorry!</p>
<p>Take a look at his original help message, and then check out the following:</p>
<pre><code>Return NCDC weather report for the given date.

Usage: ncdc [options] DATE

Options:
    -a, --ascii        : return ASCII file instead of HTML
    -d, --daily        : return daily summary instead of hourly reports
    -m, --month        : entire month, not just a single day
    -p, --precip       : precipitation (hourly only, overrides -d)
    -s, --station STA  : the station abbreviation [default: ORD]
                         O'Hare     ORD
                         Midway     MDW
                         Palwaukee  PWK
                         Aurora     ARR
                         Waukegan   UGN
                         Lewis      LOT
                         DuPage     DPA
                         Lansing    IGQ
                         Joliet     JOT
                         Kankakee   IKK
                         Gary       GYY
    -h, --help         : print this message</code></pre>


<p>It’s essentially the same, but with a couple of minor changes:</p>
<ul>
<li>The description of the script comes before the usage.</li>
<li>The date argument is now in upper case.</li>
<li>I've added long options to make things a little more readable.</li>
<li>The description of the station option gains <code>[default: ORD]</code>,
    which specifies — shocker — the default value for that option.</li>
</ul>
<p>And here’s the new argument-handling code, to replace lines 54–87 in his script (there’s also the new line <code>from docopt import docopt</code> earlier on):</p>
<pre><code># Handle options.
args = docopt(help)
sta = args['--station'].upper()
ascii = args['--ascii']
month = args['--month']
precip = args['--precip']
daily = False if precip else args['--daily']

d = parse(args['DATE'], dayfirst=False)</code></pre>


<p>Provide <code>docopt</code> with your help message and you get back a dictionary. Options that take an argument give you back the argument, the default or None (if you don’t set a default). The switch-type options are booleans, being False if they’re not used.</p>
<p>Calling the script incorrectly prints the basic usage pattern, and <code>docopt</code> gives you the help options for free. (You don’t have to include them in the help message, even, but you should.)</p>
  </article>
  <article>
    <header>
      <h2 class="mute-links"><a href="https://robjwells.github.io/2015/06/applescript-list-gotchas/">AppleScript list gotchas</a></h2>
      <p><time datetime="2015-06-26T12:05">Friday, June 26 2015</time></p>
    </header>
    <p>At work recently I ran into two subtle AppleScript oddities that tripped me up when modifying one of our production scripts.</p>
<h3>Return value could be a string or a list</h3>
<p>This may be specific to InDesign but I'd be surprised (I haven't checked). When asking for:</p>
<pre><code>get the contents of text frame frame_name of page page_num</code></pre>


<p>you could receive a string (if there's just one frame with that name) or a list of strings (if there are several).</p>
<p>This causes a problem when you want to compare the result to another string, because AppleScript will silently concatenate the list items and your comparison will fail.</p>
<p>The solution is to cast the result to a list, using <code>as list</code>. If it's already a list it's unchanged, if it's a lone string it's just wrapped in a list.</p>
<h3>AppleScript's for-in may not give you the value</h3>
<p>AppleScript lets you do the following:</p>
<pre><code>repeat with element in the_list</code></pre>


<p>which assigns (sort of) the elements of the list to the given variable name. Sort of because in some cases you don't get the value represented by <code>element</code>, you get a kind of pointer to the nth item of the list:</p>
<pre><code>item n of {...}</code></pre>


<p>If you have a list of strings, comparing another string to the loop variable will fail, because it's not really a string. The solution is to ask for <code>the contents of element</code> or <code>element as string</code>.</p>
  </article>
  <article>
    <header>
      <h2 class="mute-links"><a href="https://robjwells.github.io/2015/02/my-email-nightmare/">My email nightmare</a></h2>
      <p><time datetime="2015-02-25T12:35">Wednesday, February 25 2015</time></p>
    </header>
    <p>At work we have about 40 employees. A couple of weeks ago I moved our email to a new provider (<a href="https://fastmail.com">FastMail</a>). It took a while to get to but most of the activity was extremely concentrated, and that led me to make some mistakes. However, the move was successful, and hopefully my experience can smooth the way for people in a similar situation.</p>
<h3>Background</h3>
<p>From what I can tell, we’d been running our email through cPanel on a <a href="https://ukwebsolutionsdirect.co.uk">shared host</a> since 2003. (I was hired in 2010 and this became my responsibility in May 2014.)</p>
<p>It wasn’t really an appropriate choice for a business. We had a small amount of space (9GB) shared between all employees. When users (or the entire account) exceeded their quota, the software would bounce incoming emails and send a shaming email to senders. Lots of simple things (holiday automatic replies) required my involvement.</p>
<p>In addition, our domain’s DNS records were also managed through cPanel, tying the settings for our domain to our host (who were also our registrar at this point, so not totally unreasonable).</p>
<p>The host wasn’t great either.</p>
<ul>
<li>To use SSL encryption, our email clients had to point to their server (not our own domain). This isn't a problem, except that one weekday afternoon in November they moved us to a different server without warning, breaking our email clients.</li>
<li>Our contacts, using major webmail services, would sometimes have their provider refuse to send mail to us because our shared server had been placed on a <a href="https://en.wikipedia.org/wiki/DNSBL">blackhole list</a>.</li>
<li>Five failed login attempts within two minutes would trigger an IP block. Starting an email client and, wondering why nothing’s happening, pressing the check mail button twice would shut down one of our two office lines. (POP/IMAP &amp; SMTP authentication counted as separate attempts.)</li>
</ul>
<p>That last one was really fun in combination with the November server move, as I went round the office changing people’s email settings. Their support workers, however, were helpful.</p>
<p>And about two-thirds of our employees were accessing their email over POP, with nothing stored on our server.</p>
<p>We were in a pretty bad state. (Hopefully little of this sounds familiar to you.)</p>
<h3>Preparation</h3>
<p>The biggest task before the switch itself was to move everyone using POP to access their mail to IMAP, otherwise when it came time to do the migration there’d be nothing to move across. They’d have to keep the old POP account in their client forever to be able to access old mail (one remote worker has had to do this because they couldn’t manage to set up IMAP access to their account in <a href="https://en.wikipedia.org/wiki/Microsoft_Entourage">Entourage</a>, their version of which is <a href="https://en.wikipedia.org/wiki/Microsoft_Office#Microsoft_Office_2001_and_v._X">old and busted</a>).</p>
<p>For machines you can access personally this is fairly straightforward but dull. You generally can’t convert a client account from POP to IMAP, so set up a parallel account in the client and move messages into the IMAP version’s folders. If you have people using Entourage X or 2004 beware that moving messages between accounts will not preserve the original received date. I was moving everyone to Apple Mail — the only OS X client I’m going to support — and had to change the date column to use <em>date sent</em>.</p>
<p>With remote workers you’re reliant on their technical skills and your ability to give instructions. For non-technical users think seriously about having them keep a disabled POP account as an archive (as mentioned above) as it may not be worth hours of your time trying to guide them on to IMAP.</p>
<p>Ensure that your DNS settings are in a state where all that’s needed to do is to flip the MX records during the transition. You want to be able to pull the plug on your old provider without the world stopping. In our case, I transferred our domain to <a href="https://www.hover.com">Hover</a> and recreated the records. (cPanel stores MX and other records separately.)</p>
<p>You’ll obviously need to draw up a list of accounts that’ll need creating at the new provider, which will give you a chance to rationalise your usage. This is particularly important when moving to a provider that charges per account (as FastMail and seemingly everyone else does). FastMail has a CSV import feature which will let you create many accounts in one step. (I just used regex in BBEdit to transform a simple list into the required format.)</p>
<p>In our case, the biggest change was the ability to create aliases. So instead of five separate arts desk accounts we now have one main account, with aliases filing mail into subfolders. Combined with pruning unnecessary accounts, this meant I was able to almost halve the number we needed.</p>
<p>Aliases also let me clean up our unpredictable account names, so that everyone is now firstnamesurname@, while ensuring that all mail sent to the old addresses ends up in the right place.</p>
<p>You can get started on this list at any point, and it was one of the first things that I did after getting approval. But as you approach D-Day you need to <em>make sure that the list is up to date</em>. I failed to do this and, while it didn't cause major problems, it caused me to panic a bit as I scrambled to get the missing accounts up and running.</p>
<h3>Transition</h3>
<p>It will benefit you greatly if you draw up a plan for the transition. That includes choosing a D-Day, and detailing what actions you are going to perform and in which order. My biggest mistake was to let a worsening of the problems detailed above force my hand and act hastily. Do everything you can to avoid this and work according to plan.</p>
<p>Your D-Day list should include:</p>
<ol>
<li>Business sign-up and payment. (You may be ready but is the person with the company card?)</li>
<li>User account creation. (Double-check you're not missing any.)</li>
<li>User migration and client settings switch. (You can’t split these.)</li>
<li>MX record switch.</li>
</ol>
<p>1 &amp; 2 are straightforward, although after the second you may want to spend some time cleaning up autofilled names for non-personal accounts (Ms Acme C Department) and corresponding global address book entries.</p>
<p>You’ll need to decide on a migration strategy. <a href="https://www.fastmail.com/help/business/migrate.html">The FastMail help</a> for this is very good. For any sizeable number of accounts you’ll want the second option: set up the accounts then for each user set up forwarding at the old provider, migrate existing mail and then change the user’s settings.</p>
<p>As soon as you enable forwarding for a user the clock is ticking for you to change the user’s settings. Perform the IMAP migration and the clock ticks faster. The longer you wait the more the user’s new account will diverge from the old one.</p>
<p>This is where I made <em>by far my biggest mistake</em>, one which forced me to work through the night to complete the switchover. I set up forwarding for and migrated each user in one block, without changing any client settings. If I hadn’t then spent hours changing everyone’s client settings I would have had to purge the accounts and start over with the IMAP migration. That’s a pain because after each import  for each account you’ll probably have to do some housekeeping (moving sent mail into FastMail’s sent folder, junk to junk, and so on).</p>
<p>Note the order of actions on <a href="https://www.fastmail.com/help/business/migrate.html">the FastMail help page</a>:</p>
<ol>
<li>Forward the user’s new mail,</li>
<li>Migrate the user’s existing mail,</li>
<li>Change the user’s settings,</li>
<li>Then <em>and only then</em> move on to the next user.</li>
</ol>
<p>Completely moving a user allows you to take as long as you need to complete the whole transition. Given other pressures on me at work, it’s likely that it would’ve taken weeks to move everyone. Making this mistake at least forced me to complete the entire thing quickly, even if it meant working a 19-hour shift. (I started working on the emails in earnest after a full day working on edition.)</p>
<p>If you have remote workers you’ll need a strategy for them too. Mine was to send them all emails (to their personal accounts) containing a warning that their mail clients would be broken, new settings if they felt comfortable enough changing them, and instructions on how to access the web interface.</p>
<p>Once you’ve got everyone moved over, flip the switch on the MX records so that new mail flows directly to the new provider.</p>
<h4>Aside: hosting your DNS with FastMail</h4>
<p>FastMail encourages you to host your DNS with them. I haven’t done it for <code>robjwells.com</code> or work because I feel that there should be a separation there (DNS settings stay with <a href="https://www.hover.com">the registrar</a>) and I’m not intimidated by DNS records (although they’re a massive pain).</p>
<p>But if, say, <a href="http://daveplummer.net">my stepdad</a> wanted email for <a href="http://daveplummer.net">his business</a> I’d tell him to let FastMail handle his DNS settings. If I leave the Star I may switch the DNS to FastMail if there’s no-one sufficiently technical to take over from me.</p>
<p>I did briefly switch work to use FastMail’s DNS two nights ago, to see if it enabled automatic configuration in Apple Mail or Thunderbird. No difference. (Our domain publishes SRV records that are meant to help with this and I thought I might have made a mistake, but no dice with either. Outlook may be a different story, but as we’re a mostly Mac office who cares?)</p>
<h3>Afterwards</h3>
<p>The actual change in email provider should largely be invisible to your users. Your biggest problem is going to be what I’ll call user education. Some of this will be straightforward. In our case, an example was to get people to check their spam folder (we previously had daily quarantine emails).</p>
<p>But some will be more personal and political. That you won’t set up or support their <a href="https://en.wikipedia.org/wiki/Microsoft_Entourage">terrible email client</a>. That email aliases really do work. That, no, their emails are not mysteriously disappearing.</p>
<p>A nice bonus for me is that I’m now not responsible for fixing whole categories of problems, and I’m <a href="http://blog.fastmail.com/2014/12/01/fastmail-advent-2014/">very confident in the FastMail staff</a>.</p>
<p>But frankly this whole thing has been a nightmare (including writing this damn post, which has taken forever) and it’s a huge relief to have it sorted.</p>
  </article>
  <div class="pagination">
<p class="pagination-older"><a href="https://robjwells.github.io/page-13/">Older posts</a></p><p class="pagination-newer"><a href="https://robjwells.github.io/page-11/">Newer posts</a></p>  </div>

</main>

<footer class="site-footer">
  <small class="mute-links">
    This work is licensed under a
    <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">
    Creative Commons Attribution 4.0 International License</a>.
  </small>
</footer> <!-- .site-footer -->

</div> <!-- .wrapper -->

</body>

</html>