<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Primary Unit mirror on GitHub – page 14</title>

  <!-- Load my combined stylesheet -->
  <link rel="stylesheet" href="/resources/all.min.css">


  <link rel="license" href="https://creativecommons.org/licenses/by/4.0/">

  <link rel="alternate" type="application/rss+xml" title="RSS feed for Primary Unit" href="/rss">
  <link rel="alternate" type="application/json" title="JSON feed for Primary Unit" href="/feed.json">

  <!-- Apple pinned sites icon, Apple touch icon, Favicon -->
  <link rel="mask-icon" href="/resources/favicon.svg" color="#1369BF">
  <link rel="apple-touch-icon-precomposed" href="/resources/favicon.png">
  <link rel="icon" href="/resources/favicon.ico">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="A mirror of https://www.robjwells.com hosted on GitHub">
</head>

<body>

<div class="wrapper">

<header class="site-header">

  <div class="site-title-container mute-links">
    <h1 class="site-title"><a href="https://robjwells.github.io">Primary Unit mirror on GitHub</a></h1>
    <p class="site-byline"><i>by</i> Rob Wells</p>
  </div>

  <div class="site-menu-container">

    <nav id="site-nav">
      <ul class="site-links mute-links">
        <li><a href="/about/">About</a></li>
        <li><a href="/archives/">Archives</a></li>
        <li><a href="/feed.json">JSON&nbsp;feed</a></li>
        <li><a href="/rss">RSS&nbsp;feed</a></li>
      </ul>
    </nav>

    <label for="search-field" class="site-search-label">
      Site search
    </label>
    <form id="site-search" class="site-search" method="get" action="https://duckduckgo.com/">
      <input name="q" type="text" id="search-field" class="search-field" placeholder="via DuckDuckGo">
      <input name="sites" value="https://robjwells.github.io" hidden>
      <button type="submit" class="search-button">Search</button>
    </form>

  </div> <!-- .site-menu-container -->

</header> <!-- .site-header -->

<main role="main">

  <article>
    <header>
      <h2 class="mute-links"><a href="https://robjwells.github.io/2014/12/start-and-end-of-line-shortcuts-in-bbedit/">Start and end of line shortcuts in BBEdit</a></h2>
      <p><time datetime="2014-12-18T00:34">Thursday, December 18 2014</time></p>
    </header>
    <p>I keep BBEdit's option to emulate Emacs key bindings disabled, because I don't know most of them and some of those combinations I want to use for other things.</p>
<p>However, I've been doing more work on the command line recently, and not having ⌃A and ⌃E to move to the start and end of the current line was starting to grate. The cursor keys are just too far away!</p>
<p>So I whipped up some scripts to give me back those shortcuts while keeping the rest of the Emacs stuff disabled.</p>
<h3>Start of line</h3>
<pre><code>set line_start to the characterOffset of line (startLine of the selection)
select insertion point before character line_start</code></pre>


<h3>End of line</h3>
<pre><code>set current_line to line (startLine of the selection)
set end_of_line to ((characterOffset of current_line) + (length of current_line))
select insertion point before character end_of_line</code></pre>


<p>Wrap both of those in:</p>
<pre><code>tell application &quot;BBEdit&quot;
    tell the front text window
        …
    end
end</code></pre>


<p>(omitted above to reduce the amount of scrolling), dump them in ~/Library/Application Support/BBEdit/Scripts/, assign them the ⌃A and ⌃E shortcuts in BBEdit's preferences, and you're all set.</p>
  </article>
  <article>
    <header>
      <h2 class="mute-links"><a href="https://robjwells.github.io/2014/12/solving-boredom-with-four-languages/">Solving boredom with four languages</a></h2>
      <p><time datetime="2014-12-04T00:01">Thursday, December 4 2014</time></p>
    </header>
    <p>At work one of the most tedious jobs is putting all of the stories that appear in the paper onto our website. We're still working from text files (which works very well) as for a number of reasons we haven't yet changed to use the site's CMS as the central location where copy is stored.</p>
<p>So towards the end of the day we have to go through nearly all the pages, strip out the headlines, standfirsts and copy, and input them into the site's backend. It's mindless, slow and frankly demoralising.</p>
<p>A perfect candidate for automation then!</p>
<p>Let's start with taking the text from the InDesign files, with an AppleScript I run through <a href="http://www.red-sweater.com/fastscripts/">FastScripts</a>:</p>
<pre><code>tell application &quot;Adobe InDesign CS5.5&quot;
  tell the front document
    set the_text to get the contents of the selection
  end tell
end tell

repeat with an_item in the_text
  do shell script (&quot;echo '&quot; &amp; an_item &amp; &quot;' &gt;&gt; ~/Desktop/web_strip.txt&quot;)
end repeat

do shell script (&quot;echo '\\n\\n\\n\\n' &gt;&gt; ~/Desktop/web_strip.txt&quot;)</code></pre>


<p>Here we take the content of the selected InDesign frames and use a shell script snippet to append it to a file on the desktop, followed by a bunch of newlines to separate the appended text.</p>
<p>It's straightforward, but <code>the contents of the selection</code> in line 3 could return anything: more than one selected frame and you get a list, just one and you get whatever data is in the frame. So, instead of iterating over several pieces of text in line 7, you iterate over each character in one piece of text. Bonus points: InDesign CS4 (which we use at work) doesn't preserve the order in which you select frames, meaning you have to go one-by-one (and use a different script — I'm showing the one I use at home here).</p>
<p>Ok, now we've got a text file with all the copy in. Once that's been cleaned up — any unnoticed mistakes corrected, print-focussed formatting removed — it's time to enter it into the CMS.</p>
<p>For ages, this is where the automation stopped. The editor used in the CMS interprets pasted text oddly, requiring people to paste the plain text into (shock horror) TextEdit in rich-text mode, and from there into the field in the CMS. Lots of copying and pasting. Lots of boredom. Gross.</p>
<p>But these are just fields on a web page. And, of course, the page uses jQuery. And Safari lets you <code>do JavaScript</code> through AppleScript. This should be trivial. (Chrome also lets you execute JavaScript through AppleScript, but it threw up a weird error that I couldn't be bothered to dig into.)</p>
<p>A bit of poking around in the inspector revealed that most of the interesting fields could be set through a simple <code>.val(foo)</code> on the element, while the body of the article could be set through <code>.html('bar')</code> — and wrapping paragraphs in <code>&lt;p&gt;</code> tags ensured that the text displayed correctly.</p>
<p>But how to get the text from a file in BBEdit into the fields? We need to use AppleScript to tell Safari to execute JavaScript, but you do not want to do any kind of text processing in AppleScript — nor do you really want to do it by hand for tens of articles.</p>
<p>I decided on a Python text filter. Not entirely appropriate — we don't transform and return the text — but it's a dead simple way of working with the selection and removing it once we're done.</p>
<p>Using Python lets us do all sorts of wonderful things too other than just preparing the InDesign text to be entered into the fields. Here's the code, before I dive in any further:</p>
<pre><code>#!/usr/local/bin/python3

import sys
import subprocess

names = {'Morning Star': 4,
         ...
         'A Reporter': 1002,
         }


length_lambdas = {'lead': {'func': lambda l: 300 &lt;= l &lt; 400,
                           'id': 1},
                  '2ndlead': {'func': lambda l: 200 &lt;= l &lt; 300,
                              'id': 2},
                  '150word': {'func': lambda l: 0 &lt; l &lt; 200,
                              'id': 4},
                  'inbrief': {'func': lambda l: False,
                              'id': 5},
                  'splash': {'func': lambda l: 400 &lt;= l,
                             'id': 6},
                  }

# Dr Drang's asrun function
# http://www.leancrew.com/all-this/2013/03/combining-python-and-applescript/
def asrun(ascript):
  &quot;Run the given AppleScript and return the standard output and error.&quot;
  osa = subprocess.Popen(['osascript', '-'],
                          stdin=subprocess.PIPE,
                          stdout=subprocess.PIPE,
                          stderr=subprocess.DEVNULL)
  return osa.communicate(ascript.encode())[0]


text = sys.stdin.read().strip()
head, standfirst, author, body = text.split('\n', maxsplit=3)
if not standfirst:
  standfirst = ' '           # Required. Don't ask
if not author.strip():
  author = 'Morning Star'
else:
  author = author.split('by ', maxsplit=1)[-1]
name_id = names.get(author, 4)
words = len(body.split())
for v in length_lambdas.values():
  if v['func'](words):
    length_id = (v['id'])

wrapped_body = '&lt;p&gt;' + '&lt;/p&gt;&lt;p&gt;'.join(body.splitlines()) + '&lt;/p&gt;'


script = &quot;&quot;&quot;
tell application &quot;Safari&quot;
  tell the front document
    set js_head to &quot;$('#articleInputTitle').val('{head}')&quot;
    set js_standfirst to &quot;$('#articleTextareaSummery').val('{standfirst}')&quot;
    set js_body to &quot;$('#articleTextareaContent_ifr').contents().find('#tinymce').html('{body}')&quot;
    set js_length to &quot;$('#articleSelectPosition').val({length})&quot;
    set js_author to &quot;$('#articleSelectAuthor').val({author})&quot;
    do JavaScript js_head
    do JavaScript js_standfirst
    do JavaScript js_body
    do JavaScript js_length
    do JavaScript js_author
  end tell
end tell
&quot;&quot;&quot;.format(head=head, standfirst=standfirst, body=wrapped_body,
           length=length_id, author=name_id)

asrun(script)
print('', end='')</code></pre>


<p>I like to put data at the top of my scripts and the code beneath, so let's start on line 35, where we read in the text from BBEdit. Line 36 breaks that text apart: I use a four-part structure, where the first line is the headline, then the standfirst and byline (both of which can be blank) and then any remaining lines form the body.</p>
<p>In line 43 we index into the names dictionary (abbreviated to protect the guilty, lines 6–9) using the cleaned-up byline, with 4 the value for the default author. This and the story type stuff below are presented as drop-down menus, which is where the integers come from.</p>
<p>Next we crudely count the words in the body to work out the story type, which are roughly differentiated by length. I iterate over a dictionary of lambdas instead of a lengthy <code>if-elif</code> block, mostly because it lets me use the dictionary keys to store the strings associated with the values. (You could do the same with comments in the <code>if-else</code>. I don't think there's a big advantage to either method.)</p>
<p>Note that the lambda for the 'inbrief' type just returns False. We collect all of the brief stories into a single article on the web, with the total length anything from 100 words to over 600, and I couldn't think of an easy way to pick them out. I set the type for briefs by hand.</p>
<p>The last processing step is to wrap each line of the body with paragraph tags. (It's basic but it works!)</p>
<p>Then we format a string containing the AppleScript, which runs the JavaScript, and pass it to Dr Drang's <a href="http://www.leancrew.com/all-this/2013/03/combining-python-and-applescript/">asrun function</a> for execution.</p>
<p>And finally we print an empty string to delete the current selection in BBEdit — time to move on to the next story.</p>
<p>By using this script and opening up a dozen or two 'new article' tabs in Safari, moving between each one and using the text filter to populate the fields, I can effectively do work in parallel instead of one task at a time — filling in new articles while I wait for the website to catch up and show the publishing time options. And no more copy &amp; paste from TextEdit.</p>
  </article>
  <article>
    <header>
      <h2 class="mute-links"><a href="https://robjwells.github.io/2014/04/mano-al-teclado/">Mano-al-teclado</a></h2>
      <p><time datetime="2014-04-14T23:09">Monday, April 14 2014</time></p>
    </header>
    <p>In a <a href="http://www.leancrew.com/all-this/2014/04/man-page-followup/">follow-up</a> to his <a href="http://www.leancrew.com/all-this/2014/04/oh-man/">man page post</a>, Dr Drang writes that he suspects the people who responded with keyboard-centric methods “were all slightly appalled by the notion of using the mouse or trackpad to bring up a man page.”</p>
<p>No such dismay here. While I generally prefer to keep my hands on the keyboard there are often cases when using the mouse is easier or faster, as explained in the <a href="http://www.asktog.com/TOI/toi06KeyboardVMouse1.html">Bruce Tognazzini article</a> Dr Drang quotes.</p>
<p>Not all keyboard shortcuts are created equal. In my <a href="/2013/11/die-bookmarks-bar-die/">bookmarks bar post</a> I threw out one lot for another, as it was difficult to remember the shortcut for a particular function even though the key combinations were simple (<code>⌘-[1-9]</code>). This led to the situation Tog describes: it took longer to remember the shortcut than it would to use the mouse.</p>
<blockquote>
<p>It takes two seconds to decide upon which special-function key to press.
Deciding among abstract symbols is a high-level cognitive function.
Not only is this decision not boring, the user actually experiences amnesia!
Real amnesia!</p>
</blockquote>
<p>But I think indexes such as <a href="http://www.obdev.at/products/launchbar/index.html">LaunchBar</a> (or <a href="http://help.adobe.com/en_US/indesign/cs/using/WSa285fff53dea4f8617383751001ea8cb3f-6e68a.html#WSE4179F8F-7053-48b4-BFDC-2102D5F27789">InDesign’s quick apply panel</a>) sidestep the problem. Here’s what Tog says about mouse users:</p>
<blockquote>
<p>They have not had to set their task aside to think about or remember abstract symbols.</p>
</blockquote>
<p>That’s remarkably similar to using indexes: after typing a simple shortcut (<code>⌘-Space</code>, <code>⌘-↩</code>) to bring up the panel, a user just has to type their intent. I suspect that cuts down on the decision time substantially.</p>
  </article>
  <article>
    <header>
      <h2 class="mute-links"><a href="https://robjwells.github.io/2014/04/broken-mercurial-dummy-cacerts/">Broken Mercurial dummy cacerts</a></h2>
      <p><time datetime="2014-04-13T09:37">Sunday, April 13 2014</time></p>
    </header>
    <p>When I tried to push <a href="/2014/04/manhandled/">my last post</a> to Bitbucket I received this ugly error:</p>
<pre><code>abort: error: _ssl.c:507: error:14090086:SSL
routines:SSL3_GET_SERVER_CERTIFICATE:certificate verify failed</code></pre>


<p>Gross as it is, the message is straightforward: the SSL certificate failed to verify. I imagine the root cause is the whole <a href="http://heartbleed.com">OpenSSL mess</a> and everyone reissuing their certificates, but it posed an immediate practical local problem: I couldn’t push to my source control.</p>
<p>Git(hub) seemed to be fine, but any Mercurial commands involving the network — either trying to connect to Bitbucket or Kiln — would fail.</p>
<p>The culprit turned out to be this line in my <code>~/.hgrc</code>:</p>
<pre><code>[web]
cacerts = /etc/hg-dummy-cert.pem</code></pre>


<p>Which, as dumb as it looks, is the <a href="http://mercurial.selenic.com/wiki/CACertificates#Mac_OS_X_10.6_and_higher">recommended way</a> to enable certificate checking through the system keychain.</p>
<p>Regenerating the permissions file didn’t help. Maybe this approach will work again in the future, once the wave of reissued certificates has broken, but for now there’s a straightforward solution:</p>
<ol>
<li>Remove the <code>cacerts</code> line from your <code>hgrc</code>;</li>
<li>Use a Mercurial command such as <code>hg incoming</code> that causes it to wail about
    a server’s certificate not being verified;</li>
<li>Using the details from that message, add a <a href="http://www.selenic.com/mercurial/hgrc.5.html#hostfingerprints"><code>hostfingerprints</code></a>
    section to your <code>hgrc</code>;</li>
<li>Repeat with each server you connect to.</li>
</ol>
<p>You should end up with something like this:</p>
<pre><code>[hostfingerprints]
bitbucket.org = 45:AD:AE:1A:CF:0E:73:47…
robjwells.kilnhg.com = c3:83:2c:5a:2d:0…</code></pre>


<p>See <a href="http://blog.bitbucket.org/2014/04/08/bitbuckets-ssl-certificates-are-changing/">Bitbucket’s post</a> for a few more details.</p>
  </article>
  <article>
    <header>
      <h2 class="mute-links"><a href="https://robjwells.github.io/2014/04/manhandled/">Manhandled</a></h2>
      <p><time datetime="2014-04-13T09:03">Sunday, April 13 2014</time></p>
    </header>
    <p><a href="http://www.leancrew.com/all-this/2014/04/oh-man/">Dr Drang</a> and <a href="http://nathangrigg.net/2014/04/zsh-push-line-or-edit/">Nathan</a> have both written recently about bringing up a man page for reference while typing a command in the terminal. I’ve two approaches to share, but unlike Nathan I can’t claim that they’re superior — just alternatives.</p>
<p>I prefer them over the right-click method because I don’t like to take my hands off the keyboard unless absolutely necessary, and moving to Zsh is a bit much for me right now.</p>
<p>First is <a href="http://www.obdev.at/products/launchbar/index.html">LaunchBar’s</a> built-in man page search (found under UTF-8 search templates in the index), which uses the <code>x-man-page://</code> URL scheme to bring up a new Terminal window. Here’s what you type:</p>
<pre><code>⌘-Space man Space `command` ↩</code></pre>


<p>The second approach layers the wonderful <a href="http://kapeli.com/dash">Dash</a> on top of LaunchBar, bringing up the man page in Dash’s interface instead of the Terminal.</p>
<pre><code>⌘-Space dash Space `command` ↩</code></pre>


<p>This gives you all the usual Dash goodies, including a section list and inline links to other man pages (if you decide, after all, to take your hands off the keyboard).</p>
<p>You can prepend <code>man:</code> to the command name to restrict the search to man pages only, or even add a search template of the form <code>dash://man:*</code> to LaunchBar’s index — in place of the first man page search if you like.</p>
  </article>
  <div class="pagination">
<p class="pagination-older"><a href="https://robjwells.github.io/page-15/">Older posts</a></p><p class="pagination-newer"><a href="https://robjwells.github.io/page-13/">Newer posts</a></p>  </div>

</main>

<footer class="site-footer">
  <small class="mute-links">
    This work is licensed under a
    <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">
    Creative Commons Attribution 4.0 International License</a>.
  </small>
</footer> <!-- .site-footer -->

</div> <!-- .wrapper -->

</body>

</html>