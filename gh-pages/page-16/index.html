<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Primary Unit mirror on GitHub – page 16</title>

  <!-- Load my combined stylesheet -->
  <link rel="stylesheet" href="/resources/all.min.css">


  <link rel="license" href="https://creativecommons.org/licenses/by/4.0/">

  <link rel="alternate" type="application/rss+xml" title="RSS feed for Primary Unit" href="/rss">
  <link rel="alternate" type="application/json" title="JSON feed for Primary Unit" href="/feed.json">

  <!-- Apple pinned sites icon, Apple touch icon, Favicon -->
  <link rel="mask-icon" href="/resources/favicon.svg" color="#1369BF">
  <link rel="apple-touch-icon-precomposed" href="/resources/favicon.png">
  <link rel="icon" href="/resources/favicon.ico">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="A mirror of https://www.robjwells.com hosted on GitHub">
</head>

<body>

<div class="wrapper">

<header class="site-header">

  <div class="site-title-container mute-links">
    <h1 class="site-title"><a href="https://robjwells.github.io">Primary Unit mirror on GitHub</a></h1>
    <p class="site-byline"><i>by</i> Rob Wells</p>
  </div>

  <div class="site-menu-container">

    <nav id="site-nav">
      <ul class="site-links mute-links">
        <li><a href="/about/">About</a></li>
        <li><a href="/archives/">Archives</a></li>
        <li><a href="/feed.json">JSON&nbsp;feed</a></li>
        <li><a href="/rss">RSS&nbsp;feed</a></li>
      </ul>
    </nav>

    <label for="search-field" class="site-search-label">
      Site search
    </label>
    <form id="site-search" class="site-search" method="get" action="https://duckduckgo.com/">
      <input name="q" type="text" id="search-field" class="search-field" placeholder="via DuckDuckGo">
      <input name="sites" value="https://robjwells.github.io" hidden>
      <button type="submit" class="search-button">Search</button>
    </form>

  </div> <!-- .site-menu-container -->

</header> <!-- .site-header -->

<main role="main">

  <article>
    <header>
      <h2 class="mute-links"><a href="https://robjwells.github.io/2013/11/die-bookmarks-bar-die/">Die, bookmarks bar, die</a></h2>
      <p><time datetime="2013-11-18T13:15">Monday, November 18 2013</time></p>
    </header>
    <p>I hate the bookmarks bar. This thing:</p>
<p class="pic no-squish">
    <img src="/images/2013-11-18_bookmarksbar.png" alt="The bookmarks bar in Safari" class="no-border">
</p>

<p>It’s all about the mouse here. Keyboard access is through <code>⌘1</code> for the first entry and so on, which often leaves me counting along to find which number I need.</p>
<blockquote>
<p>What’s the number for Pinboard: Unread? One… two… three… four!</p>
</blockquote>
<p>That’s gross and slow. It’s exactly the same reason why I use InDesign’s <a href="http://help.adobe.com/en_US/indesign/cs/using/WSa285fff53dea4f8617383751001ea8cb3f-6e68a.html#WSE4179F8F-7053-48b4-BFDC-2102D5F27789">quick apply panel</a> at work and don’t even try to remember the per-style keyboard shortcuts (which, handily, only work with the number pad).</p>
<p>It also applies to keyboard shortcuts more generally — if you don’t use them often enough you’ll forget what the shortcut is, annoying you later and often taking more time that it would to grab the mouse.</p>
<p>Assigning less-arbitrary shortcuts can be helpful, but again only if you use them fairly regularly.</p>
<p>Back to that horrid bookmark bar, though. How do we construct a <a href="http://www.obdev.at/products/launchbar/index.html">Launchbar</a>-style, search-based panel to get at those bookmarks? We’ll use Launchbar itself. (I guess you can do this in Quicksilver or Alfred, but I haven’t tried.)</p>
<p>Safari’s AppleScript support is fairly poor — it doesn’t expose your bookmarks to scripts. But it does have a handy <code>do JavaScript</code> command, which is all that those bookmarklets do: run JavaScript.</p>
<p>Grab the code (stored as the bookmark’s address) and — importantly — <a href="http://meyerweb.com/eric/tools/dencoder/">decode</a> it to turn entities such as <code>%7B</code> into <code>{</code>. Lop off the leading <code>javascript:</code> and insert it into this tiny AppleScript:</p>
<pre><code>tell application &quot;Safari&quot;
  set bookmarklet to &quot;your_bookmarklet_code_here&quot;
  set current_tab to the current tab of the front window
  do JavaScript bookmarklet in current_tab
end tell</code></pre>


<p>Save that script into a new folder — mine’s in <code>~/Library/Scripts/Applications/Safari/Bookmarklets/</code></p>
<p>Lastly <a href="/images/2013-11-18_launchbarindex.png">add that new folder to Launchbar’s index</a>. I have my entry set to access on sub-search only, so to get to the bookmarklet scripts I type <code>bookm →</code> and I end up with this panel:</p>
<p class="full-width">
    <img src="/images/2013-11-18_launchbarpanel.png" alt="Launchbar’s list of my Safari bookmarklet scripts" class="no-border">
</p>

<p>And we’re set: a quick, searchable, keyboard-friendly list. If, like me, you <em>only</em> use the bookmarks bar for JavaScript bookmarklets you can go ahead and hide it as an added bonus.</p>
  </article>
  <article>
    <header>
      <h2 class="mute-links"><a href="https://robjwells.github.io/2013/10/date-suffixes-in-python/">Date suffixes in Python</a></h2>
      <p><time datetime="2013-10-07T22:51">Monday, October 7 2013</time></p>
    </header>
    <p>A little while ago I wrote about <a href="/2013/03/setting-a-date-with-textexpander/">using TextExpander to write dates</a>, the bulk of which was given over to an Applescript that returned a long date complete with date suffixes.</p>
<p>Since I’ve been writing more and more Python, I thought it would be fun to rewrite it to see the difference between the two.</p>
<p>First, here’s my original Applescript:</p>
<pre><code>set theDate to the day of the (current date)
set theDay to the weekday of the (current date)
set theMonth to the month of the (current date)
set theYear to the year of the (current date)

set lastChar to (the last character of (theDate as string)) as number

if lastChar &gt; 3 or lastChar is 0 or (theDate &gt; 10 and theDate &lt; 21) then
  set theDate to (theDate as string) &amp; &quot;th&quot;
else
  set theSuffixes to {&quot;st&quot;, &quot;nd&quot;, &quot;rd&quot;}
  set theDate to (theDate as string) &amp; (item lastChar of theSuffixes)
end if

return (theDay &amp; &quot;, &quot; &amp; theMonth &amp; &quot; &quot; &amp; theDate &amp; &quot;, &quot; &amp; theYear) as string</code></pre>


<p>And now the Python:</p>
<pre><code>#!/usr/local/bin/python3

from datetime import date

today = date.today()
date_string = today.strftime('%A, %B #, %Y')
day = today.day

if (3 &lt; day &lt; 21) or (23 &lt; day &lt; 31):
  day = str(day) + 'th'
else:
  suffixes = {1: 'st', 2: 'nd', 3: 'rd'}
  day = str(day) + suffixes[day % 10]

print(date_string.replace('#', day), end='')</code></pre>


<div class="flag">
    <p>
        <strong>Update: <time>2015-01-17</time></strong>
    </p>
    <p>
        <a href="/2015/01/updated-date-suffix-script/">I’ve improved the Python code.</a> Please use the more recent code and not that above.
    </p>
</div>

<p>A date object, kind of similar to Applescript’s <code>current date</code>, is constructed on line 5. This is used to build a formatted date on line 6, which is complete bar the day of the month. I swap it out for a # placeholder because both <code>strftime</code> options for the day fall short: <code>%d</code> is padded with a zero, and <code>%e</code> is padded with a space. So instead I pull out the day separately in line 7.</p>
<p>The date-testing logic on line 9 is simpler and more explicit in this version, testing first for any date that takes a -th. Those dates that require a different suffix get dumped to the else clause.</p>
<p>A bit of modulo arithmetic on line 13 reduces the date integer to the units digit, which is used to key into a dictionary holding the suffixes.</p>
<p>The day and its suffix are concatenated, and are inserted into the formatted date on line 15 using the <code>replace</code> string method (god I love Python’s string methods) and printed, with <code>end=''</code> suppressing the standard newline.</p>
<p>Though the line count is the same between the two, the Python version has about half the characters of the Applescript. I think the Applescript’s verbosity — which I don’t help with that conditional — makes it harder to understand at a glance, while the Python is very clear, excepting the <code>strftime</code> format string.</p>
<p>As a side note, I don’t actually use either of these scripts for my long date, having given in to “Weekday month day year” without a suffix or any commas. This can be constructed using TextExpander’s own date macros, which mirror <code>strftime</code> formatting: <code>%A %B %e %Y</code>. Still, a fun exercise.</p>
  </article>
  <article>
    <header>
      <h2 class="mute-links"><a href="https://robjwells.github.io/2013/09/quit-to-linux/">Quit to Linux</a></h2>
      <p><time datetime="2013-09-17T23:16">Tuesday, September 17 2013</time></p>
    </header>
    <p>Usually I dislike commenting on stuff in the news, instead keeping to topics I have at least some direct experience of — even if I’m frequently documenting my own lack of experience.</p>
<p>But I believe that a lot of people are misinterpreting <a href="http://arstechnica.com/gaming/2013/09/gabe-newell-linux-is-the-future-of-gaming-new-hardware-coming-soon/">Gabe Newell’s keynote speech at LinuxCon</a>, in which he said that Linux is the “future of gaming”. In just over a day that Ars article has drawn over 400 comments but only a handful have come close to what I believe is the real issue.</p>
<p>(If you’ve only read summaries, I urge you to <a href="https://www.youtube.com/watch?v=Gzn6E2m3otg">watch Gabe’s talk</a>. It’s only about 20 minutes long.)</p>
<p>Most of the reaction concerns Windows 8, its software store and tightly-controlled computing environments in general. This misses the point.</p>
<p>Here’s my take: Valve are preparing for the next decade of PC gaming.</p>
<p>But first let’s do a bit of groundwork that will address the common arguments against Gabe’s talk (or what those people imagine he said) and put us in position to view the wider landscape.</p>
<p>Valve began considering the direction of the PC industry “several years ago”. When Gabe talks about “some bad thinking” it’s clear that he means iOS and the tightly-controlled App Store. It should be obvious that Steam would not have been able to exist in that environment.</p>
<p>Steam started on Windows. So where’s Windows now? Doing OK. Windows 8 is a tad confused but doing fine. The Windows Store that plenty of commenters think that Valve fears will eat its lunch? A bit like the Mac App Store. Nothing to worry about.</p>
<p>But where is Windows going? To answer that you must consider where Microsoft is going.</p>
<p><em>No-one knows where Microsoft is going.</em> I don’t think that Microsoft even knows where Microsoft is going.</p>
<p>Its 13-year CEO <a href="http://www.microsoft.com/en-us/news/press/2013/aug13/08-23statementpr.aspx">has just been fired</a> and it desperately needs to unhook itself from the twin Windows and Office morphine drips. Selling Windows licences to PC-makers hits a snag when <a href="http://arstechnica.com/business/2013/07/five-consecutive-quarters-of-sliding-pc-sales-mark-a-new-industry-record/">PC unit sales fall off a cliff</a> and it’s difficult to sell Office to people on <a href="http://www.asymco.com/2013/06/03/forecasting-windows-market-share/">platforms where they can’t buy it</a> even if they wanted to.</p>
<p>If Microsoft is going to survive it needs to get out of that business, though it may be a case of <a href="https://en.wikipedia.org/wiki/Bến_Tre#Vietnam_War">having to destroy the village in order to save it</a>. (<a href="http://atp.fm/episodes/28-the-pit-of-irrelevance">Hat-tip</a>.)</p>
<p>So where does that leave Windows? It’s not clear but the mishmash of tablet and desktop OS that is Windows 8, coupled with the Windows Store, suggests Microsoft wants to head in Apple’s direction. It is this which I think Gabe was referring to when <a href="http://arstechnica.com/gaming/2012/07/steams-newell-windows-8-catastrophe-driving-valve-to-embrace-linux/">he branded Windows 8 a “catastrophe”</a>.</p>
<p>The end of Windows as we know it? <em>Impossible!</em> Well maybe not. Microsoft’s in a bind and who knows what it is willing to throw into the engine in order to keep the wheels turning?</p>
<p>Valve makes <a href="http://www.forbes.com/sites/oliverchiang/2011/02/15/valve-and-steam-worth-billions/">a lot of money from Steam</a> but it’s dependent on having a stable environment where it can more or less do what it likes, ship whatever client software it wants with a store run in a way that suits the business and its customers. Not the rules of a third party.</p>
<p>Linux provides that platform. It is stable in the sense that it has no master which can suddenly make a self-interested change that makes life difficult for Valve.</p>
<p>This is not about the quality of Windows 8, how much business the Windows Store is going to take from Steam or an objection to giving a controlling party some say or a monetary cut.</p>
<p>This is about moving to a platform in which Steam can exist without a guillotine blade hanging over its head.</p>
<p>However, Valve can’t just snap its fingers and have everyone switch to Linux (as many, many commenters noted). But let me tell you a story.</p>
<p>My Steam account is 10 years old this month. I signed up in September 2003. At the time Steam was a joke. There was a <a href="/images/2013-09-17_steam.gif">horrendous GIF</a> doing the rounds that unfortunately summed up the feelings of a lot of users. Steam was rubbish. About the only thing you could do was play Counter-Strike 1.6.</p>
<p>When Valve announced that you would be able to download Half-Life 2 instead of buying a physical copy I wondered why anyone would want to spend several days downloading a game when you could just nip to the shops.</p>
<p>A decade later I have <a href="http://steamcommunity.com/id/robjwells/games?tab=all">about 200 games registered on my Steam account</a> and I haven’t bought a disc copy of a game in two years (and that was <a href="http://www.deusex.com/augmented">an exceptional case</a>).</p>
<p>The Linux user experience can often suck. Few ordinary gamers use it and few developers release games for it. But these are solvable problems.</p>
<p>Valve’s plan for Linux is not for now, it’s for the future. But it starts now.</p>
  </article>
  <article>
    <header>
      <h2 class="mute-links"><a href="https://robjwells.github.io/2013/09/get-your-us-ascii-out-of-my-face/">Get your US-ASCII out of my face</a></h2>
      <p><time datetime="2013-09-14T14:05">Saturday, September 14 2013</time></p>
    </header>
    <div class="flag">
  <p><strong>Warning: The contents of this post may not be up to date!</strong></p>
  <p>Sorry, but if you’re searching for answers about why you can’t reliably set environment variables in OS X (particularly <code>PATH</code>), the information below may be out of date.</p>
  <p>Apple has changed the system so many times in so many different ways it’s difficult to find <em>anything</em> on the internet about this that is correct and up-to-date, so I’ve placed this warning on the top of every post I’ve written about it.</p>
  <p>As of 2017-03-02 it appears that the best collection of information is <a href="https://github.com/ersiner/osx-env-sync">the osx-env-sync project on GitHub</a> and its associated issues.</p>
  <p>Be wary of anything that you find on StackOverflow: the answers there may well have been correct at the time but incorrect now.</p>
  <p>For reference, my own posts on this problem (newest first) are:</p>
  <ul>
    <li><a href="/2017/03/setting-os-xs-environment/">Setting OS X’s environment</a></li>
    <li><a href="/2014/12/locale-in-os-x-whats-the-current-situation/">Locale in OS X — what’s the current situation?</a></li>
    <li><a href="/2014/12/locale-in-os-x-and-launch-agents/">Locale in OS X and Launch Agents</a></li>
    <li><a href="/2013/09/get-your-us-ascii-out-of-my-face/">Get your US-ASCII out of my face</a></li>
  </ul>
</div>

<p>When I was writing the script in <a href="/2013/09/solo-diff/">yesterday’s post</a> I came across this bizarre text encoding problem:</p>
<pre><code>UnicodeDecodeError: 'ascii' codec can't decode byte
0xe2 in position 5: ordinal not in range(128)</code></pre>


<p>Ascii what? We’re all Unicode now, don’t you know? If I’m taking in UTF-8 text, keeping it in a Unicode string, and then writing it out to UTF-8 encoded text files where is goddamn Ascii creeping in?</p>
<p>This first occurred at work, while I was <em>trying to work</em>, so my horrendous hack solution was to switch the temporary files into binary mode and encode the two strings into UTF-8 before writing them out. (This was when the script was still a text filter, so the problem was only on the back end.)</p>
<p>That’s a horrible hack. Bytes! Yuck! So in my next attempt I explicitly opened the files with a UTF-8 encoding. Which was still gross. And totally unnecessary. This is Python 3, everything’s Unicode, all the defaults are UTF-8, why am I having to specify the encoding at every point?</p>
<p>This was the point at which I found <a href="http://stackoverflow.com/questions/5981570/encoding-errors-running-python-from-within-bbedit?rq=1">a relevant Stack Overflow question</a>. Unfortunately the answer there was to tinker with Python’s start-up files in a way that was always discouraged and had since been removed from Python 3.</p>
<p>Hm. But what’s this about <code>sys.setdefaultencoding</code>? So I started poking around with this terrible little script:</p>
<pre><code>#!/usr/bin/env python3
import os
import sys
import locale
entire_file = open(os.environ['BB_DOC_PATH'], 'r')
print(os.environ)
print(entire_file.encoding)
print(sys.getdefaultencoding())
print(locale.getpreferredencoding())</code></pre>


<p>For the last three lines, which print the encodings used, I got:</p>
<pre><code>US-ASCII    # File encoding
utf-8       # sys.getdefaultencoding
US-ASCII    # locale.getpreferredencoding</code></pre>


<p>So the system setting wasn’t the culprit. But why is the system encoding different to the locale, which seems to determine the default encoding with which files are opened?</p>
<p>Locale refers to the environment variables in my Terminal, but when I try <code>echo $LANG</code> it’s set to <code>en_GB.UTF-8</code> — surely that’s not the problem?</p>
<h3>WRONG.</h3>
<p>As <a href="http://www.velocityreviews.com/forums/t695885-print-and-unicode-strings-python-3-1-a.html">this thread</a> eventually made me realise, I didn’t actually have <code>$LANG</code> set to anything — it was all smoke and mirrors that cleared away when I ran the script through BBEdit. (I also had a similar problem with Applescript’s <code>do shell script</code> and it looks like <a href="http://www.sublimetext.com/forum/viewtopic.php?t=13753">Sublime Text users</a> have also run into it.) Checking the <code>os.environ</code> output from the script above confirmed it: no <code>$LANG</code>.</p>
<p>The root of the problem is that if a locale isn’t set it defaults to the C locale — meaning US-ASCII in OS&nbsp;X. <strong>The solution is to explicitly set $LANG in your .bash_profile</strong>:</p>
<pre><code>export LANG=&quot;en_GB.UTF-8&quot;</code></pre>


<p>I’ve also got that line in ~/.bashrc for safety, but do bear in mind that <em>some shells will ignore both</em> ~/.bash_profile and ~/.bashrc.</p>
<p>You could set the other <code>LC_*</code> keywords as well, if you like, but <code>$LANG</code> should be enough according to <a href="https://developer.apple.com/library/mac/documentation/Darwin/Reference/ManPages/man1/locale.1.html">the man page for <code>locale</code></a>:</p>
<pre><code>LANG         Used as a substitute for any unset LC_* variable.  If LANG
             is unset, it will act as if set to &quot;C&quot;.  If any of LANG or
             LC_* are set to invalid values, locale acts as if they are
             all unset.</code></pre>


<div class="flag">
  <p><strong>Update 2013-09-21</strong></p>
  <p>I’ve just re-watched <a href="http://nedbatchelder.com/text/unipain.html">Ned Batchelder’s great Pragmatic Unicode video</a> and while setting the <code>$LANG</code> environment variable is a handy solution on your own machines, it’s not a good fit when you’re writing a program that will run on systems where you can’t control the default encoding.</p>
  <p>In such cases it makes sense to adopt his “Unicode sandwich” approach of explicitly decoding I/O and then working on the resulting Unicode.</p>
</div>
  </article>
  <article>
    <header>
      <h2 class="mute-links"><a href="https://robjwells.github.io/2013/09/solo-diff/">Solo diff</a></h2>
      <p><time datetime="2013-09-13T20:39">Friday, September 13 2013</time></p>
    </header>
    <p>At work we edit the reporters’ copy in plain text files using <a href="http://barebones.com/products/textwrangler/">TextWrangler</a>, duplicating their original at the bottom of the file before we start subbing.
It’s a nice, quick way of having something to refer back to without the hassle of using (and training people to use) a real <a href="http://en.wikipedia.org/wiki/Revision_control">VCS</a>.</p>
<p>It began as a loose convention, with different people having their own way of marking off the original copy. To make it completely painless, and to bring in a standard method, I wrote this short Python script a couple of months ago:</p>
<pre><code>#!/usr/bin/env python3
from sys import stdin
orig = stdin.read()
dupe = &quot;{0}\n\n\n\n#### Original Copy ####\n\n\n\n{0}&quot;.format(orig)
print(dupe)</code></pre>


<p>I installed it to everyone’s text filters folder — TextWrangler provides the document’s text (or the selection) to text filters via stdin — and people tend to use it.</p>
<p>We hired two new subs over the summer and I got into the habit of using the “Compare Two Front Windows” command to check their subbed copy against the original, so I could offer them specific advice.</p>
<p>But manually creating two new windows and pasting in the text can be a pain — you end up juggling lots of windows and it’s easy to mix up the copy so that the “older” pane is showing the subbed text.</p>
<p>Thankfully both of the new people use the duplication script consistently, so it’s easy to use a regular expression to split the file into original and subbed versions. Armed with this knowledge, I wrote a script to automate the comparison, using TextWrangler’s <code>twdiff</code> command-line tool.</p>
<div class="flag">
    <p>The code below is written for BBEdit, which I use at home. Except for <code>BB_DOC_PATH</code>, I swap out <code>bb</code> for <code>tw</code> in the script used at work.</p>
</div>

<pre><code>#!/usr/bin/env python3

import os
import re
import subprocess

os.chdir('/tmp')
with open(os.environ['BB_DOC_PATH']) as full_file:
  sub_copy, orig_copy = re.split(r'#{2,} original copy #{2,}',
                                 full_file.read(), flags=re.I)

with open('bb_orig_copy', 'w') as orig_file:
  orig_copy = orig_copy.strip() + '\n'
  orig_file.write(orig_copy)

with open('bb_subbed_copy', 'w') as sub_file:
  sub_copy = sub_copy.strip() + '\n'
  sub_file.write(sub_copy)

subprocess.call(['bbdiff', 'bb_orig_copy', 'bb_subbed_copy'])</code></pre>


<p>The entire file is split into subbed and original sections in lines 9 &amp; 10, and on lines 14 &amp; 18 each of those is written to a file (in <code>/tmp</code> — line 7). The leading and trailing whitespace is stripped from each and a newline added in order to clean up the comparison.</p>
<p>The regex on lines 9 &amp; 10 uses a variable number of hash marks and the case-insensitivity flag because on occasion I forget to duplicate the copy first, edit the story, and then go back and fill in the separator by hand.</p>
<p>All of the file interaction is handled in <code>with</code> blocks (context managers), which automatically close the files once the block’s statements are executed. Not a big issue in a script this size, but good practice.</p>
<p>Finally we call the diff utility with the names of the two temporary files.</p>
<p>I’ve got this saved in TextWrangler’s scripts folder. Initially I wrote it as a text filter, splitting the contents provided on stdin. But since filters replace the document (or selection) the text had to be written to stdout at the end of the script so that TextWrangler didn’t delete everything.</p>
<p>And it’s also <em>not a filter</em>, so I was pleased to find out that several environment variables are set when a script is invoked, one of which is the path to the file that the script was called on.</p>
<p>I’ve tested the script with Python 2.7.5 and it seems to work fine, but with the differences in its Unicode handling I can’t say for certain that some nasty encoding gremlin won’t raise its head.</p>
  </article>
  <div class="pagination">
<p class="pagination-older"><a href="https://robjwells.github.io/page-17/">Older posts</a></p><p class="pagination-newer"><a href="https://robjwells.github.io/page-15/">Newer posts</a></p>  </div>

</main>

<footer class="site-footer">
  <small class="mute-links">
    This work is licensed under a
    <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">
    Creative Commons Attribution 4.0 International License</a>.
  </small>
</footer> <!-- .site-footer -->

</div> <!-- .wrapper -->

</body>

</html>