<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Primary Unit mirror on GitHub – page 18</title>

  <!-- Load my combined stylesheet -->
  <link rel="stylesheet" href="/resources/all.min.css">


  <link rel="license" href="https://creativecommons.org/licenses/by/4.0/">

  <link rel="alternate" type="application/rss+xml" title="RSS feed for Primary Unit" href="/rss">
  <link rel="alternate" type="application/json" title="JSON feed for Primary Unit" href="/feed.json">

  <!-- Apple pinned sites icon, Apple touch icon, Favicon -->
  <link rel="mask-icon" href="/resources/favicon.svg" color="#1369BF">
  <link rel="apple-touch-icon-precomposed" href="/resources/favicon.png">
  <link rel="icon" href="/resources/favicon.ico">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="A mirror of https://www.robjwells.com hosted on GitHub">
</head>

<body>

<div class="wrapper">

<header class="site-header">

  <div class="site-title-container mute-links">
    <h1 class="site-title"><a href="https://robjwells.github.io">Primary Unit mirror on GitHub</a></h1>
    <p class="site-byline"><i>by</i> Rob Wells</p>
  </div>

  <div class="site-menu-container">

    <nav id="site-nav">
      <ul class="site-links mute-links">
        <li><a href="/about/">About</a></li>
        <li><a href="/archives/">Archives</a></li>
        <li><a href="/feed.json">JSON&nbsp;feed</a></li>
        <li><a href="/rss">RSS&nbsp;feed</a></li>
      </ul>
    </nav>

    <label for="search-field" class="site-search-label">
      Site search
    </label>
    <form id="site-search" class="site-search" method="get" action="https://duckduckgo.com/">
      <input name="q" type="text" id="search-field" class="search-field" placeholder="via DuckDuckGo">
      <input name="sites" value="https://robjwells.github.io" hidden>
      <button type="submit" class="search-button">Search</button>
    </form>

  </div> <!-- .site-menu-container -->

</header> <!-- .site-header -->

<main role="main">

  <article>
    <header>
      <h2 class="mute-links"><a href="https://robjwells.github.io/2013/07/sunny-with-a-chance-of-python/">Sunny with a chance of Python</a></h2>
      <p><time datetime="2013-07-23T22:28">Tuesday, July 23 2013</time></p>
    </header>
    <p>Learning Python is the next goal that I’ve set myself, though I have put it off for a bit while I <a href="http://www.cengage.com/cgi-wadsworth/course_products_wp.pl?fid=M20b&amp;product_isbn_issn=9780495826163&amp;discipline_number=10002&amp;template=AISE">improve my maths skills</a>.</p>
<p>But I do have one little Python script that I’ve been playing with for a while, which I first wrote to dip my toe in and see if I liked the language. (I do, very much so).</p>
<p>It’s incredibly basic but complements my <a href="https://github.com/robjwells/weatherman">automatic weather script</a>, which saves a lot of time and tedium at work, by fetching a text summary of the weather for the entire UK.</p>
<pre><code>#!/usr/bin/env python3
&quot;&quot;&quot;Get a 3 to 5 day outlook for the UK from the Met Office.&quot;&quot;&quot;

from urllib.request import urlopen
from bs4 import BeautifulSoup as bs
from subprocess import Popen, PIPE

api_url = (&quot;http://datapoint.metoffice.gov.uk/public/&quot; +
           &quot;data/txt/wxfcs/regionalforecast/xml/515&quot;)
api_key = &quot;Your Datapoint API key here&quot;

def get_weather():
  &quot;&quot;&quot;Retrieve and parse the text summary forecast&quot;&quot;&quot;
  raw_xml = urlopen(api_url + &quot;?key=&quot; + api_key)
  outlook = bs(raw_xml).find(id=&quot;day3to5&quot;).get_text()
  return outlook

if __name__ == &quot;__main__&quot;:
  # Encode and pipe outlook to pasteboard
  outlook_bytes = get_weather().encode()
  Popen(&quot;pbcopy&quot;, stdin=PIPE).communicate(outlook_bytes)</code></pre>


<p>As shown at the top, this is Python 3 code. I have a version written in Python 2 which is very similar. It uses the built-in ElementTree XML parser instead of the nicer Beautiful Soup used in this script as I both wanted to get my head around the interface and for reasons to do with the Python version at work.</p>
<p>Lines 8–10 set up variables needed to access the <a href="http://www.metoffice.gov.uk/datapoint">Met Office API</a>, which is done in the <code>get_weather</code> function below.</p>
<p>Beautiful Soup is used to parse the API response in line 16. I love its dead simple method for finding elements, especially compared to ElementTree’s insistence that you provide the XML namespace:</p>
<pre><code>pattern = (&quot;.//{www.metoffice.gov.uk/xml/metoRegionalFcst}&quot; +
           &quot;Period[@id='day3to5']&quot;)</code></pre>


<p>My favourite part of the script is also the newest. If it is run directly from the command line (line 18) it pipes the forecast to the clipboard using <code>pbcopy</code>. I knew Python could start external processes but I was <em>blown away</em> by how easy this was. Previously the script printed the forecast and I used a shell alias to send it to the pasteboard. Yuck. This is much better.</p>
<p>The way Python 3 handles strings requires an encoding step in line 21, whereas Python 2 can just send a string through <code>communicate</code> — as it’s already bytes. This caught me out at first but otherwise it was incredibly simple to implement.</p>
<p>So, like I said, a trivial program but one that has made me eager to learn more Python.</p>
  </article>
  <article>
    <header>
      <h2 class="mute-links"><a href="https://robjwells.github.io/2013/07/five-different-kinds-of-grey/">Five different kinds of grey</a></h2>
      <p><time datetime="2013-07-06T18:54">Saturday, July 6 2013</time></p>
    </header>
    <p>My post from a couple of weeks ago <a href="/2013/06/a-new-look-and-name/">about the changes to this site</a> briefly mentioned that despite having this domain for about five years I’d never been satisfied with its design.</p>
<p>I’ve actually lost count of the number of times I’ve switched themes but, spread across Blogger, WordPress and Tumblr, it must be at least 10. None of them stuck.</p>
<p>Part of that is likely that I never stuck at it, never put in the effort to make the posts worthwhile. But maybe one of the reasons why is because I knew I wasn’t going to be happy with how the results looked.</p>
<p>But I <em>am</em> happy with the design now. Having put in the time to learn HTML and CSS (with <a href="http://learningwebdesign.com">some help</a>), it wasn’t too hard to make something that I’m at least a little proud of. And now I’d like to share some of the thinking behind it.</p>
<p>It’s pretty simple — largely because I can handle this kind of simplicity well with my limited skills. But it’s just a personal blog and I don’t want to overcomplicate matters.</p>
<p>I took a lot of cues from <a href="http://www.leancrew.com/all-this/">Dr Drang</a>, <a href="http://www.marco.org">Marco Arment</a> and <a href="http://daringfireball.net">John Gruber</a>, all of whom have great sites with top work framed with a straightforward design.</p>
<p>I’d love to claim some kind of inspiration but, when it came down to it, I made a fairly arbitrary decision to stick the meta stuff on the left, the content in a big long column on the right and then call it a day. On smaller screens the meta column sits on top of the content and the social links disappear entirely on particularly thin screens (phones) as they’re not essential. My earlier sketches had elements boxed or ruled off, but a few technical difficulties pulling this off convinced me to mostly just use whitespace.</p>
<p>All text is set in <a href="https://typekit.com/fonts/rooney-web">Rooney</a>. A while ago I had got obsessed with <a href="https://typekit.com/fonts/ff-tisa-web-pro">Tisa</a> and had initially planned to use that. But I eventually had trouble reading long Instapaper articles in it — the vertical strokes tended to run together when I was tired. After searching the Typekit library for a while I settled on Rooney, which is similar in many ways to Tisa — but with enough subtle differences and little quirks to avoid the problem I had with Tisa. Also as lovely as Tisa is it can be a bit cold and clinical, while I find that Rooney feels more warm and welcoming.</p>
<p>Paragraphs are limited to roughly 65 characters (about 12 words) a line, though I’m still tweaking the exact length. I had initially had an idea to accommodate margin notes in the extra space but technical hurdles, a lack of anything to put there and fear of looking incredibly pompous made me decide against it. A remnant of this can be seen in the blockquotes, code blocks and coloured boxes I use, which all stretch the full width of the column. Code blocks are the only element that make use the extra space, but the others get it because I like how their background colours can help break up long columns of text.</p>
<div class="flag">
    <p>The coloured boxes I mentioned above I call “flags” and came about when I decided I wanted a way to <em>flag</em> updates to posts. (Again, an influence of Dr Drang: <a href="http://www.leancrew.com/all-this/2012/07/some-safari-6-stuff/">see the updates in this post</a>.) I then generalised the style to be applicable to a range of things, such as flagging download links and warnings.</p>
</div>

<p>The flags use icons from <a href="http://symbolset.com/icons/standard">Symbolset’s Standard font</a>, which I use in a few places on the site — probably not enough to justify the weight of an extra web font but I like the font a lot and had been itching to use it for months. Similarly, the social icons in the sidebar use <a href="http://symbolset.com/icons/social-circle">Symbolset’s Social font</a>. I use the circular version to give them an even appearance.</p>
<p>It took me a long time to pick out the dark blue used as the left-hand border of the flag above, which is also the primary link colour. Generally, I’m not great at picking colours but <a href="http://www.eigenlogik.com/spectrum/mac">Spectrum</a> helps enormously. Before using Spectrum I’d end up with a murky mess, but now I’m actually very pleased with the palette I have created. It’s mostly blue and grey, with splashes of green and red where appropriate.</p>
<p>The image below shows all the colours used on the site, apart from those used for code. (The two oranges are only used for the RSS link.)</p>
<p class="full-width"><img src="/images/2013-07-06_Spectrum.png" alt="The 14 colours used on robjwells.com"></p>

<p>The syntax highlighting for code is another thing I lifted from Dr Drang, which is to say it is <a href="http://softwaremaniacs.org/soft/highlight/en/">highlight.js</a> combined with <a href="http://www.leancrew.com/all-this/2010/12/new-syntax-highlighting-for-markdown/">the Doc’s script to conditionally invoke</a> the highlight functions and add line numbers.</p>
<p>I’ve uploaded <a href="https://gist.github.com/robjwells/5940383">my slightly rewritten code</a> as a GitHub gist. The two main changes are the introduction of the module pattern (using the RJW global variable as a container) and removing the dependency on JQuery. The syntax colour scheme is based on <a href="https://gist.github.com/robjwells/5940537">my custom one for BBEdit</a>.</p>
<p>Speaking of JQuery, nothing in my design requires it. But it’s one of those things Tumblr injects into your blog anyway. This is a bit of a shame, as I’d tried to keep page weight down (<em>five</em> web font files notwithstanding). The three largest downloads on this page are all things injected by Tumblr — the fourth is my 135KB Typekit CSS file.</p>
<p>While this doesn’t bother me a huge amount, it does add another reason for me to move away from Tumblr — almost certainly to a static system of some kind. (I have a fantasy of learning enough Python to write my own.) While I imagine that’s quite a while off, it should be a fairly easy transition — there are no dynamic elements to move over and the “Tumblrised” HTML file I have would be simple to switch to another template system.</p>
<p>I haven’t spent much time on Tumblr-specific features, either. The only post types I accommodate are text, links and photos. I did the work for the latter two largely because I already have posts of that type that I wish to keep, not because I plan to make more of them in the future. Again, making it easier to switch away at some point in the future.</p>
<p>It’s not that I dislike Tumblr, just that <a href="https://twitter.com/robjwells/statuses/349479449093341188">I’m not a great fit for Tumblr</a> and Tumblr’s not a great fit for me and the kind of site that I want to run.</p>
<p>Right, we’re over 1,000 words now so it’s time to wrap it up. If you’ve made it this far, thanks! If you have any comments or questions be sure to send me a message on <a href="https://twitter.com/robjwells">Twitter</a> or <a href="https://alpha.app.net/robjwells">App.net</a>.</p>
  </article>
  <article>
    <header>
      <h2 class="mute-links"><a href="https://robjwells.github.io/2013/06/first-brush-with-modulo-speed/">First brush with modulo speed</a></h2>
      <p><time datetime="2013-06-29T12:05">Saturday, June 29 2013</time></p>
    </header>
    <p>I had read that the modulo operator (remainder after integer division) was slow but had never had a chance to try to break it myself, until a couple of days ago. I was distracted from my <a href="http://getpython3.com/diveintopython3/">current project</a> by <a href="http://projecteuler.net">Project Euler</a>, after searching for a way to test and improve my programming and maths skills.</p>
<p>Project Euler is a collection of problems designed to exercise those skills and its first, simplest task is to add up the multiples of 3 and 5 below 1,000, which I first solved with a fairly typical “brute-force” approach:</p>
<pre><code>sum = 0
for x in range(1, 1000):
    if x % 3 == 0 or x % 5 == 0:
        sum += x</code></pre>


<p>This iterates over the numbers 1 through 999, checking to see if there’s a remainder after dividing by 3 or 5. After finishing, I read on the problem’s forum thread of a way of achieving the result with a little more maths and without using the modulo.</p>
<p>I tried it out for fun and to be honest wasn’t impressed — when timed with the Unix <code>time</code> command both methods took around 0.025 seconds.</p>
<p>So I decided to kick the limit up a bit, from 999 to 999,999,999.</p>
<p>The modulo method took 4 minutes and 24.506 seconds (264.506s) while the more mathematical approach held steady at 0.026 seconds. Over 10,000 times as fast. Yes, I double-checked the results.</p>
<p>The modulo code was similar to that above while the other method was written like so:</p>
<pre><code>def sum_series(multiple, top_limit):
    mult_max = top_limit // multiple
    return multiple * (mult_max * (mult_max + 1)) / 2

print(sum_series(3, 999)
        + sum_series(5, 999)
        - sum_series(15, 999))</code></pre>


<p>The <code>sum_series</code> function works out how many multiples of a given number there are between 0 and <code>top_limit</code> and adds them up.</p>
<p>But you can avoid iterating over them because of the interesting fact that the sum of all <a href="http://en.wikipedia.org/wiki/Natural_numbers">natural numbers</a> through <em>x</em> is <em>x × (x + 1) ÷ 2</em>. It took me a while of head-scratching before I <a href="http://mathandmultimedia.com/2010/09/15/sum-first-n-positive-integers/">read an explanation</a> (two, actually) that made sense.</p>
<p>The function does that for the <em>number</em> of multiples, and then multiplies the result by the number in question to actually <em>make</em> them multiples. For example, 1 + 2 + 3 through 333 become 3 + 6 + 9 through 999.</p>
<p>Repeat with 5, then subtract the results for 15 (to remove the double-counted multiples of both 3 and 5) and you’re done.</p>
  </article>
  <article>
    <header>
      <h2 class="mute-links"><a href="https://robjwells.github.io/2013/06/more-precise-git-status-gating/">More precise git status gating</a></h2>
      <p><time datetime="2013-06-25T22:18">Tuesday, June 25 2013</time></p>
    </header>
    <p>At the end of my post about having <a href="http://www.noodlesoft.com">Hazel</a> <a href="/2013/06/gating-hazel-with-git-status/">check a file’s commit status</a> before running rules on it, I suggested that the script could be made better by not requiring the entire repository be committed and clean:</p>
<blockquote>
<p>If you work with repositories which are rarely
“all clear” as in this case, you could improve
this snippet by checking the status tool’s list
of uncommitted modified files for the name of
the file (provided by Hazel as <code>$1</code>).</p>
</blockquote>
<p>It has been on my mind all day, so I decided to have a crack at it:</p>
<pre><code>cd $(dirname $1)
FILENAME=$(basename $1)
GITSTATUS=$(git status -s &quot;$FILENAME&quot;)
if [ &quot;$GITSTATUS&quot; == &quot;&quot; ]; then
  exit 0 # Clean
else
  exit 1 # Dirty
fi</code></pre>


<div class="flag">
    <strong>Update 2013-06-27</strong>
    <p>I’ve slightly revised the code and have rewritten the explanation to be clearer.</p>
    <strong>Update 2013-07-31</strong>
    <p>I’ve tweaked the script to make it simpler and more reliable, with the explanation below rewritten again. There is now also <a href="/2013/07/hazel-gating-with-mercurial/">a version for Mercurial users</a>.</p>
</div>

<p>The script is largely the same <a href="/2013/06/gating-hazel-with-git-status/">as in my original post</a>, but with a few tweaks and a different method of action.</p>
<p>In line 1 the directory is not hard-coded as it was before, instead using the built-in <code>dirname</code> command to extract it from the path Hazel hands off as <code>$1</code>.</p>
<p>Next the script grabs the filename from <code>$1</code> and provides it to the short form of <code>git status</code>, which returns a single line of output if the file is modified in any way. By moving into the file’s directory on the first line we can reliably avoid modified identically-named files in subfolders causing false negatives.</p>
<p>Older versions of the script parsed the long <code>git status</code> output with a regular expression, which wasn’t ideal: a false negative could result if a file had the same name as a branch or the last word on a line of boilerplate output.</p>
<p>Lastly the script checks if <code>git status</code> returned anything. An empty string counts as success since it would only contain characters if the file was dirty.</p>
<p>The two exit lines tell Hazel whether the file passed the script’s check (<code>exit 0</code>) or failed (<code>exit 1</code>).</p>
  </article>
  <article>
    <header>
      <h2 class="mute-links"><a href="https://robjwells.github.io/2013/06/gating-hazel-with-git-status/">Gating Hazel with git status</a></h2>
      <p><time datetime="2013-06-25T00:52">Tuesday, June 25 2013</time></p>
    </header>
    <p>The JavaScript and CSS files for this site live on Amazon S3, but getting them up there can be a chore once you consider compression and uploading with the right headers.</p>
<p>That wasn’t too difficult to sort out with AppleScript and Transmit but I wanted to avoid having to start the script manually as well.</p>
<p><a href="http://www.noodlesoft.com/hazel.php">Hazel</a>, the housekeeper for your Mac, can keep watch and is ideal for this — except when you’re still working on the file. It’s going to get under your feet if you tell it to run its rules once the modification date is after the last match.</p>
<p>If the files are under version control the commit status is an ideal way to signal whether or not a file is ready to go. Combine that with Hazel’s ability to use a shell script in its conditions and you end up with something like this:</p>
<pre><code>cd ~/Sites/robjwells
GITSTATUS=$(git status | head -n 2 | tail -n 1 | grep -o &quot;^nothing&quot;)
if [ &quot;$GITSTATUS&quot; == &quot;nothing&quot; ]; then
    exit 0
else
    exit 1
fi</code></pre>


<p>(This is my first time writing about a purely shell script, so please be gentle.)</p>
<p>First it moves into the directory in question, which is a git repo.
Next it calls <code>git status</code>, extracts the second line of the output (<code>head</code> and <code>tail</code>) and checks if it starts with “nothing”. That’s because the status command returns this on a clean repo:</p>
<pre><code># On branch master
nothing to commit, working directory clean</code></pre>


<p>If <code>grep</code> finds “nothing” it gets stuck in <code>$GITSTATUS</code>, which is compared to the string you would expect from a clean repo. If it matches the script exits with a success status code, which tells Hazel that the file has passed the check.</p>
<p>(The -o flag makes <code>grep</code> only return the match, instead of the whole line.)</p>
<p>Initially I did this check in the AppleScript that was applied to the file once it passed date and extension checks. But this meant that Hazel considered it to have matched successfully and would not run the rules on the file until it triggered the date conditions again. The lesson here is that checks must be separate from actions. Thankfully Hazel makes it easy to do that.</p>
<p>If you work with repositories which are rarely “all clear” as in this case, you could improve this snippet by <a href="/2013/06/more-precise-git-status-gating/">checking the status tool’s list of uncommitted modified files for the name of the file</a> (provided by Hazel as <code>$1</code>).</p>
  </article>
  <div class="pagination">
<p class="pagination-older"><a href="https://robjwells.github.io/page-19/">Older posts</a></p><p class="pagination-newer"><a href="https://robjwells.github.io/page-17/">Newer posts</a></p>  </div>

</main>

<footer class="site-footer">
  <small class="mute-links">
    This work is licensed under a
    <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">
    Creative Commons Attribution 4.0 International License</a>.
  </small>
</footer> <!-- .site-footer -->

</div> <!-- .wrapper -->

</body>

</html>