<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Primary Unit mirror on GitHub – page 5</title>

  <!-- Load my combined stylesheet -->
  <link rel="stylesheet" href="/resources/all.min.css">

  <!-- Load my combined JavaScript -->
  <script src="/resources/all.min.js" async></script>

  <link rel="license" href="https://creativecommons.org/licenses/by/4.0/">

  <link rel="alternate" type="application/rss+xml" title="RSS feed for Primary Unit" href="/rss">
  <link rel="alternate" type="application/json" title="JSON feed for Primary Unit" href="/feed.json">

  <!-- Apple pinned sites icon, Apple touch icon, Favicon -->
  <link rel="mask-icon" href="/resources/favicon.svg" color="#1369BF">
  <link rel="apple-touch-icon-precomposed" href="/resources/favicon.png">
  <link rel="icon" href="/resources/favicon.ico">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="A mirror of https://www.robjwells.com hosted on GitHub">
</head>

<body>

<div class="wrapper">

<header class="site-header">

  <div class="site-title-container mute-links">
    <h1 class="site-title"><a href="https://robjwells.github.io">Primary Unit mirror on GitHub</a></h1>
    <p class="site-byline"><i>by</i> Rob Wells</p>
  </div>

  <div class="site-menu-container">

    <nav id="site-nav">
      <ul class="site-links mute-links">
        <li><a href="/about/">About</a></li>
        <li><a href="/archives/">Archives</a></li>
        <li><a href="/feed.json">JSON&nbsp;feed</a></li>
        <li><a href="/rss">RSS&nbsp;feed</a></li>
      </ul>
    </nav>

    <label for="search-field" class="site-search-label">
      Site search
    </label>
    <form id="site-search" class="site-search" method="get" action="https://duckduckgo.com/">
      <input name="q" type="text" id="search-field" class="search-field" placeholder="via DuckDuckGo">
      <input name="sites" value="https://robjwells.github.io" hidden>
      <button type="submit" class="search-button">Search</button>
    </form>

  </div> <!-- .site-menu-container -->

</header> <!-- .site-header -->

<main role="main">

  <article>
    <header>
      <h2 class="mute-links"><a href="https://robjwells.github.io/2017/03/backups-the-change/">Backups: the change</a></h2>
      <p><time datetime="2017-03-21T01:05">Tuesday, March 21 2017</time></p>
    </header>
    <p>To recount from <a href="/2017/03/backups-before/">last time</a>, our backup strategy was a mess. The tools were solid but used in such a way that the common case (fast file restoration) was likely to fail, even if the rare case (complete disk failure) was covered.</p>
<p>That alone should have made me act sooner than I did. But ultimately the common case was so rare that the pain it caused wasn’t sufficiently motivating. That combined with an already set plan to make the change when the server hardware was changed, a reluctance to spend money that delayed the hardware change, and a near-total lack of time. So it didn’t happen for about 2.5 years after I got the job.</p>
<p>What finally prompted me to overhaul the backups was a nerve-wracking hour late last year when the Mac Mini server became unresponsive and would fail to start up with its external drives attached.</p>
<p>Detaching the drives, booting and then reattaching the drives got us back to normal. (This had happened before; I think it might have been connected to the third-party RAID driver we were using, but I don’t know that for sure.)</p>
<p>As a precaution I checked the server’s backups. None had completed in five days. Understand that there was no monitoring; checking required logging in to the machine and looking at the Arq interface and SuperDuper’s schedule.</p>
<p>The <a href="https://www.arqbackup.com">Arq</a> agent had hung and I believe <a href="http://www.shirt-pocket.com">SuperDuper</a> had too, just frozen in the middle of a scheduled copy. As I noted <a href="/2017/03/backups-before/">before</a>, these are both solid pieces of software so I’m very much blaming the machine itself and the way it was set up.</p>
<p>Shortly after I ordered a replacement Mac Mini (with a 1TB <a href="https://support.apple.com/en-gb/HT202574">Fusion</a> drive that feels nearly as fast as my SSD at home) and a bunch of new external drives.</p>
<h3>Hardware</h3>
<p>Previously we had been using various 3.5″ drives in various enclosures.</p>
<p>I don’t know what the professional advice about using internal drives in enclosures versus external drives, but my preference is for “real” external drives, mostly because they’re better-designed when it comes to using several of them, they seem to be better ventilated and quieter, and they’re less hassle.</p>
<p>All of our existing drives were several years old, the newest 2.5 years (and I managed to brick that one through impatience — a separate story), so they all needed replacing.</p>
<p>I bought four <a href="http://www.techradar.com/reviews/pc-mac/pc-components/storage/toshiba-4tb-canvio-usb-3-0-external-hard-drive-1261227/review">4TB USB3 Toshiba</a> drives, which run at 7,200 RPM using drives apparently manufactured by someone else. That <a href="http://www.techradar.com/reviews/pc-mac/pc-components/storage/toshiba-4tb-canvio-usb-3-0-external-hard-drive-1261227/review">review</a> says they’re noisy, but I’ve had all four next to my desk (in an office) since the start of the year, with at least one reading constantly (more on that later), and they’re OK. I might feel differently if I was using one in my quiet bedroom at home, but it’s hard to tell.</p>
<p>Funnily enough, you can no longer buy these drives from the retailer where we got them. But from memory they were about £100 each, maybe a bit less.</p>
<p>More recently I bought a 1TB USB3 Toshiba Canvio 2.5″ external drive to serve as a SuperDuper clone. (Not to match the 4TB Toshiba drives, but because it was well reviewed and cheaper than others.)</p>
<p>In sum, here’s our stock of drives:</p>
<ul>
<li>1 in the Mac Mini. (You can’t buy dual-drive Minis anymore.)</li>
<li>2 Time Machine drives.</li>
<li>1 nightly SuperDuper clone.</li>
<li>1 for the 2002-2016 archives.</li>
<li>1 for the post-2016 archives.</li>
</ul>
<h4>Redundancy</h4>
<p>One of the biggest changes is one that’s basically invisible. Beforehand we had loads of drives, not all of which I mentioned last time.</p>
<ul>
<li>2 in the Mac Mini server.</li>
<li>2 for daily/3-hourly clones (each drive containing two partitions).</li>
<li>2 for the 2002-2011 archives.</li>
<li>2 for the post-2011 archives.</li>
</ul>
<p>All of them were in <a href="https://en.wikipedia.org/wiki/Standard_RAID_levels#RAID_1">RAID 1</a>, where each drive contains a copy of the data. The idea behind this is that one drive can fail and you can keep going.</p>
<p>We were using a third-party RAID driver by a long-standing vendor. I won’t name them because I didn’t get on with the product, but I don’t want to slight it unfairly.</p>
<p>The RAID software frequently cried wolf — including on a new external drive that lasted 2.5 years until I broke it accidentally — so I got to a point where I just didn’t believe any of its warnings.</p>
<p>The worst was a pop-up once a day warning that one of the drives inside the Mini was likely to fail within the next few weeks. I got that message for over two years. I’d only infrequently log in to the Mini, so I’d have to click through weeks of pop-ups. The drive still hasn’t died.</p>
<p>As I’ve made clear, the machine itself was a pain to work with and that may have been the root problem. But I won’t be using the RAID driver again.</p>
<p>That experience didn’t encourage me to carry over the RAID setup, but the main factor in deciding against using RAID was cost. As we openly admit in the paper, our place isn’t flush with cash so we try to make the best use of what we’ve got.</p>
<p>The demise of the dual-drive Mini means that the internal drive isn’t mirrored, and that would have been the obvious candidate. So if I were to buy extra drives for a RAID mirror, it might be for the external archive drives. They are backed up but if either drive were to snuff it most of their contents would be unavailable for a period.</p>
<p>But buying mirror drives means that money isn’t available for other, more pressing needs.</p>
<h3>Backup strategy</h3>
<p>OK, with that out of the way, let’s talk about what we <em>are</em> doing now. In short:</p>
<ul>
<li>Time Machine backups every 20 minutes, rotated between two drives.</li>
<li>Nightly SuperDuper clones to a dedicated external drive.</li>
<li>Arq backups once an hour.</li>
<li>“Continuous” <a href="https://www.backblaze.com">Backblaze</a> backups.</li>
</ul>
<h4>Time Machine</h4>
<p>I’m a big fan of Time Machine; I’ve been using it for years and very rarely had problems. But Time Machine <a href="http://mjtsai.com/blog/tag/timemachine/">does have</a> <a href="https://joeontech.net//why-i-dont-rely-on-time-machine.html">problems</a>. I wouldn’t recommend using Time Machine by itself, particularly not if you’ve just got a single external disk.</p>
<p>There are a couple of reasons for using two drives for Time Machine:</p>
<ul>
<li>Keep backup history if one drive dies.</li>
<li>Perform backups frequently without unduly stressing a drive.</li>
<li>Potentially a better chance of withstanding <a href="https://joeontech.net//why-i-dont-rely-on-time-machine.html">a Time Machine problem</a>. (Perhaps? Fortunately this hasn’t happened to me yet.)</li>
</ul>
<p>Because of the nature of our work in the newsroom, a lot can change with a page or an article in a very short span of time, yet as we approach deadline there may not be any time to recreate lost work. So I run Time Machine every 20 minutes via a script.</p>
<p>It started off life as <a href="https://nathangrigg.com/2014/03/automounting-time-machine">a shell script by Nathan Grigg</a>, which I was first attracted to because at home my Time Machine drives sit next to my iMac — so between backups I wanted them unmounted and not making any noise. I’ve since recreated it in Python and expanded its logging.</p>
<p>Here’s the version I use at home:</p>
<div class="syntax"><pre><span></span><span class="lineno"> 1 </span><span class="ch">#!/usr/local/bin/python3</span>
<span class="lineno"> 2 </span><span class="sd">&quot;&quot;&quot;Automatically start TimeMachine backups, with rotation&quot;&quot;&quot;</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span><span class="kn">from</span> <span class="nn">enum</span> <span class="k">import</span> <span class="n">Enum</span>
<span class="lineno"> 5 </span><span class="kn">import</span> <span class="nn">logging</span>
<span class="lineno"> 6 </span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="k">import</span> <span class="n">Path</span>
<span class="lineno"> 7 </span><span class="kn">import</span> <span class="nn">subprocess</span>
<span class="lineno"> 8 </span>
<span class="lineno"> 9 </span><span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
<span class="lineno">10 </span>  <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
<span class="lineno">11 </span>  <span class="n">style</span><span class="o">=</span><span class="s1">&#39;{&#39;</span><span class="p">,</span>
<span class="lineno">12 </span>  <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{asctime}</span><span class="s1">  </span><span class="si">{levelname}</span><span class="s1">  </span><span class="si">{message}</span><span class="s1">&#39;</span><span class="p">,</span>
<span class="lineno">13 </span>  <span class="n">datefmt</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M&#39;</span>
<span class="lineno">14 </span><span class="p">)</span>
<span class="lineno">15 </span>
<span class="lineno">16 </span><span class="n">TM_DRIVE_NAMES</span> <span class="o">=</span> <span class="p">[</span>
<span class="lineno">17 </span>  <span class="s1">&#39;HG&#39;</span><span class="p">,</span>
<span class="lineno">18 </span>  <span class="s1">&#39;Orson-A&#39;</span><span class="p">,</span>
<span class="lineno">19 </span>  <span class="s1">&#39;Orson-B&#39;</span><span class="p">,</span>
<span class="lineno">20 </span>  <span class="p">]</span>
<span class="lineno">21 </span>
<span class="lineno">22 </span><span class="n">DiskutilAction</span> <span class="o">=</span> <span class="n">Enum</span><span class="p">(</span><span class="s1">&#39;DiskutilAction&#39;</span><span class="p">,</span> <span class="s1">&#39;mount unmount&#39;</span><span class="p">)</span>
<span class="lineno">23 </span>
<span class="lineno">24 </span>
<span class="lineno">25 </span><span class="k">def</span> <span class="nf">_diskutil_interface</span><span class="p">(</span><span class="n">drive_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="n">DiskutilAction</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="lineno">26 </span>  <span class="sd">&quot;&quot;&quot;Run diskutil through subprocess interface</span>
<span class="lineno">27 </span>
<span class="lineno">28 </span><span class="sd">  This is abstracted out because other the two (un)mounting functions</span>
<span class="lineno">29 </span><span class="sd">  would duplicate much of their code.</span>
<span class="lineno">30 </span>
<span class="lineno">31 </span><span class="sd">  Returns True if the return code is 0 (success), False on failure</span>
<span class="lineno">32 </span><span class="sd">  &quot;&quot;&quot;</span>
<span class="lineno">33 </span>  <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;diskutil&#39;</span><span class="p">,</span> <span class="s1">&#39;quiet&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">drive_name</span><span class="p">]</span>
<span class="lineno">34 </span>  <span class="k">return</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span>
<span class="lineno">35 </span>
<span class="lineno">36 </span>
<span class="lineno">37 </span><span class="k">def</span> <span class="nf">mount_drive</span><span class="p">(</span><span class="n">drive_name</span><span class="p">):</span>
<span class="lineno">38 </span>  <span class="sd">&quot;&quot;&quot;Try to mount drive using diskutil and return status code&quot;&quot;&quot;</span>
<span class="lineno">39 </span>  <span class="k">return</span> <span class="n">_diskutil_interface</span><span class="p">(</span><span class="n">drive_name</span><span class="p">,</span> <span class="n">DiskutilAction</span><span class="o">.</span><span class="n">mount</span><span class="p">)</span>
<span class="lineno">40 </span>
<span class="lineno">41 </span>
<span class="lineno">42 </span><span class="k">def</span> <span class="nf">unmount_drive</span><span class="p">(</span><span class="n">drive_name</span><span class="p">):</span>
<span class="lineno">43 </span>  <span class="sd">&quot;&quot;&quot;Try to unmount drive using diskutil and return status code&quot;&quot;&quot;</span>
<span class="lineno">44 </span>  <span class="k">return</span> <span class="n">_diskutil_interface</span><span class="p">(</span><span class="n">drive_name</span><span class="p">,</span> <span class="n">DiskutilAction</span><span class="o">.</span><span class="n">unmount</span><span class="p">)</span>
<span class="lineno">45 </span>
<span class="lineno">46 </span>
<span class="lineno">47 </span><span class="k">def</span> <span class="nf">begin_backup</span><span class="p">():</span>
<span class="lineno">48 </span>  <span class="sd">&quot;&quot;&quot;Back up using tmutil and return backup summary&quot;&quot;&quot;</span>
<span class="lineno">49 </span>  <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;tmutil&#39;</span><span class="p">,</span> <span class="s1">&#39;startbackup&#39;</span><span class="p">,</span> <span class="s1">&#39;--auto&#39;</span><span class="p">,</span> <span class="s1">&#39;--rotation&#39;</span><span class="p">,</span> <span class="s1">&#39;--block&#39;</span><span class="p">]</span>
<span class="lineno">50 </span>  <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<span class="lineno">51 </span>    <span class="n">args</span><span class="p">,</span>
<span class="lineno">52 </span>    <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
<span class="lineno">53 </span>    <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span>
<span class="lineno">54 </span>    <span class="p">)</span>
<span class="lineno">55 </span>  <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="lineno">56 </span>    <span class="k">return</span> <span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">returncode</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
<span class="lineno">57 </span>  <span class="k">else</span><span class="p">:</span>
<span class="lineno">58 </span>    <span class="k">return</span> <span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">returncode</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
<span class="lineno">59 </span>
<span class="lineno">60 </span>
<span class="lineno">61 </span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="lineno">62 </span>  <span class="n">drives_to_eject</span> <span class="o">=</span> <span class="p">[]</span>
<span class="lineno">63 </span>
<span class="lineno">64 </span>  <span class="k">for</span> <span class="n">drive_name</span> <span class="ow">in</span> <span class="n">TM_DRIVE_NAMES</span><span class="p">:</span>
<span class="lineno">65 </span>    <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;/Volumes&#39;</span><span class="p">,</span> <span class="n">drive_name</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<span class="lineno">66 </span>      <span class="k">continue</span>
<span class="lineno">67 </span>    <span class="k">elif</span> <span class="n">mount_drive</span><span class="p">(</span><span class="n">drive_name</span><span class="p">):</span>
<span class="lineno">68 </span>      <span class="n">drives_to_eject</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">drive_name</span><span class="p">)</span>
<span class="lineno">69 </span>    <span class="k">else</span><span class="p">:</span>
<span class="lineno">70 </span>      <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Failed to mount </span><span class="si">{drive_name}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="lineno">71 </span>
<span class="lineno">72 </span>  <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Beginning backup&#39;</span><span class="p">)</span>
<span class="lineno">73 </span>  <span class="n">return_code</span><span class="p">,</span> <span class="n">log_messages</span> <span class="o">=</span> <span class="n">begin_backup</span><span class="p">()</span>
<span class="lineno">74 </span>  <span class="n">log_func</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">info</span> <span class="k">if</span> <span class="n">return_code</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">logging</span><span class="o">.</span><span class="n">warning</span>
<span class="lineno">75 </span>  <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">log_messages</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
<span class="lineno">76 </span>    <span class="n">log_func</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<span class="lineno">77 </span>  <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Backup finished&#39;</span><span class="p">)</span>
<span class="lineno">78 </span>
<span class="lineno">79 </span>  <span class="k">for</span> <span class="n">drive_name</span> <span class="ow">in</span> <span class="n">drives_to_eject</span><span class="p">:</span>
<span class="lineno">80 </span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">unmount_drive</span><span class="p">(</span><span class="n">drive_name</span><span class="p">):</span>
<span class="lineno">81 </span>      <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Failed to unmount </span><span class="si">{drive_name}</span><span class="s1">, trying again…&#39;</span><span class="p">)</span>
<span class="lineno">82 </span>      <span class="k">if</span> <span class="ow">not</span> <span class="n">unmount_drive</span><span class="p">(</span><span class="n">drive_name</span><span class="p">):</span>
<span class="lineno">83 </span>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<span class="lineno">84 </span>          <span class="n">f</span><span class="s1">&#39;Failed to unmount </span><span class="si">{drive_name}</span><span class="s1"> on second attempt&#39;</span><span class="p">)</span>
<span class="lineno">85 </span>
<span class="lineno">86 </span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="lineno">87 </span>  <span class="n">main</span><span class="p">()</span>
</pre></div>


<p>The basic idea is the same: mount the backup drives if they’re not already, perform the backup using <code>tmutil</code>, and eject the drives that were mounted by the script afterwards. There’s nothing tricky in the script, except maybe the enum on line 22 — that’s to replace strings and risking a typo.</p>
<p>The arguments to <code>tmutil</code> on line 49 get Time Machine to behave as if it were running its ordinary, automatic hourly backups. The <a href="https://developer.apple.com/legacy/library/documentation/Darwin/Reference/ManPages/man8/tmutil.8.html"><code>tmutil</code> online man page</a> is out of date but does contain information on those options.</p>
<p>The version at work is the same except that it contains some code to skip backups overnight:</p>
<div class="syntax"><pre><span></span><span class="n">TIME_LIMITS</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">23</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">check_time</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">limits</span><span class="o">=</span><span class="n">TIME_LIMITS</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Return True if backup should proceed based on time of day&quot;&quot;&quot;</span>
  <span class="n">early_limit</span><span class="p">,</span> <span class="n">late_limit</span> <span class="o">=</span> <span class="n">limits</span>
  <span class="k">return</span> <span class="n">early_limit</span> <span class="o">&lt;=</span> <span class="n">time</span> <span class="o">&lt;=</span> <span class="n">late_limit</span>

<span class="c1"># And called like so:</span>
<span class="n">check_time</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span>
</pre></div>


<p>This was written pretty late at night so it’s not the best, but it does work.</p>
<h4>SuperDuper!</h4>
<p><a href="http://www.shirt-pocket.com">SuperDuper</a> is great, if you use it as it’s meant to be used. It runs after everyone’s gone home each evening.</p>
<p>I don’t look forward to booting from the 2.5″ clone drive but an external SSD was too expensive. In any case, should the Mini’s internal drive die the emergency plan is just to set up file sharing on one of our two SSD-equipped iMacs, copy over as many files as needed, and finish off the paper.</p>
<p>We’ve done this before when our internal network went down (a dead rack switch) and when a fire (at a nearby premises) forced us to produce the paper from a staff member’s kitchen. If such a thing happens again and the Mini is still functioning, I’d move that too as it’s not dog-slow like the old one.</p>
<p>In an ideal world we’d have a spare Mini ready to go, but that’s money we don’t have.</p>
<h4>Arq</h4>
<p>The Mini’s internal drive is backed up to S3. The <a href="https://aws.amazon.com/s3/storage-classes/#Infrequent_Access">infrequent access</a> storage class is used to keep the costs down, but using S3 over Glacier means we can restore files quickly.</p>
<p>The current year’s archive and last year’s are also kept in S3, because if the archive drives die we’re more likely to need more recent editions.</p>
<p>All of the archives are kept in <a href="https://aws.amazon.com/s3/storage-classes/#Amazon_Glacier">Glacier</a>, but the modern storage class rather than the legacy vaults. This includes the years that are kept in S3, so that we don’t suddenly have to upload 350GB of stuff as we remove them from the more expensive storage.</p>
<p>I’m slowly removing the legacy Glacier vaults, but it takes forever. You first have to empty the vault, then wait some time so you can actually remove the vault from the list in the management console. I use <a href="https://github.com/leeroybrun/glacier-vault-remove">Leeroy Brun’s glacier-vault-remove</a> tool, to which I had to make a minor change for it to work with Python 3.6 but it was straightforward to get running. (I think it was a missing <code>str.encode()</code> or something. Yes, I know, I should submit a pull request. But it was a one-second job.)</p>
<p>Depending on the size of your vaults, be prepared to have the script run for a long time — this is because of the way that Glacier works (slowly). It took a couple of days for me to remove a 1.5TB-ish vault, followed by a little wait (because the vault had been “recently accessed” — to create the inventory for deletion).</p>
<p>Arq’s ability to set hours during which backups should be paused is great — I could easily ensure our internet connection was fully available during the busiest part of the day.</p>
<p>These are set per-destination (good!) but if one destination is mid-backup and paused, your backups to other destinations won’t run. Consider this case:</p>
<ul>
<li>Our archive is being backed up to Glacier.</li>
<li>Archive backup is paused between 3pm and 7pm.</li>
<li>Backups of the server’s internal drive won’t run during 3pm to 7pm because the archive backup is “ongoing” — even if it is paused.</li>
</ul>
<p>What that meant in practice is that the internal drive wasn’t being backed up to S3 hourly during the (weeks-long) archive backup, except if “Stop backup” is pressed during the pause interval to allow other destinations to backup.</p>
<p>Ideally, paused backups would be put to one side during that window of time and other destinations allowed to run.</p>
<h4>Backblaze</h4>
<p>Our initial 3.5TB <a href="https://secure.backblaze.com/r/010t3l">Backblaze</a> (Star affiliate link) backup is still ongoing, at about 50GB a day over one of our two 17mbps-up fibre lines. In all it’ll have taken a couple of months, compared to a couple of weeks for Arq to S3 &amp; Glacier.</p>
<p>One thing I’ve noticed from personal use at home is that Arq has no qualms about using your entire bandwidth, whereas Backblaze does seem to try not to clog your whole connection. That’s fine at home, but at work with more than one line it matters less.</p>
<p>I was hesitant to write this post up before we’re all set with Backblaze, but it’s got about a week to run still.</p>
<p>I’m interested in seeing what “continuous” backups means in practice, but the <a href="https://help.backblaze.com/hc/en-us/articles/217666288-Schedule-Settings-Mac-">scheduling help page</a> says: “For most computers, this results in roughly 1 backup per hour.” The important thing for me is having an additional regular remote backup separate to Arq (mostly paranoia).</p>
<h3>Enhancements?</h3>
<p>Were money no object, I have some ideas for improvements.</p>
<p>First would be to add <a href="https://cloud.google.com/storage/">Google Cloud Storage</a> as an Arq backup destination, replicating our S3-IA/Glacier split with Google’s <a href="https://cloud.google.com/storage/archival/">Nearline/Coldline</a> storage. It would “just” give us an additional Arq backup, not dependent on AWS.</p>
<p>A big reason why I added Backblaze is to have a remote backup that neither relied on AWS nor Arq. (That’s really not to say that I don’t trust Arq, it’s an eggs-in-one-basket thing.)</p>
<p>Next I’d add an additional Time Machine drive (for a total of three). Running every 20 minutes means that the load on each drive is 50% higher over two hours than the ordinary one backup per hour. Adding a third drive would mean that each drive is being backed up only once per hour. And it would also mean that there is backup history stored on <em>two</em> drives should one fail.</p>
<p>An external SSD to hold a SuperDuper clone is tempting, for the speed and because it might mean that we could continue to use the Mini as usual until we could get the internal drive replaced. (Though that might well be a bad idea.) Our server contains nowhere near its 1TB capacity, so we might get away with a smaller SSD.</p>
<p>And, maybe, instead of extra drives for RAID mirrors (as discussed above), a network-attached storage (NAS) device. But I have no experience with them nor any idea about how best to make use of one. And they seem to be a bit of a black box to me, and a major goal for our setup (Mac Mini, external drives, GUI backup programs) is to be reasonably understandable to any member of production staff — after all, we’re all journalists, not IT workers.</p>
  </article>
  <article>
    <header>
      <h2 class="mute-links"><a href="https://robjwells.github.io/2017/03/o-claudio/">O, Claudio</a></h2>
      <p><time datetime="2017-03-17T00:45">Friday, March 17 2017</time></p>
    </header>
    <p>It’s that time again, time to ponder Leicester’s fortunes now that we’re well within the final third of the season. Our plucky Foxes have 11 games to go. Can they escape to something-well-short-of-victory or will the wrenching despair of Claudio Ranieri’s sacking be too crushing to overcome?</p>
<p>To set the stage for our pretty pictures, let’s remind ourselves of that abyss of <a href="http://www.leaguemanagers.com/news/lma-latest/claudio-ranieri-statement/">guilt and shame</a>.</p>
<blockquote>
<p>“My heartfelt thanks to everybody at the club, all the players, the staff, everybody who was there and was part of what we achieved.</p>
<p>“But mostly to the supporters. You took me into your hearts from day one and loved me. I love you too.</p>
<p>“No-one can ever take away what we together have achieved, and I hope you think about it and smile every day the way I always will.”</p>
</blockquote>
<p>I well up every time I read that. Heartbreaking.</p>
<p>I’ve ditched the “points after x games” chart from our <a href="https://www.robjwells.com/2016/12/everything-is-wrong/">previous</a> <a href="https://www.robjwells.com/2016/09/leicesters-start-to-the-season/">two</a> outings because it’s not much help anymore. (Also because of the existential sadness.)</p>
<p class="full-width">
    <a href="/images/2017-03-17_lcfc-points_over_time.svg">
        <img alt="A chart showing Leicester City’s points over time in the 2014-15 to 2016-17 seasons as of 2017-03-17"
             src="/images/2017-03-17_lcfc-points_over_time.svg"
             class="no-border"
             width=720
             height=549
             >
    </a>
</p>

<p>Er. Hm. I was going to mark when Claudio was sacked but, c’mon, it’s that upturn for game 26 when we beat Liverpool 3-1. That was literally a couple days after he was sacked. The next week it was 3-1 against Hull (yeah, OK).</p>
<p>Otherwise, the current season looks roughly like the disastrous/heroic 2014-15, but notably without the long nearly point-less spell in the first half and so the recovery looks like it’s come much earlier.</p>
<p>For the first half the season Leicester were clinging to the safety trend line, as shown very clearly below:</p>
<p class="full-width">
    <a href="/images/2017-03-17_lcfc-points_adrift.svg">
        <img alt="A chart showing Leicester City’s distance from the safety trend, 2014-15 to 2016-17 seasons as of 2017-03-17"
             src="/images/2017-03-17_lcfc-points_adrift.svg"
             class="no-border"
             width=720
             height=411
             >
    </a>
</p>

<p>The most worrying part is that sharp decline at the start of the second half — certainly bringing back memories of two years ago. There really isn’t a huge amount in it, but that cushion of a few points could mean a lot.</p>
<p>It’s worth revisiting the reason why I focus so much on that safety trend, given my <a href="https://www.robjwells.com/2016/09/leicesters-start-to-the-season/">first such post</a>:</p>
<blockquote>
<p>The dashed line represents steady progress towards the magical 40 points to avoid relegation. (West Ham landed in the drop zone with 42 points in 2002–3, but that was unusual. Most of the time you need even fewer points; last season it was 38.)</p>
</blockquote>
<p>This season is a bit more competitive than last; the bottom-placed team currently (Sunderland, 19) has more points than the bottom-placed team did at the end of last term (Aston Villa, 17).</p>
<p>But clawing your way up out of the drop zone is bloody hard, and we mustn’t forget just how bloody close the end of 2014-15 was: Leicester finished with 41 points, just six more than 18th-placed Hull and with three other sides between the two.</p>
<p>That said, the fight is not necessarily with the other low-placed teams, the fight is with whoever you’ve got facing you on the pitch. And then we’re back to the importance of that safety line: snatching as many points wherever you can get them, however (within reason) you can get them.</p>
<p>At work, <a href="https://morningstaronline.co.uk/a-dd42-What-price-Claudio">Roger Domeneghetti asked how much the Foxes owe Claudio</a>. At the time I was well in a post-Claudio daze, but ultimately he’s right. The Foxes owe Claudio a lot, a huge amount, but they don’t owe him relegation. You can “What if?” the possibilities if he’d had stayed, but before those two consecutive wins Leicester certainly looked headed for the drop — and staying up is still far from certain.</p>
<p>I’ll always love you Claudio, but few things last forever.</p>
  </article>
  <article>
    <header>
      <h2 class="mute-links"><a href="https://robjwells.github.io/2017/03/reaching-the-olympic-park-from-cs2/">Reaching the Olympic Park from CS2</a></h2>
      <p><time datetime="2017-03-15T02:20">Wednesday, March 15 2017</time></p>
    </header>
    <p>When I moved from south-east London to east London last year, one of the things I was looking forward to was fairly quick access to <a href="http://content.tfl.gov.uk/cs2-stratford-aldgate.pdf">CS2</a>, a substantially-segregated route from Stratford to Aldgate.</p>
<p>To get to CS2, I go from my home in Leyton to the northern half of the Olympic Park via Temple Mills Lane and Honour Lea Avenue. From there it’s a nice, traffic-free cycle into the southern half of the park.</p>
<p>But at that point you need to make a decision where you need to go because there’s no traffic-free or segregated way of reaching CS2 on Stratford High Street from the park. (We built a massive naff-off Velodrome but won’t give people a safe way to get to it from the main road. It’s ludicrous.)</p>
<p>I’ve generally gone to the roundabout at the junction of Montfichet and Warton Roads, then down Warton to Stratford High Street, and then turn right at the crossroads into the segregated CS2.</p>
<p>But Warton is a horrible traffic sewer, being one of the few ways to get from Stratford proper to the Westfield shopping centre. Newham have recently installed a series of raised tables and raised crossings in an attempt to slow the traffic, <a href="http://www.aviewfromthecyclepath.com/2016/08/speed-bumps-are-not-effective-traffic.html">an example of tackling the symptoms rather than the cause</a>. It’s not pleasant to cycle and a couple of years ago <a href="http://www.independent.co.uk/travel/news-and-advice/britains-most-dangerous-road-junctions-for-cyclists-revealed-10463236.html">the junction with Stratford High Street was ranked as one of the most dangerous for people on bikes</a>.</p>
<p>Coming the other way, eastbound, things have been made worse by the Weston Homes development along Stratford High Street, with sections of the segregated tracked regularly closed. This forces people on bikes to join a lane of fast-moving traffic.</p>
<p>Take, for example, the surprise cones <a href="https://twitter.com/sw19cam/status/837412315691642881">captured by @SW19cam</a>:</p>
<p class="full-width">
    <a href="https://twitter.com/sw19cam/status/837412315691642881">
        <img
            src="/images/2017-03-15-cs2-sw19cam.jpg"
            alt="Suprise cones on CS2"
            />
    </a>
</p>

<p>The sadly typical “Cyclists sod off” <a href="https://twitter.com/RossiTheBossi/status/809767469749571585">snapped by @RossiTheBossi</a>, complete with van sitting in the track:</p>
<p class="full-width">
    <a href="https://twitter.com/RossiTheBossi/status/809767469749571585">
        <img
            src="/images/2017-03-15-cs2-rossithebossi.jpg"
            alt="Cyclists Dismount"
            />
    </a>
</p>

<p>And then there’s <a href="https://twitter.com/LuciaQuenya/status/841610000049008640">Lucia Quenya’s video</a> of the mess:</p>
<p class="full-width">
    <video
        src="/images/2017-03-15-lucia-quenya.mp4"
        poster="/images/2017-03-15-lucia-quenya.jpg"
        controls
        muted
        preload="metadata"
        >
    </video>
</p>

<p>I now try to avoid this section of CS2 when heading home and — spurred on by <a href="http://diamondgeezer.blogspot.co.uk/2017/03/barbers-road.html">Diamond Geezer</a> — I think I’ve settled on a largely traffic-free route that avoids Warton Road and the Weston Homes works. Here’s a modified screenshot from Google Maps:</p>
<p class="full-width">
    <img
        src="/images/2017-03-15-cs2-to-park.png"
        alt="A map of the lower section of the Olympic Park and Stratford High Street"
        />
</p>

<p>Basically, heading east, you take the first left after Bow roundabout (into Cook’s Road), follow the road round, and then turn left after Pudding Mill Lane DLR station. Turn right at the lights, then go up the dropped kerb immediately after the bridge. That puts you in the big chunk of empty ground to the south of the <a href="https://en.wikipedia.org/wiki/ArcelorMittal_Orbit">Squiggle</a> and you can go on your merry way.</p>
<p>Heading west it’s the same until you reach the junction of Stratford High Street, but at that point dismount and head for <a href="http://diamondgeezer.blogspot.co.uk/2016/09/bows-h-shaped-roundabout.html">the pedestrian crossing</a> to your right. You can then join the advanced stop box heading west.</p>
<p>The route shown in the map above isn’t direct by any means, and you may encounter the odd large vehicle between Loop Road and Stratford High Street — whether construction or industrial. It’s also likely to be impassable on West Ham home match days.</p>
<p>It’s not a great trade-off, and it’s crackers that this is even necessary if you want to avoid motors so close to the Olympic Park (<a href="http://hackneycyclist.blogspot.co.uk/2017/02/a-new-road-in-olympic-park.html">#Legacy</a>) and the CS2 extension — <a href="http://lcc.org.uk/articles/mayors-cycle-superhighway-2-extension-the-first-step-towards-going-dutch-for-london-cyclists">the first CSH section that was substantially segregated</a>.</p>
<p>But that’s the situation we’re in.</p>
  </article>
  <article>
    <header>
      <h2 class="mute-links"><a href="https://robjwells.github.io/2017/03/backups-before/">Backups: before</a></h2>
      <p><time datetime="2017-03-14T15:00">Tuesday, March 14 2017</time></p>
    </header>
    <p>At <a href="https://www.morningstaronline.co.uk">work</a> I’m responsible for our office file server, which is mostly used for storing the InDesign pages and related files we need to produce the paper every day.</p>
<p>At the end of 2016 we replaced the server, which was a 2010 or 2011 Mac Mini, with a “current” Mac Mini — the 2014 release. That wasn’t ideal and part of the reason why I hadn’t replaced it sooner was because I was waiting for Apple to at least refresh the specs.</p>
<p>In any case, we got to a point where the machine needed swapping. The final straw for me was being unable to trust that the backups would run reliably.</p>
<p>Ever since I got my current post (in mid-2014) I’d been meaning to overhaul our backup strategy but it was always a case of “I’ll do it when we replace the server.” It’s worth sketching out what we were doing before moving on to what caused concern and what I’ve replaced it with now.</p>
<p>In this, I’m going to include <a href="https://en.wikipedia.org/wiki/RAID">RAID</a> because the redundancy side of things also changes. For context, our working day is roughly 10am-7pm Sunday–Friday:</p>
<ul>
<li>Two 500GB drives in the Mini itself, in <a href="https://en.wikipedia.org/wiki/Standard_RAID_levels#RAID_1">RAID 1 (mirrored)</a>.</li>
<li><a href="http://www.shirt-pocket.com">SuperDuper!</a> copies (newer files) to two drives (in RAID 1) at — if I remember correctly — 9am, 12pm, 3pm, 5pm, 9pm, Sunday–Friday.</li>
<li>Daily SuperDuper copies (newer files) to two drives (in RAID 1) at about 9pm, Sunday–Friday.</li>
<li>Weekly SuperDuper erase-and-copy on Saturday to both the three-ish-hourly mirrors and the daily mirrors.</li>
<li><a href="https://www.arqbackup.com">Arq</a> backups to (old-style) <a href="https://aws.amazon.com/glacier/">Glacier</a> vaults, once a day.</li>
</ul>
<p>The SuperDuper copies were done to a set of USB 2 disk enclosures, containing ordinary 3.5″ drives.</p>
<p>You’ll have noticed some fuzziness in my recollections just there, for an important reason: the machine’s performance was so poor everything bled into each other. It was totally competent serving files over <a href="https://en.wikipedia.org/wiki/Apple_Filing_Protocol">AFP</a> but trying to work on the machine itself was a nightmare.</p>
<p>And this is the point where it gets concerning. It wasn’t rare to log in to the server to find a SuperDuper copy having run for 12 hours and still going, or that Arq had hung and needed its agent restarted. Both are solid pieces of software (though it was an older version of Arq, v3 I think) so the blame does lie with the machine.</p>
<p>Which is odd, really, because its only tasks were:</p>
<ul>
<li>Serve files on the local network over AFP (to fewer than 25 users).</li>
<li>Run OS X Server to handle user log-in (for access to files only).</li>
<li>Host our internal (unloved and little-used) wiki.</li>
<li>Perform backups (of its own drives).</li>
</ul>
<p>Hopefully you can spot the problems — both the ones inherent in the strategy and the ones that result from poor performance:</p>
<ul>
<li>
<p>Local backups were relatively infrequent and could result in hours of data loss.</p>
<p>This is a bit dicey when our business relies on getting all pages to the printers by the early evening. Each page takes about an hour of work to create.</p>
</li>
<li>
<p>Local backups may not complete in a timely fashion.</p>
<p>This exacerbates the point above, and the cause wasn’t readily apparent.</p>
</li>
<li>
<p>Local backups, as copies, don’t allow for the recovery of older versions of a file.</p>
<p>So if you accidentally erase everything off a page, save it, and it’s backed up, you can’t recover the previous state unless it was picked up by the previous daily backup. (That’s an unlikely event, since most pages are created, finished and published between daily backups.) </p>
</li>
<li>
<p>Remote backups, because they were stored in Glacier, would take several hours even to reach the point where files could begin to be restored.</p>
<p>Even if they were hourly (not our case), if you lose a page an hour before deadline and it’s not backed-up locally your only option is to recreate the page because there’s no chance you’ll get it out of Glacier fast enough.</p>
</li>
</ul>
<p>Let’s walk through perhaps the most likely example of data loss during our working day, when a user accidentally deletes a file (taking an InDesign page as our file):</p>
<p>Because of the way deletes work over <a href="https://en.wikipedia.org/wiki/Apple_Filing_Protocol">AFP</a> &amp; <a href="https://en.wikipedia.org/wiki/Server_Message_Block">SMB</a>, the deleted file is removed <em>immediately</em>, in contrast to a local delete requiring two steps to complete (usually): the file is moved to the trash, the trash is emptied.</p>
<p>First, the local backups are checked. In the lucky case, a backup has run recently (and completed timely!), otherwise you could face up to three hours’ data loss, which could be all of the work on that page.</p>
<p>If the page was created on a previous day (uncommon) then you’d also check the daily local backups, hoping that the page was substantially complete at that point.</p>
<p>Then you’d check the remote backups, hoping that (like above) the page was substantially complete at the point that the backup ran and that you have the three-to-five hours needed for the restore to begin.</p>
<p>It’s perhaps clear that the chances of recovering your work are <em>not good</em>. It gets even worse when you consider the next common case: that a user modifies a complete page, destroying the original work, and that modified version replaces the original on the more-frequent local backups.</p>
<p>(When I was very new at the Star I did something similar. I was asked to work on a features page for the following day. I opened up the corresponding page for edition to save a copy but for whatever reason didn’t — and began to work <em>on the “live” page for edition</em>. When this was noticed — close to deadline! — I was thankfully able to undo my way back to the original state, as I hadn’t closed InDesign since opening it. It was an <em>incredibly</em> close call that still makes me feel queasy when I think about it.)</p>
<p>So while we did have a strategy that included both local and remote backups, it was effectively useless. That everything locally was in RAID 1 — meaning that if one drive of a mirror fails, you don’t lose data — I think just shows that when it was set up, the core purpose of backing up our data was misunderstood. </p>
<p>We had copies of our business-critical data, but constructed in such a way that protection against drive failure was far, far more important that the much more common case of restoring fast-changing files. In this system, you could have five drives die and still have a copy of our server data locally, or all six die (perhaps in a fire) and be able to recover remotely.</p>
<p>To sum up, it was reasonable protection for a rare event but little protection for a common event.</p>
<p>It is, of course, possible to have both. In <a href="https://www.robjwells.com/2017/03/backups-the-change/">my next post</a> I’ll go into what’s changed, why, and what that means for protecting our data in both the common and rare cases.</p>
  </article>
  <article>
    <header>
      <h2 class="mute-links"><a href="https://robjwells.github.io/2017/03/tube-crowding/">Tube crowding</a></h2>
      <p><time datetime="2017-03-13T23:10">Monday, March 13 2017</time></p>
    </header>
    <p>Last week <a href="https://blog.tfl.gov.uk/2017/03/09/new-tube-customer-volumes-and-movements-data/">TfL released some data about crowding on Tube trains</a>. There’s a good write-up by <a href="http://diamondgeezer.blogspot.co.uk/2017/03/tubesquash.html">Diamond Geezer</a>.</p>
<p>Basically, TfL give each 15-minute slot on each line in each direction a rating from 1 (quiet) to 6 (stuffed). I thought I’d have a go at turning that data into some heatmaps, so you can pick out the busiest times more easily.</p>
<p>Now, this was my first time trying to make heatmaps, my first time using <a href="http://seaborn.pydata.org">Seaborn</a> and my first time using <a href="http://pandas.pydata.org">Pandas</a>. The plots are not great. I basically got to the end of my tether trying to sort the code out and ended up spending a chunk of time polishing the resulting images. Even then…</p>
<p>Before we go any further, all the plots are linked to the SVG files if you want to have a closer look as the labels appear quite small. Also, I’m only going to describe the oddities in the plots, not draw conclusions from them — others can do that if they’re interested.</p>
<p>Let’s start with the <a href="https://en.wikipedia.org/wiki/Waterloo_%26_City_line">Waterloo &amp; City</a> line because it’s simplest:</p>
<p class="full-width">
    <a href="/images/2017-03-13-Tube-Crowding-WC.svg">
        <img
        src="/images/2017-03-13-Tube-Crowding-WC.svg"
        alt="Tube crowding on the Waterloo & City line"
        class="no-border"
        width=720
        height=80
        />
    </a>
</p>

<p>Hopefully you can pick out the labels on the left showing the source and destination stations, the times (5am to 2am) and the change in colour showing how crowded the trains are. It’s quite easy to pick out the peaks here: Waterloo to Bank around 8 and 9am, Bank to Waterloo around 5 and 6pm.</p>
<p>Now, in alphabetical order, let’s go through the rest. <a href="https://en.wikipedia.org/wiki/Bakerloo_line">Bakerloo</a>:</p>
<p class="full-width">
    <a href="/images/2017-03-13-Tube-Crowding-Bakerloo.svg">
        <img
        src="/images/2017-03-13-Tube-Crowding-Bakerloo.svg"
        alt="Tube crowding on the Bakerloo line"
        class="no-border"
        width=720
        height=360
        />
    </a>
</p>

<p>Note here something that applies to the rest: not all pairs of stations are listed as I was having trouble making them legible. I tend to leave out every other pair so, above, it’s implied that after <em>Harrow &amp; Wealdstone → Kenton</em> and before <em>South Kenton → North Wembley</em> there is <em>Kenton → South Kenton</em>. But, as we’ll see, this isn’t always the case.</p>
<p>Looking at the early morning services in Kenton and Wembley it is pretty obvious, as <a href="http://diamondgeezer.blogspot.co.uk/2017/03/tubesquash.html">Diamond Geezer pointed out</a>, that someone has been mucking about with the data.</p>
<p>Next, <a href="https://en.wikipedia.org/wiki/Central_line_(London_Underground)">Central</a>:</p>
<p class="full-width">
    <a href="/images/2017-03-13-Tube-Crowding-Central.svg">
        <img
        src="/images/2017-03-13-Tube-Crowding-Central.svg"
        alt="Tube crowding on the Central line"
        class="no-border"
        width=720
        height=720
        />
    </a>
</p>

<p>This was one of the first plots I “tidied” which is why the scale is missing. Note here the apparent disappearance of lots of travellers in the top-left and bottom-right of each plot. This is because of branching lines. I’ve tried to keep in the first station for each branch for each direction but it isn’t always the case. You may want to read these alongside <a href="https://tfl.gov.uk/maps/track/tube">the Tube map</a>.</p>
<p><a href="https://en.wikipedia.org/wiki/Circle_line_(London_Underground)">Circle</a>:</p>
<p class="full-width">
    <a href="/images/2017-03-13-Tube-Crowding-Circle.svg">
        <img
        src="/images/2017-03-13-Tube-Crowding-Circle.svg"
        alt="Tube crowding on the Circle line"
        class="no-border"
        width=720
        height=360
        />
    </a>
</p>

<p>Not this is only the “Outer Rail” and “Inner Rail” — clockwise and anti-clockwise — sections of the Circle line, starting at Edgware Road. I left off the “jug handle” between Paddington and Hammersmith, which was pretty quiet anyway. In fact the whole line is fairly quiet — something DG pointed out — so the data is a bit suspect.</p>
<p><a href="https://en.wikipedia.org/wiki/District_line">District</a>:</p>
<p class="full-width">
    <a href="/images/2017-03-13-Tube-Crowding-District.svg">
        <img
        src="/images/2017-03-13-Tube-Crowding-District.svg"
        alt="Tube crowding on the District line"
        class="no-border"
        width=720
        height=700
        />
    </a>
</p>

<p>All those cut-off bits are because of the five branches in west London. <a href="https://en.wikipedia.org/wiki/District_line">It’s a weird line</a> for historical reasons. Again I’m sceptical about the data because the District is the busiest sub-surface line, but the plots show that to be the <a href="https://en.wikipedia.org/wiki/Hammersmith_%26_City_line">Hammersmith &amp; City</a>:</p>
<p class="full-width">
    <a href="/images/2017-03-13-Tube-Crowding-HC.svg">
        <img
        src="/images/2017-03-13-Tube-Crowding-HC.svg"
        alt="Tube crowding on the Hammersmith & City line"
        class="no-border"
        width=720
        height=380
        />
    </a>
</p>

<p>No branches. Hurrah. Next.</p>
<p><a href="https://en.wikipedia.org/wiki/Jubilee_line">Jubilee</a>:</p>
<p class="full-width">
    <a href="/images/2017-03-13-Tube-Crowding-Jubilee.svg">
        <img
        src="/images/2017-03-13-Tube-Crowding-Jubilee.svg"
        alt="Tube crowding on the Jubilee line"
        class="no-border"
        width=720
        height=360
        />
    </a>
</p>

<p>I love how Canary Wharf slices across these charts.</p>
<p>Let’s sod off to <a href="/images/2017-03-13-metro-land.jpg">Metro-land</a>:</p>
<p class="full-width">
    <a href="/images/2017-03-13-Tube-Crowding-Metropolitan.svg">
        <img
        src="/images/2017-03-13-Tube-Crowding-Metropolitan.svg"
        alt="Tube crowding on the Metropolitan line"
        class="no-border"
        width=720
        height=430
        />
    </a>
</p>

<p>The <a href="https://en.wikipedia.org/wiki/Metropolitan_line">Metropolitan</a> line appears to be weirdly spacious in the evenings given how rammed it is in the morning. I’ve no idea if either is true to life.</p>
<p>More branching fun with the <a href="https://en.wikipedia.org/wiki/Northern_line">Northern</a> line:</p>
<p class="full-width">
    <a href="/images/2017-03-13-Tube-Crowding-Northern.svg">
        <img
        src="/images/2017-03-13-Tube-Crowding-Northern.svg"
        alt="Tube crowding on the Northern line"
        class="no-border"
        width=720
        height=620
        />
    </a>
</p>

<p>I know, it’s weird, I should have done separate charts or something but TfL need to get on with it and <a href="http://www.standard.co.uk/news/northern-line-service-divided-in-312m-bid-to-end-overcrowding-6468560.html">split it up</a>.</p>
<p><a href="https://en.wikipedia.org/wiki/Piccadilly_line">Piccadilly</a>:</p>
<p class="full-width">
    <a href="/images/2017-03-13-Tube-Crowding-Piccadilly.svg">
        <img
        src="/images/2017-03-13-Tube-Crowding-Piccadilly.svg"
        alt="Tube crowding on the Piccadilly line"
        class="no-border"
        width=720
        height=630
        />
    </a>
</p>

<p>Strange pattern there, but it’s another strange line. Thankfully the last one is straightforward, the <a href="https://en.wikipedia.org/wiki/Victoria_line">Victoria</a>:</p>
<p class="full-width">
    <a href="/images/2017-03-13-Tube-Crowding-Victoria.svg">
        <img
        src="/images/2017-03-13-Tube-Crowding-Victoria.svg"
        alt="Tube crowding on the Victoria line"
        class="no-border"
        width=720
        height=240
        />
    </a>
</p>

<p>Doesn’t look too bad, that one.</p>
<p>Sorry the charts were so poor, do let me know what I should’ve done differently, or just whinge — I’m just glad this is over.</p>
  </article>
  <div class="pagination">
<p class="pagination-older"><a href="https://robjwells.github.io/page-6/">Older posts</a></p><p class="pagination-newer"><a href="https://robjwells.github.io/page-4/">Newer posts</a></p>  </div>

</main>

<footer class="site-footer">
  <small class="mute-links">
    This work is licensed under a
    <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">
    Creative Commons Attribution 4.0 International License</a>.
  </small>
</footer> <!-- .site-footer -->

</div> <!-- .wrapper -->

</body>

</html>