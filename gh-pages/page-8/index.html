<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Primary Unit mirror on GitHub – page 8</title>

  <!-- Load my combined stylesheet -->
  <link rel="stylesheet" href="/resources/all.min.css">


  <link rel="license" href="https://creativecommons.org/licenses/by/4.0/">

  <link rel="alternate" type="application/rss+xml" title="RSS feed for Primary Unit" href="/rss">
  <link rel="alternate" type="application/json" title="JSON feed for Primary Unit" href="/feed.json">

  <!-- Apple pinned sites icon, Apple touch icon, Favicon -->
  <link rel="mask-icon" href="/resources/favicon.svg" color="#1369BF">
  <link rel="apple-touch-icon-precomposed" href="/resources/favicon.png">
  <link rel="icon" href="/resources/favicon.ico">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="A mirror of https://www.robjwells.com hosted on GitHub">
</head>

<body>

<div class="wrapper">

<header class="site-header">

  <div class="site-title-container mute-links">
    <h1 class="site-title"><a href="https://robjwells.github.io">Primary Unit mirror on GitHub</a></h1>
    <p class="site-byline"><i>by</i> Rob Wells</p>
  </div>

  <div class="site-menu-container">

    <nav id="site-nav">
      <ul class="site-links mute-links">
        <li><a href="/about/">About</a></li>
        <li><a href="/archives/">Archives</a></li>
        <li><a href="/feed.json">JSON&nbsp;feed</a></li>
        <li><a href="/rss">RSS&nbsp;feed</a></li>
      </ul>
    </nav>

    <label for="search-field" class="site-search-label">
      Site search
    </label>
    <form id="site-search" class="site-search" method="get" action="https://duckduckgo.com/">
      <input name="q" type="text" id="search-field" class="search-field" placeholder="via DuckDuckGo">
      <input name="sites" value="https://robjwells.github.io" hidden>
      <button type="submit" class="search-button">Search</button>
    </form>

  </div> <!-- .site-menu-container -->

</header> <!-- .site-header -->

<main role="main">

  <article>
    <header>
      <h2 class="mute-links"><a href="https://robjwells.github.io/2016/12/language-is-hard-strings-are-great/">Language is hard, strings are great</a></h2>
      <p><time datetime="2016-12-01T23:40">Thursday, December 1 2016</time></p>
    </header>
    <p><a href="https://alexwlchan.net/2016/12/strings-are-terrible/">Alex Chan wrote a short post today</a> dealing with an oddity with Python’s <code>.lower()</code> string method, which converts a string to all lower case.</p>
<p>In short, the problem is this:</p>
<pre><code>&gt;&gt;&gt; print('\u0130',
...       len('\u0130'))
İ 1
&gt;&gt;&gt; print('\u0130'.lower(),
...       len('\u0130'.lower()))
i̇  2</code></pre>


<p>(Print is used because I was having trouble with the closing quote disappearing in the second case and didn’t want to mislead you over the output — this is a hint as to the problem! That said, I inserted an extra space to get the second case to display properly for me, which you may or may not see.)</p>
<p>So you have an upper-case dotted i (İ), <a href="https://en.wikipedia.org/wiki/Dotted_and_dotless_I">used in a few alphabets but mainly Turkish</a>, which is of length 1 in Python, but lowercase is length 2.</p>
<p>Why’s this happening? The first answer is that the length of Python strings is the number of Unicode code points — not the number of perceived characters. In the lower case we have a small latin i with a combining dot afterwards.</p>
<p>Swift is a language that seems to handle the characters or code points split very well:</p>
<pre><code>1&gt; print(&quot;\u{0130}&quot;,
         &quot;\u{0130}&quot;.unicodeScalars.count,
         &quot;\u{0130}&quot;.characters.count)
İ 1 1

2&gt; print(&quot;\u{0130}&quot;.lowercased(),
         &quot;\u{0130}&quot;.lowercased().unicodeScalars.count,
         &quot;\u{0130}&quot;.lowercased().characters.count)
i̇  2 1</code></pre>


<p>(Extra space again!)</p>
<p>Here, both consist of a single character but different numbers of code points. I’ve barely used Swift so I don’t know if it has any Unicode gotchas, but this seems to be the right way to handle it and something I’d like in Python (4?).</p>
<p>So that’s the first answer. The second is that İ is a special case in Unicode: literally the second entry in the <a href="http://www.unicode.org/Public/UNIDATA/SpecialCasing.txt">Unicode special cases document</a>.</p>
<p>In the Turkish alphabet, a lowercase İ is i — the standard latin small letter i. But if that’s what you got from <code>.lower()</code> you’d end up with a totally different letter if you were to then call <code>.upper()</code>:</p>
<pre><code>İ -&gt; i -&gt; I     # Wrong at the end</code></pre>


<p>In the Turkish alphabet, I is the capital form of ı — a small dot-less i. So a round trip would destroy the original character. That’s why in Unicode the decision was made to turn it into i̇, a small latin i with an additional dot above. It seems to be a character that only exists to allow for round-tripping İ:</p>
<pre><code>İ -&gt; i̇ -&gt; İ    # Sort-of wrong in the middle</code></pre>


<p>The latter is, yes, incorrect. Turkish-specific casing functions would handle this differently. There’s two arguments to made here: it’s a practical decision based on <code>i -&gt; I</code> being the most common in languages using Latin script; or it shows how Latin script-centric computing is.</p>
<p>The way to handle this would be locale-specific case transformations, the conclusion of <a href="http://bugs.python.org/issue17252">a Python bug discussion about this very issue</a>. As is mentioned at the end of that thread, you’ll want to look at <a href="https://github.com/ovalhub/pyicu">PyICU</a> if you have to deal with these kinds of differences.</p>
<p>So, where does that leave us? First, it should be a caution that certain language properties that we take for granted may not be universal.</p>
<p>In Alex’s case, the assumption was that a mixed- or upper-case string has a lower-case transformation that is of the same length. (Although, as we’ve seen, if <code>.lower()</code> did what would be ideal for Turkish alphabet users then it would be the same length.)</p>
<p>That point can be expanded out when you find out that <a href="https://en.wikipedia.org/wiki/Letter_case#Bicameral_script">many scripts are <em>unicameral</em> and don’t have case distinctions</a>.</p>
<p>The second is that the representation of a string does not necessarily match the perceived length of a string. Swift exposing both <code>characters</code> and <code>unicodeScalars</code> makes that plain: characters are what you expect, Unicode scalars are how those characters are stored. And just look to Python 2’s <code>str</code> type for yet another example — a bag of bytes that may or may not be text.</p>
  </article>
  <article>
    <header>
      <h2 class="mute-links"><a href="https://robjwells.github.io/2016/11/trump/">Trump</a></h2>
      <p><time datetime="2016-11-09T09:15">Wednesday, November 9 2016</time></p>
    </header>
    <p>At work, we tend to avoid US politics. I think partly that’s a reaction to the obsession of the rest of the British media with the US as the imperial centre and their tendency to see commonalities with our own (political) culture that aren’t really there.</p>
<p>But, I’m not at work yet, so why not? The Trump victory is being portrayed as an upset here but I think it’s unhelpful to see it as massively unexpected (though I did think the result would come out the other way).</p>
<p>That the polls were close was a real sign of trouble given Trump’s extreme statements. They, and the eventual result, show just how weak a candidate Hillary Clinton was. Head-to-head polls in May put <a href="http://www.realclearpolitics.com/epolls/2016/president/us/general_election_trump_vs_clinton-5491.html">Clinton 3 percentage points ahead of Trump</a> on average, but her left-wing primary challenger <a href="http://www.realclearpolitics.com/epolls/2016/president/us/general_election_trump_vs_sanders-5565.html">Bernie Sanders 10 points ahead</a>. There’s no way to say if that lead would have held up: Clinton once held a similar lead that evaporated.</p>
<p>Whatever you think of Trump, a filthy-rich racist demagogue, he at the very least engaged with some of the real concerns of voters. Clinton’s ideological position meant that she was incapable of doing so. She couldn’t talk seriously — or be taken seriously — about, say, jobs and industry because her position is one of support for the capitalist forces that are putting people out of work and wrecking entire sectors.</p>
<p>It’s not that Trump is truly different on that score, but his campaign has used the tactics of the far right of taking real concerns and appearing to address them using hatred against marginalised groups. There are clear historical parallels to be drawn but I won’t here.</p>
<p>Clinton couldn’t do that. She was clearly the Establishment candidate, repeating in the way that they have for decades that you can’t challenge the supremacy of the market but, trust me, I’ll manage it better than the other guy. At this point, people have rejected that forcefully and publicly.</p>
<p>But the Democrats didn’t acknowledge that’s where their challenge lied. If they had, Clinton would not have been their choice coming out of the primaries. Sanders occupied some of the same ground as Trump but his answers were honest, decent ones instead of Trump’s hate.</p>
<p>After complaining of people drawing dodgy parallels between Britain and the US, I’ll make one to close. If the Labour Party hadn’t chosen a solid left platform with the election of Jeremy Corbyn in 2015 I would not have been surprised if we saw a similar far-right force gain quickly in popularity. While we’ve got our usual collection of nasty types, that hasn’t happened.</p>
<p>But there needs to be a recognition that modern liberalism — in its two differing forms on both sides of the Atlantic — does not and cannot address people’s real concerns as it is often complicit in making matters worse, and that if you don’t come up with a serious left-wing challenge then the fascists have all to gain.</p>
  </article>
  <article>
    <header>
      <h2 class="mute-links"><a href="https://robjwells.github.io/2016/11/blind-data/">Blind data</a></h2>
      <p><time datetime="2016-11-05T01:00">Saturday, November 5 2016</time></p>
    </header>
    <p>The <a href="https://www.theguardian.com/lifeandstyle/series/blind-date">Guardian’s Blind Date column</a> has been going for over seven and a half years now, but I always struggled to read it. There was something missing — I didn’t just want to peer into these people’s lives and be left feeling bad for them if things hadn’t gone well.</p>
<p>Well the missing thing was <a href="https://impeccabletablemanners.theguyliner.com">The Guyliner’s sort-of reviews</a>, which are brilliant. I only found out about his blog recently and binged a bit on them.</p>
<p>One thing I find interesting is the way the daters’ scores for each other, which are meant to be out of 10, are stuck in a limited range between 7 and 9. (7 being “<a href="https://impeccabletablemanners.theguyliner.com/2016/06/18/aidan-and-padraig/">a gentleman’s one</a>”.)</p>
<p>In <a href="https://impeccabletablemanners.theguyliner.com/2016/10/29/tom-and-emily/">a recent entry</a> — which mentions a letter to the Guardian about the limited range of scores used — the two seem to get on really well, want to see each other again but the scores are 7.5 and 8.</p>
<p>To get a bit of perspective on the scoring I went through all of the Blind Date columns from January 31 2009 through October 31 2016. The <a href="http://open-platform.theguardian.com">Guardian’s API</a> makes this easy, although what wasn’t immediately obvious is that you can use subsection paths (such as Blind Date at <code>lifeandstyle/series/blind-date</code>) as an alternative to an imprecise search for the same articles. Use the <a href="http://open-platform.theguardian.com/explore/">interactive explorer</a> to see for yourself.</p>
<p>I used a bit of Python to grab all the articles, save them to disk and pull out two things: the score each dater gave their opposite number and whether or not they wanted to see them again.</p>
<p>The data needed cleaning up by hand, usually to parse whether a person wanted to see their opposite number again. This often required a bit of judgement on my part, so it’s not perfect. “Just as friends” counts as a No: only seeming romantic interest gets a Yes. I excluded people who in whatever way refused to answer the scoring question. (This includes “The food was a 10” etc.) I was left with 637 individual responses.</p>
<p>I want to stress two things: the scores are the scorer’s judgement on their date and don’t reflect mutual agreement; answers to the “Would you meet again?” question might be swayed by their partner’s reaction. So, for example, a person might rate their date a 9 but say No to the latter question if their date didn’t seem interested. I wouldn’t worry too much about this for our purposes, but I’m also not claiming this is rigorous work.</p>
<p>So, how frequently do the scores come up?</p>
<p class="full-width">
    <a href="/images/2016-11-05-score_distribution.svg">
        <img alt="A bar chart showing the distribution of scores in the Guardian’s Blind Date column."
             src="/images/2016-11-05-score_distribution.svg"
             class="no-border">
    </a>
</p>

<p>Dominating the scoring are 8 and 7, with 9 a distant third. 6 and 10 get a look in but only that.</p>
<p>Very few people award less than a 6 — in fact, you’re more likely to get a half-point score between 7 and 9 than a 5.</p>
<p>Overlaid on the grey total bars are red bars, which are daters who would like to meet their partner again. The way 8 dominates the scoring, it’s not surprising that there are more Yes answers to the “meet again” question for 8-awarding daters than any other score.</p>
<p>But what happens when we look at how likely a person wants to see their date again for the score given?</p>
<p class="full-width">
    <a href="/images/2016-11-05-interest_rate.svg">
        <img alt="A bar chart showing percentage of people giving a certain score who would like to meet their date again."
             src="/images/2016-11-05-interest_rate.svg"
             class="no-border">
    </a>
</p>

<p>Because no-one’s ever awarded less than a 6 and also wanted to see their date again, I’ve limited this plot to scores 6–10. It’s seriously unlikely that someone who awards a 6 wants to see their date again; at 7 it’s not hugely better at about one in four.</p>
<p>7.5 is an interesting score. I was initially tempted to round half-scores but I’m glad I didn’t (though I did round silly scores like <a href="https://impeccabletablemanners.theguyliner.com/2016/07/23/lou-and-george/">8.9</a> to the nearest integer). If someone awards a 7.5 they are much more likely to want to see their date again than a straight 7, at just under half the time, but still noticeably less than the rate for 8.</p>
<p>The same can’t be said about 8.5, though, which really is a cautious 9. Someone who gives an 8.5 or 9 is pretty likely to want to see their date again.</p>
<p>More so actually than 10, but I’ve got a theory here: 10 is the refuge for a certain group of people who had a good time but didn’t feel anything for their date. Given the relative rarity of 10, I think it’s enough to bring down the Yes percentage to beneath that for 8.5 &amp; 9.</p>
<p>(We can ignore the 100% Yes rate for 9.5, a score which has only been awarded twice.)</p>
<p>Lessons, then. The real scoring range is 6 to 10, but within that there are only real differences in the fundamental question — Would you meet again? — up to 8.5, after which things level off.</p>
<p>That’s it. I did pick up a few scoring bugbears while doing this, though:</p>
<ul>
<li>“Cute” scores. 6.1, 7.4, 7.75 (twice!). These come up not often but enough that people really should resist.</li>
<li>
<p>Not answering the scoring question. My favourite was:</p>
<blockquote>
<p>What is this, a baking competition? All I’ll say is “top marks”</p>
</blockquote>
<p>If you can award a numerical score to a cake you can award one to a date.</p>
</li>
<li>
<p>People who say they won’t answer the scoring question because they’re above it but who actually do answer the scoring question:</p>
<blockquote>
<p>That seems rather ungentlemanly, but since you insist, 7.</p>
<p>The date? 7. Jo? I wouldn't be so vulgar…</p>
</blockquote>
<p>It’s men that do this. Please stop.</p>
</li>
</ul>
<p>And lastly, our favourite fairly common sort of cop-out answer: spark.</p>
<p>
    <video
        src="/images/2016-11-05-spark.mp4"
        poster="/images/2016-11-05-spark.jpg"
        preload="none"
        controls loop muted playsinline
        >
    </video>
</p>

<p>Across the 357 articles I downloaded (a handful of which aren’t actual Blind Date columns), spark is mentioned 45 separate times — about once every eight articles, which is much less frequently than I expected.</p>
  </article>
  <article>
    <header>
      <h2 class="mute-links"><a href="https://robjwells.github.io/2016/10/padding-regex-groups-in-name-mangler/">Padding regex groups in Name Mangler</a></h2>
      <p><time datetime="2016-10-21T22:45">Friday, October 21 2016</time></p>
    </header>
    <p>I’m a big fan of <a href="http://manytricks.com/namemangler/">Name Mangler by Many Tricks</a>, an interactive file renaming application for everything from simple operations to really quite complex and powerful ones, with a comfortable and straightforward interface.</p>
<p>I don’t use it particularly often but it’s nice to have in the toolbox for things that might otherwise be frustrating.</p>
<p>One of my most common tasks for Name Mangler is converting the filename convention used internally at work for naming page files to a more general format we use for our external partners.</p>
<p>Here’s what they look like:</p>
<pre><code># Internal
1_Front_221016.pdf
# External
MS_2016_10_22_001.pdf</code></pre>


<p>Normally this is done automatically with a scheduled script, but occasionally that script fails (at a different stage) and it has to be done by hand. Now obviously this involves a regular expression, and the page number group (at the start of the internal name, end of the external) is zero-padded so it’s three digits long.</p>
<p>So, in Name Mangler’s advanced renaming syntax that becomes:</p>
<pre><code>[pad
    &quot;$1&quot;
    to &quot;-3&quot;
    with &quot;0&quot;
]</code></pre>


<p>right?</p>
<p>Well, no. What happens is interesting. The literal string <code>$1</code> is zero-padded until it’s three digits long: <code>0$1</code> (one extra zero). But after that the regex replacement is made, so page #1 becomes <code>01</code>: 1 with one zero on the front.</p>
<p>To Many Tricks’s great credit, they responded to the support ticket I raised with example code in less than a day, along with an explanation of what’s happening by the developer.</p>
<p>The trick is, instead of providing the group name as the argument to pad, to perform the regex search in-line:</p>
<pre><code>[pad
    [findRegularExpression
        &quot;^(\d+)_.*$&quot;
        in &lt;name&gt;
        replace with &quot;$1&quot;
    ]
    to &quot;-3&quot;
    with &quot;0&quot;
]</code></pre>


<p>This means that when <code>pad</code> gets its arguments, it’s exactly what you want to pad.</p>
<p>By necessity this uses regexes twice: one for parsing the date and constructing most of the name, and this for finding and padding the page number. Perhaps the reason why I missed this approach by myself is that in the Python code, the regex search is performed once and the groups placed in this format string:</p>
<pre><code>MS_{date:%Y}_{date:%m}_{date:%d}_{page:03}.pdf</code></pre>


<p>Which takes care of the padding with no fuss. (At this point, the date has been parsed for completeness’s sake, hence the strftime codes.)</p>
<p>That might lead to a question about why I don’t just use Python to do this. And the answer is that, once you’ve got a recipe that works for you, Name Mangler is painless and flexible. Really, <a href="http://manytricks.com/namemangler/">check it out</a>.</p>
  </article>
  <article>
    <header>
      <h2 class="mute-links"><a href="https://robjwells.github.io/2016/09/support-across-the-board/">Support across the board</a></h2>
      <p><time datetime="2016-09-25T21:00">Sunday, September 25 2016</time></p>
    </header>
    <p>Having written a few things about the Labour Party recently (<a href="/2016/08/playing-a-dirty-game/">1</a>, <a href="/2016/09/where-could-labours-votes-come-from/">2</a>, <a href="/2016/09/owens-two-million-tories/">3</a>), it would be remiss of me not to mark the result.</p>
<p>Obviously I’m very happy. The movement for change represented by Jeremy Corbyn still has a long way to go so it’s good to have fended off the first serious attempt to revert back to the old Establishment party.</p>
<p>I think it’s important to note how widespread support for Corbyn is across the elements that vote for the Labour leader:</p>
<p>
    <a href="/images/2016-09-25-labour_leadership.svg">
        <img alt="A chart showing Jeremy Corbyn’s percentage of the vote across the voting categories of party members, registered and affiliated supporters, in the 2015 and 2016 leadership elections"
             src="/images/2016-09-25-labour_leadership.svg"
             class="no-border">
    </a>
</p>

<p>This bar chart shows the percentages Corbyn won in each category of voter at the 2015 and 2016 leadership elections, with the total on the right-hand side.</p>
<p>In last year’s vote, Corbyn won a majority of registered (£3) and affiliated (trade union) supporters, but “only” a plurality (49.6%) of full party members.</p>
<p>This year he won a majority of party members (59%). This and the decline in his share of registered supporters (£25 in 2016) may be partially explained by previous registered supporters joining the party as full members after his victory.</p>
<p>So across all three categories, Corbyn has a majority of support. This should (but probably won’t) stop people saying that Corbyn’s victory was only on the back of “£3 Trots”. Already there’s been attempts to slice up the vote in a bid to show the weakness of his support, such as <a href="http://morningstaronline.co.uk/a-5e1b-Scots-did-back-Jez-Findlay">Scotland supposedly going for Owen Smith</a>. (Scottish Labour may have some differences, but that claim’s based on an exit poll of just 51 people.)</p>
<p>There also remains the question of how many people were prevented from voting in the leadership election. Just considering registered supporters — and the problem affected members and affiliates too — Labour said that <a href="http://www.bbc.co.uk/news/uk-politics-36851524">183,541 people paid £25 to become registered supporters</a>, yet only 121,517 of them <a href="http://www.labour.org.uk/pages/labour-leadership-results-2016">voted in the leadership election</a>.</p>
<p>Now that he’s won, that doesn’t matter in a narrow sense. But two things are clear: support for Jeremy Corbyn is widespread across all parts of the party, and that there was an attempt by the party bureaucracy to drain that off. To do justice to the former, something should be done about the latter.</p>
  </article>
  <div class="pagination">
<p class="pagination-older"><a href="https://robjwells.github.io/page-9/">Older posts</a></p><p class="pagination-newer"><a href="https://robjwells.github.io/page-7/">Newer posts</a></p>  </div>

</main>

<footer class="site-footer">
  <small class="mute-links">
    This work is licensed under a
    <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">
    Creative Commons Attribution 4.0 International License</a>.
  </small>
</footer> <!-- .site-footer -->

</div> <!-- .wrapper -->

</body>

</html>